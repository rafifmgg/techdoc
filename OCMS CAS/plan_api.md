# API Integration Plan: OCMS - CAS - PLUS
## CAS-OCMS Integration for Court Notices Management

---

## Document Information

| Field | Value |
|-------|-------|
| **Version** | 1.0 |
| **Date** | 2025-01-14 |
| **Source** | Flowchart "Only Option (23 dec 2025 – v2)" |
| **Epic** | OCMS CAS Integration |
| **Systems** | CAS, OCMS, PLUS, IZ-APIM |

---

## Overview

This document defines the API specifications for the integration between:
- **CAS** (Court Administration System)
- **OCMS** (Offence Case Management System)
- **PLUS** (Payment and Licensing Unified System)
- **IZ-APIM** (API Gateway)

The integration enables:
1. Daily synchronization of unpaid court notices and payment status
2. Daily refresh of VIP vehicle data
3. Adhoc notice queries for payment eligibility

---

## API Standards (Yi Jie Guidelines)

### HTTP Method
- **ALL APIs use POST method only**
- No GET, PUT, PATCH, DELETE allowed
- No sensitive data in URL endpoints

### Response Format

**Success Response:**
```json
{
  "data": {
    "appCode": "OCMS-2000",
    "message": "Success"
  }
}
```

**Error Response:**
```json
{
  "appCode": "OCMS-4001",
  "message": "Invalid request payload"
}
```

**List Response with Pagination:**
```json
{
  "total": 100,
  "limit": 10,
  "skip": 0,
  "data": [...]
}
```

### API Naming Convention
- Name endpoints **intuitively** based on function
- Follow **table name** for CRUD operations
- Avoid generic names like `/workflow`, `/process`

### Response Data Principle
- Return **only required fields** for current operation
- Don't return all fields when only subset is needed
- Each API returns specific fields for its purpose

### Data Source Attribution
- **Every field** must have source documented
- Format: `// Source: table_name.column_name` or `// Source: Calculated` or `// Source: API field`

---

## Internal APIs

### API 1: Get Payment Status

####基本信息
- **Endpoint**: `POST /v1/ocms/cas-getPaymentStatus`
- **From**: CAS
- **To**: OCMS Intranet
- **Frequency**: Once a day (scheduled job)
- **Purpose**: Get updated payment status information for unpaid court notices
- **Batch Limit**: Maximum 500 notices per request
- **Authentication**: API Key (shared secret)

#### Request Payload

```json
{
  "requestId": "550e8400-e29b-41d4-a716-446655440000",    // Source: Generated by CAS (UUID)
  "requestTimestamp": "2025-01-14T10:30:00+08:00",       // Source: CAS system timestamp
  "notices": [
    {
      "noticeNo": "1234567890"                            // Source: CAS unpaid notice list
    }
  ]
}
```

**Validation Rules (Frontend & Backend):**
| Field | Validation | Error Code |
|-------|------------|------------|
| requestId | Required, UUID format | OCMS-4001 |
| requestTimestamp | Required, ISO 8601 format | OCMS-4002 |
| notices | Required, non-empty array, max 500 items | OCMS-4003 |
| noticeNo | Required, alphanumeric, max 10 chars | OCMS-4004 |

**Batch Limit Validation:**
- Maximum 500 notices per request
- If exceeded, return HTTP 413 Payload Too Large with error code OCMS-4131

#### Response Payload

**Success Response** (200 OK):
```json
{
  "total": 150,                                            // Source: Count of notices returned
  "limit": 500,                                            // Source: Request max batch size
  "skip": 0,                                               // Source: Pagination offset
  "data": {
    "appCode": "OCMS-2000",
    "message": "Successfully retrieved payment status",
    "notices": [
      {
        "noticeNo": "1234567890",                          // Source: ocms_valid_offence_notice.notice_no
        "paymentStatus": "PP",                             // Source: ocms_valid_offence_notice.payment_status
        "amountPayable": 150.00,                           // Source: ocms_valid_offence_notice.amount_payable
        "amountPaid": 0.00,                                // Source: ocms_valid_offence_notice.amount_paid
        "paymentAllowanceFlag": "Y",                       // Source: ocms_valid_offence_notice.payment_acceptance_allowed
        "suspensionType": "PS",                            // Source: ocms_valid_offence_notice.suspension_type
        "crsReasonOfSuspension": "FP",                     // Source: ocms_valid_offence_notice.crs_reason_of_suspension
        "eprReasonOfSuspension": "PS-WWP"                  // Source: ocms_valid_offence_notice.epr_reason_of_suspension
      }
    ]
  }
}
```

**Error Response** (400 Bad Request):
```json
{
  "appCode": "OCMS-4001",
  "message": "Invalid request payload"
}
```

**Error Response** (413 Payload Too Large):
```json
{
  "appCode": "OCMS-4131",
  "message": "Request exceeds maximum batch limit of 500 notices"
}
```

**Error Response** (401 Unauthorized):
```json
{
  "appCode": "OCMS-4011",
  "message": "Invalid or missing API credentials"
}
```

**Error Response** (500 Internal Server Error):
```json
{
  "appCode": "OCMS-5001",
  "message": "Internal server error occurred while processing request"
}
```

#### Error Codes

| App Code | HTTP Status | Message |
|----------|-------------|---------|
| OCMS-2000 | 200 | Success |
| OCMS-4001 | 400 | Invalid request payload |
| OCMS-4002 | 400 | Invalid request timestamp format |
| OCMS-4003 | 400 | Notices array is empty or exceeds limit |
| OCMS-4004 | 400 | Invalid notice number format |
| OCMS-4011 | 401 | Invalid or missing API credentials |
| OCMS-4131 | 413 | Request exceeds maximum batch limit |
| OCMS-4291 | 429 | Rate limit exceeded |
| OCMS-5001 | 500 | Internal server error |
| OCMS-5031 | 503 | Service unavailable |

#### Business Logic & Data Flow

**Database Query:**
```sql
SELECT
  von.notice_no,
  von.payment_status,
  von.amount_payable,
  von.amount_paid,
  von.payment_acceptance_allowed,
  von.suspension_type,
  von.crs_reason_of_suspension,
  von.epr_reason_of_suspension
FROM ocms_valid_offence_notice von
WHERE von.notice_no IN (/* notice numbers from request */)
```

**Note:** EMCON handling has been removed from API scope. EMCON notices will be handled manually by users in both OCMS and CAS systems.

---

### API 2: Update Court Notices

####基本信息
- **Endpoint**: `POST /v1/ocms/cas-updateCourtNotices`
- **From**: CAS
- **To**: OCMS Intranet
- **Frequency**: Once a day (after API 1 execution)
- **Purpose**: Update court notices with new stage and suspension information
- **Batch Limit**: Maximum 500 notices per request
- **Authentication**: API Key (shared secret)

#### Request Payload

```json
{
  "requestId": "550e8400-e29b-41d4-a716-446655440000",    // Source: Generated by CAS (UUID)
  "requestTimestamp": "2025-01-14T11:00:00+08:00",       // Source: CAS system timestamp
  "notices": [
    {
      "noticeNo": "1234567890",                          // Source: CAS court notice list
      "suspensionType": "PS",                            // Source: CAS suspension update
      "eprReasonOfSuspension": "PS-WWP",                 // Source: CAS EPR reason
      "processingStage": "WAR"                           // Source: CAS new stage
    }
  ]
}
```

**Validation Rules (Frontend & Backend):**
| Field | Validation | Error Code |
|-------|------------|------------|
| requestId | Required, UUID format | OCMS-4001 |
| requestTimestamp | Required, ISO 8601 format | OCMS-4002 |
| notices | Required, non-empty array, max 500 items | OCMS-4003 |
| noticeNo | Required, exists in ocms_valid_offence_notice | OCMS-4004 |
| suspensionType | Optional, valid values: "PS", "TS" | OCMS-4005 |
| eprReasonOfSuspension | Optional, valid values: "PS-WWP", "PS-OTH", "PS-WWC" | OCMS-4006 |
| processingStage | Optional, valid stage code from ocms_stage_map | OCMS-4007 |

**Batch Limit Validation:**
- Maximum 500 notices per request
- If exceeded, return HTTP 413 Payload Too Large with error code OCMS-4131

#### Response Payload

**Success Response** (200 OK):
```json
{
  "data": {
    "appCode": "OCMS-2000",
    "message": "Successfully updated 150 court notices",
    "updatedCount": 150,                                  // Source: Count of updated records
    "notices": [
      {
        "noticeNo": "1234567890",                          // Source: ocms_valid_offence_notice.notice_no
        "amountPayable": 150.00,                           // Source: ocms_valid_offence_notice.amount_payable
        "paymentAllowanceFlag": "Y",                       // Source: ocms_valid_offence_notice.payment_acceptance_allowed
        "courtPaymentDueDate": "2025-02-14T00:00:00+08:00" // Source: ocms_valid_offence_notice.payment_due_date
      }
    ]
  }
}
```

**Partial Success Response** (207 Multi-Status):
```json
{
  "data": {
    "appCode": "OCMS-2001",
    "message": "Partially updated: 140 succeeded, 10 failed",
    "updatedCount": 140,
    "failedCount": 10,
    "notices": [ /* ... */ ],
    "errors": [
      {
        "noticeNo": "9999999999",                          // Source: Failed notice from request
        "appCode": "OCMS-4008",
        "message": "Notice does not exist or is not a court notice"
      }
    ]
  }
}
```

**Error Response** (400 Bad Request):
```json
{
  "appCode": "OCMS-4001",
  "message": "Invalid request payload"
}
```

**Error Response** (404 Not Found):
```json
{
  "appCode": "OCMS-4008",
  "message": "Notice not found or is not a court notice"
}
```

#### Error Codes

| App Code | HTTP Status | Message |
|----------|-------------|---------|
| OCMS-2000 | 200 | Success |
| OCMS-2001 | 207 | Partial success |
| OCMS-4001 | 400 | Invalid request payload |
| OCMS-4005 | 400 | Invalid suspension type |
| OCMS-4006 | 400 | Invalid EPR reason of suspension |
| OCMS-4007 | 400 | Invalid processing stage |
| OCMS-4008 | 404 | Notice not found or not court notice |
| OCMS-4011 | 401 | Invalid or missing API credentials |
| OCMS-4131 | 413 | Request exceeds maximum batch limit |
| OCMS-5001 | 500 | Internal server error |

#### Business Logic & Data Flow

**Validation Query:**
```sql
SELECT notice_no, dayend
FROM ocms_valid_offence_notice
WHERE notice_no = ?
```

**Court Notice Check:**
```
IF dayend_flag = 'Y' THEN
   -- Is court notice, proceed with update
ELSE
   -- Not court notice, return error OCMS-4008
END IF
```

**Update Query:**
```sql
UPDATE ocms_valid_offence_notice
SET
  suspension_type = ?,              -- From request (if provided)
  epr_reason_of_suspension = ?,     -- From request (if provided)
  processing_stage = ?,             -- From request (if provided)
  upd_date = GETDATE(),
  upd_user_id = 'ocmsiz_app_conn'   -- NOT "SYSTEM"
WHERE notice_no = ?
```

**Response Query:**
```sql
SELECT
  notice_no,
  amount_payable,
  payment_acceptance_allowed,
  payment_due_date
FROM ocms_valid_offence_notice
WHERE notice_no IN (/* updated notice numbers */)
```

**Insert Order (if parent-child involved):**
1. Parent table updated first (ocms_valid_offence_notice)
2. Child table updated after (if applicable)

---

### API 3: Refresh VIP Vehicle

####基本信息
- **Endpoint**: `POST /v1/ocms/cas-refreshVIPVehicle`
- **From**: OCMS Intranet
- **To**: CAS
- **Frequency**: Once a day (scheduled job)
- **Purpose**: Full refresh of VIP vehicle table
- **Authentication**: Mutual TLS (certificate-based)
- **Retry**: 3 retries on connection failure + email alert

#### Request Payload

```json
{
  "requestId": "550e8400-e29b-41d4-a716-446655440000",    // Source: Generated by OCMS (UUID)
  "requestTimestamp": "2025-01-14T02:00:00+08:00"        // Source: OCMS system timestamp
}
```

**Validation Rules:**
| Field | Validation | Error Code |
|-------|------------|------------|
| requestId | Required, UUID format | OCMS-4001 |
| requestTimestamp | Required, ISO 8601 format | OCMS-4002 |

#### Response Payload

**Success Response** (200 OK):
```json
{
  "total": 500,                                            // Source: Total vehicle count from CAS
  "data": {
    "appCode": "OCMS-2000",
    "message": "Successfully retrieved VIP vehicle data",
    "vehicles": [
      {
        "vehicleNo": "ABC1234",                             // Source: CAS VIP vehicle data
        "vipVehicle": "Y",                                  // Source: CAS VIP vehicle data
        "description": "Diplomatic vehicle",                // Source: CAS VIP vehicle data
        "status": "A"                                       // Source: CAS vehicle status (A=Active)
      }
    ]
  }
}
```

**Error Response** (401 Unauthorized):
```json
{
  "appCode": "OCMS-4011",
  "message": "Invalid TLS certificate"
}
```

**Error Response** (503 Service Unavailable):
```json
{
  "appCode": "OCMS-5031",
  "message": "CAS service unavailable"
}
```

#### Error Codes

| App Code | HTTP Status | Message |
|----------|-------------|---------|
| OCMS-2000 | 200 | Success |
| OCMS-4001 | 400 | Invalid request payload |
| OCMS-4011 | 401 | Invalid TLS certificate |
| OCMS-5001 | 500 | Internal server error |
| OCMS-5031 | 503 | CAS service unavailable |

#### Business Logic & Data Flow

**Call CAS API:**
- OCMS calls CAS endpoint to get full VIP vehicle list
- Use mutual TLS authentication

**Refresh Database:**
```sql
-- TRUNCATE existing data
TRUNCATE TABLE ocms_vip_vehicle;

-- INSERT all records from CAS response
INSERT INTO ocms_vip_vehicle (
  vehicle_no,
  vip_vehicle,
  description,
  status,
  cre_date,
  cre_user_id
) VALUES (
  ?, ?, ?, ?, GETDATE(), 'ocmsiz_app_conn'  -- NOT "SYSTEM"
);
```

**Logging:**
- For frequent sync job, use application logs only
- No batch job table logging required

**Shedlock Job Name:**
```
refresh_vip_vehicle
```
Pattern: `[action]_[subject]`

**Job Tracking:**
- Record start time immediately when job starts
- Break up process to handle memory loss scenarios

---

### API 4: Query Notice Info (PLUS Integration)

####基本信息
- **Endpoint**: `POST /v1/plus-queryNoticeInfo`
- **From**: PLUS (via IZ-APIM)
- **To**: OCMS Intranet
- **Frequency**: Adhoc (on-demand)
- **Purpose**: Query notice payment eligibility with court payment due date check
- **Batch Limit**: Maximum 100 notices per request
- **Authentication**: OAuth 2.0 Bearer Token (via IZ-APIM)
- **Token Refresh**: Auto refresh on expiry, continue processing

#### Request Payload

```json
{
  "requestId": "550e8400-e29b-41d4-a716-446655440000",    // Source: Generated by PLUS (UUID)
  "requestTimestamp": "2025-01-14T14:30:00+08:00",       // Source: PLUS system timestamp
  "notices": [
    {
      "noticeNo": "1234567890"                            // Source: PLUS user query
    }
  ]
}
```

**Validation Rules (Frontend & Backend):**
| Field | Validation | Error Code |
|-------|------------|------------|
| requestId | Required, UUID format | OCMS-4001 |
| requestTimestamp | Required, ISO 8601 format | OCMS-4002 |
| notices | Required, non-empty array, max 100 items | OCMS-4003 |
| noticeNo | Required, alphanumeric, max 10 chars | OCMS-4004 |

**Batch Limit Validation:**
- Maximum 100 notices per request
- If exceeded, return HTTP 413 Payload Too Large with error code OCMS-4131

#### Response Payload

**Success Response** (200 OK):
```json
{
  "total": 1,                                             // Source: Count of notices
  "data": {
    "appCode": "OCMS-2000",
    "message": "Successfully retrieved notice information",
    "notices": [
      {
        "noticeNo": "1234567890",                          // Source: ocms_valid_offence_notice.notice_no
        "courtPaymentDueDate": "2025-02-14T00:00:00+08:00", // Source: ocms_valid_offence_notice.payment_due_date
        "paymentAllowanceFlag": "N",                       // Source: Calculated (due date check logic)
        "amountPayable": 150.00                            // Source: ocms_valid_offence_notice.amount_payable
      }
    ]
  }
}
```

**Error Response** (400 Bad Request):
```json
{
  "appCode": "OCMS-4001",
  "message": "Invalid request payload"
}
```

**Error Response** (404 Not Found):
```json
{
  "appCode": "OCMS-4008",
  "message": "One or more notices not found"
}
```

#### Error Codes

| App Code | HTTP Status | Message |
|----------|-------------|---------|
| OCMS-2000 | 200 | Success |
| OCMS-4001 | 400 | Invalid request payload |
| OCMS-4004 | 400 | Invalid notice number format |
| OCMS-4008 | 404 | Notice not found |
| OCMS-4011 | 401 | Invalid or missing OAuth token |
| OCMS-4131 | 413 | Request exceeds maximum batch limit |
| OCMS-4291 | 429 | Rate limit exceeded |
| OCMS-5001 | 500 | Internal server error |

#### Business Logic & Data Flow

**Database Query:**
```sql
SELECT
  notice_no,
  payment_due_date,
  payment_acceptance_allowed,
  amount_payable
FROM ocms_valid_offence_notice
WHERE notice_no IN (/* notice numbers from request */)
```

**Payment Allowance Logic:**
```sql
-- Calculate payment allowance flag based on due date
SELECT
  notice_no,
  payment_due_date AS courtPaymentDueDate,
  CASE
    WHEN GETDATE() > payment_due_date THEN 'N'  -- Past due date, not payable
    ELSE payment_acceptance_allowed            -- Use DB flag
  END AS paymentAllowanceFlag,
  amount_payable
FROM ocms_valid_offence_notice
WHERE notice_no = ?
```

**Court Payment Due Date:**
- Map `payment_due_date` to `courtPaymentDueDate`
- Store in `ocms_court_case` table for tracking

**Data Persistence to ocms_court_case:**
```sql
-- Insert or update court payment due date tracking
MERGE ocms_court_case AS target
USING (
  SELECT
    notice_no,
    payment_due_date AS court_payment_due_date
  FROM ocms_valid_offence_notice
  WHERE notice_no IN (/* notice numbers from request */)
) AS source
ON (target.notice_no = source.notice_no)
WHEN MATCHED THEN
  UPDATE SET
    court_payment_due_date = source.court_payment_due_date,
    upd_date = GETDATE(),
    upd_user_id = 'ocmsiz_app_conn'
WHEN NOT MATCHED THEN
  INSERT (notice_no, court_payment_due_date, cre_date, cre_user_id)
  VALUES (source.notice_no, source.court_payment_due_date, GETDATE(), 'ocmsiz_app_conn');
```

**Token Handling:**
- If OAuth token expired → auto refresh
- Continue processing after token refresh
- Don't stop processing due to token expiry

**Retry Mechanism:**
- 3 retries on connection failure
- After 3 failures → trigger email alert to operations team

---

## External APIs

### CAS Internal API: Get VIP Vehicle List
- **Endpoint**: CAS internal (TBD)
- **Method**: POST
- **Authentication**: Mutual TLS
- **Purpose**: Retrieve full list of VIP vehicles
- **Owner**: CAS Team
- **Auto-refresh Token**: N/A (certificate-based)

### IZ-APIM Gateway
- **Purpose**: API Gateway between PLUS and OCMS
- **Authentication**: OAuth 2.0 (managed by IZ-APIM)
- **Rate Limiting**: Configured at IZ-APIM level (100 req/min)
- **Token Endpoint**: TBD (IZ-APIM team to provide)
- **Owner**: API Gateway Team

---

## Database Schema Changes

### New Table: ocms_vip_vehicle

```sql
CREATE TABLE ocms_vip_vehicle (
  vehicle_no VARCHAR(20) PRIMARY KEY,
  vip_vehicle VARCHAR(1) NOT NULL,
  description VARCHAR(255),
  status VARCHAR(2) NOT NULL,
  cre_date DATETIME2(7) NOT NULL DEFAULT GETDATE(),
  cre_user_id VARCHAR(50) NOT NULL DEFAULT 'ocmsiz_app_conn',
  upd_date DATETIME2(7),
  upd_user_id VARCHAR(50)
);
```

**Purpose**: Store VIP vehicle data refreshed daily from CAS

**Data Dictionary Compliance:**
- ⚠️ **NEW TABLE** - Must be added to data dictionary
- Field naming follows existing convention
- Uses `ocmsiz_app_conn` for audit user (NOT "SYSTEM")

### New Table: ocms_court_case

```sql
CREATE TABLE ocms_court_case (
  notice_no VARCHAR(10) PRIMARY KEY,
  court_payment_due_date DATETIME2(7) NOT NULL,
  cre_date DATETIME2(7) NOT NULL DEFAULT GETDATE(),
  cre_user_id VARCHAR(50) NOT NULL DEFAULT 'ocmsiz_app_conn',
  upd_date DATETIME2(7),
  upd_user_id VARCHAR(50)
);
```

**Purpose**: Store court payment due date information for PLUS queries (API 4)

**Data Dictionary Compliance:**
- ⚠️ **NEW TABLE** - Must be added to data dictionary
- Field naming follows existing convention
- Uses `ocmsiz_app_conn` for audit user (NOT "SYSTEM")

**Note**: This table stores court case payment due dates specifically for PLUS integration. Data is populated when court notices are processed.

---

## Batch Job Configuration

### Job 1: Get Payment Status (Daily)

**Shedlock Name:**
```
sync_cas_payment_status
```
Pattern: `[action]_[subject]`

**Schedule:** Once a day (time TBD)

**Tracking:**
- Record start time immediately when job starts
- Log to application logs only (frequent sync)
- No batch job table logging

**User:** `ocmsiz_app_conn`

### Job 2: Update Court Notices (Daily)

**Shedlock Name:**
```
update_cas_court_notices
```
Pattern: `[action]_[subject]`

**Schedule:** Once a day (after Job 1)

**Tracking:**
- Record start time immediately when job starts
- Log to application logs only (frequent sync)
- No batch job table logging

**User:** `ocmsiz_app_conn`

### Job 3: Refresh VIP Vehicle (Daily)

**Shedlock Name:**
```
refresh_vip_vehicle
```
Pattern: `[action]_[subject]`

**Schedule:** Once a day (time TBD)

**Tracking:**
- Record start time immediately when job starts
- Log to application logs only (frequent sync)
- No batch job table logging

**User:** `ocmsiz_app_conn`

---

## Rate Limiting

| API | Limit | Period |
|-----|-------|--------|
| API 1 | 10 requests | 1 hour |
| API 2 | 10 requests | 1 hour |
| API 3 | 1 request | 1 day |
| API 4 | 100 requests | 1 minute |

**Rate Limit Response:**
```json
{
  "appCode": "OCMS-4291",
  "message": "Rate limit exceeded. Please try again later."
}
```

---

## Security & Authentication

### Authentication Methods

| API | Method | Details |
|-----|--------|---------|
| API 1 | API Key | X-API-Key header (shared secret) |
| API 2 | API Key | X-API-Key header (shared secret) |
| API 3 | Mutual TLS | Client certificate |
| API 4 | OAuth 2.0 | Bearer token (via IZ-APIM) |

### Request Headers

**All APIs:**
```
Content-Type: application/json
X-Request-ID: {request_id}
```

**API 1 & API 2 (CAS → OCMS):**
```
X-API-Key: {api_key}
```

**API 3 (OCMS → CAS):**
```
Client-Certificate: {TLS certificate}
```

**API 4 (PLUS → OCMS via IZ-APIM):**
```
Authorization: Bearer {access_token}
```

---

## Assumptions Log

| ID | Assumption | Impact | Status |
|----|------------|--------|--------|
| ASSUMPTION-001 | OCMS has `ocms_valid_offence_notice` table with all required fields | Low - verified in data dictionary | ✅ Confirmed |
| ASSUMPTION-002 | CAS can provide unpaid notice list daily | Medium - need CAS team confirmation | ⚠️ Pending |
| ASSUMPTION-003 | Court notice identified by `dayend` flag | Medium - need verification | ⚠️ Pending |
| ASSUMPTION-004 | IZ-APIM configured for PLUS integration | High - need IZ-APIM team confirmation | ⚠️ Pending |
| ASSUMPTION-005 | VIP vehicle data structure in CAS matches requirements | Medium - need CAS team confirmation | ⚠️ Pending |
| ASSUMPTION-006 | Daily jobs scheduled at non-peak hours | Low - operations team decision | ⚠️ Pending |
| ASSUMPTION-007 | Batch limits of 500 (API 1&2) and 100 (API 4) are sufficient | Medium - need load testing | ⚠️ Pending |

---

## Open Questions

| ID | Question | Impact | Assigned To |
|----|----------|--------|-------------|
| Q1 | Exact timing for daily scheduled jobs? | Job scheduling configuration | DevOps Team |
| Q2 | IZ-APIM OAuth 2.0 token endpoint and client credentials? | API 4 authentication | API Gateway Team |
| Q3 | CAS VIP vehicle data structure and field mappings? | API 3 implementation | CAS Team |
| Q4 | How to identify court notices in database (which field)? | API 2 validation logic | Data Team |
| Q5 | Are batch limits of 500/100 sufficient for expected load? | API performance | DevOps Team |

---

## Dependencies

### Internal Dependencies
- ✅ ocms_valid_offence_notice table exists
- ⚠️ ocms_vip_vehicle table creation (new)
- ⚠️ ocms_court_case table creation (new)
- ⚠️ ocms_stage_map reference for stage validation
- ⚠️ Batch job infrastructure (Shedlock)
- ⚠️ API infrastructure (OCMS Intranet)

### External Dependencies
- ⚠️ CAS API endpoints availability
- ⚠️ CAS API credentials setup (API Key, TLS certificate)
- ⚠️ IZ-APIM gateway configuration
- ⚠️ PLUS system integration readiness
- ⚠️ Network connectivity between systems

---

## Next Steps

1. ✅ Complete plan_api.md (following Yi Jie guidelines)
2. ⏳ Create plan_condition.md (business rules & validations)
3. ⏳ Create plan_flowchart.md (system flows)
4. ⏳ Design flowchart in .drawio format
5. ⏳ Generate technical documentation

---

**Document End**
