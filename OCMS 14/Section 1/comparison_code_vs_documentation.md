# Code vs Documentation Comparison Report

## OCMS 14 Section 1 - Detecting Vehicle Registration Type

| Attribute | Value |
| --- | --- |
| Report Date | 20/01/2026 |
| Generated By | Claude |
| Documents Compared | OCMS14_Technical_Document_Section_1_v2.md, plan_api.md, plan_condition.md |
| Code Files Reviewed | SpecialVehUtils.java, VipVehicleService.java, VipVehicleRepository.java, CreateNoticeServiceImpl.java, OcmsValidOffenceNotice.java |

---

## Executive Summary

| Category | Count |
| --- | --- |
| Critical Differences | 3 |
| Minor Differences | 4 |
| Matches/Aligned | 8 |

---

## 1. Critical Differences

### 1.1 Blank Vehicle Error Handling NOT in SpecialVehUtils

| Aspect | Documentation | Code |
| --- | --- | --- |
| **Location** | SpecialVehUtils should check offenceType and return OCMS-1401/1402 | SpecialVehUtils does NOT check offenceType |
| **Documentation Reference** | plan_condition.md - C003a, C003b | SpecialVehUtils.java line 50-62 |
| **Behavior** | If blank vehicle + Type O → OCMS-1401<br>If blank vehicle + Type E → OCMS-1402 | Returns 'X' (UPL) for ALL blank vehicles |

**Code (SpecialVehUtils.java lines 50-62):**
```java
// Step 2: Check for blank vehicle number or "N.A" string (UPL vehicle)
if (vehNo == null || vehNo.isEmpty() || vehNo.trim().isEmpty() || "N.A".equalsIgnoreCase(vehNo.trim())) {
    log.debug("Vehicle number is blank/null/N.A, returning X (UPL vehicle)");
    return "X";  // Returns X without checking offenceType!
}
```

**Documentation (plan_condition.md):**
```
IF vehicleNo IS BLANK AND offenceType = 'O'
THEN Return Error OCMS-1401

IF vehicleNo IS BLANK AND offenceType = 'E'
THEN Return Error OCMS-1402
```

**Impact:**
- Code will return 'X' for blank vehicles even when offenceType is 'O' or 'E'
- Error conditions OCMS-1401 and OCMS-1402 are NOT implemented in SpecialVehUtils
- The error handling may be done at a different layer (CreateNoticeServiceImpl)

**Recommendation:**
- Update documentation to reflect actual implementation
- OR modify code to add offenceType parameter and error handling

---

### 1.2 Method Signature Mismatch

| Aspect | Documentation | Code |
| --- | --- | --- |
| **Method Parameters** | 3 parameters: vehicleNo, sourceProvidedType, offenceType | 2 parameters: vehNo, sourceProvidedType |
| **Documentation Reference** | plan_api.md - Input Parameters | SpecialVehUtils.java line 43 |

**Code (SpecialVehUtils.java line 43):**
```java
public String checkVehregistration(String vehNo, String sourceProvidedType)
```

**Documentation (plan_api.md):**
```
| Parameter | Data Type | Max Length | Required | Nullable |
| vehicleNo | varchar | 14 | Conditional | No |
| sourceProvidedType | varchar | 1 | No | Yes |
| offenceType | varchar | 1 | Yes | No |
```

**Impact:**
- Documentation expects offenceType as input
- Code does not accept offenceType, cannot validate blank vehicle conditions

**Recommendation:**
- Update documentation to remove offenceType from SpecialVehUtils input
- Document that offenceType validation is handled in CreateNoticeServiceImpl

---

### 1.3 VIP Vehicle Repository DISABLED

| Aspect | Documentation | Code |
| --- | --- | --- |
| **VIP Check** | Queries CAS VIP_VEHICLE table | Repository is DISABLED (stub) |
| **Documentation Reference** | plan_api.md Section 3.2 | VipVehicleRepository.java (crud/casdb) |

**Code (crud/casdb/vipvehicle/VipVehicleRepository.java):**
```java
/**
 * TEMPORARILY DISABLED: VIP vehicle functionality is disabled because the CAS database connection is not set up
 */
public interface VipVehicleRepository {
    // Temporarily disabled
}
```

**However, there IS a working repository at:**
`crud/dao/casdb/repositories/VipVehicleRepository.java` - This one has proper JPA implementation.

**Impact:**
- May cause confusion about which repository is active
- Need to verify which repository is actually used in production

**Recommendation:**
- Clarify in documentation which VipVehicleRepository is used
- Consider removing disabled stub or adding documentation note

---

## 2. Minor Differences

### 2.1 Military Vehicle Pattern - "Contains" vs "Starts/Ends With"

| Aspect | Documentation | Code |
| --- | --- | --- |
| **MINDEF Check** | "contains MINDEF" | "startsWith or endsWith MINDEF" |
| **Documentation Reference** | plan_condition.md C006, Technical Doc Appendix C | SpecialVehUtils.java line 123-127 |

**Code (SpecialVehUtils.java lines 123-127):**
```java
private boolean isMid(String vehNo) {
    return vehNo.startsWith("MID") || vehNo.endsWith("MID") ||
           vehNo.startsWith("MINDEF") || vehNo.endsWith("MINDEF");
}
```

**Documentation:**
```
| Pattern | Description | Example |
| MINDEF | Vehicle number contains 'MINDEF' | MINDEF123 |
```

**Impact:**
- Vehicle "123MINDEF456" would NOT be detected as Military in code
- Vehicle "123MINDEF456" WOULD be detected as Military per documentation

**Recommendation:**
- Update documentation to match code behavior (starts/ends with)
- OR clarify if "contains" is actually required

---

### 2.2 Error Response Format in Code

| Aspect | Documentation | Code |
| --- | --- | --- |
| **Error Format** | `{ "data": { "appCode": "OCMS-1401", "message": "..." } }` | Uses ErrorCodes enum (BAD_REQUEST, MISSING_MANDATORY, etc.) |
| **Documentation Reference** | plan_api.md Section 6.2 | CreateNoticeServiceImpl.java |

**Code (CreateNoticeServiceImpl uses ErrorCodes):**
```java
errorResponse.createSingleNoticeFailureResponse(ErrorCodes.BAD_REQUEST, "Missing Mandatory Fields");
errorResponse.createSingleNoticeFailureResponse(ErrorCodes.MISSING_MANDATORY, "Invalid input...");
```

**Documentation:**
```json
{
  "data": {
    "appCode": "OCMS-1401",
    "message": "Vehicle number is required for On-street (O) offence type"
  }
}
```

**Impact:**
- Error codes OCMS-1401 and OCMS-1402 may not exist in ErrorCodes enum
- Response format may differ from documented format

**Recommendation:**
- Verify ErrorCodes enum contains OCMS-1401, OCMS-1402
- Update documentation to match actual error codes used

---

### 2.3 Blank Vehicle Handling Location

| Aspect | Documentation | Code |
| --- | --- | --- |
| **Where blank is handled** | In SpecialVehUtils.checkVehregistration | In CreateNoticeServiceImpl.processSingleNotice |
| **Documentation Reference** | plan_condition.md C002 | CreateNoticeServiceImpl.java lines 805-811 |

**Code (CreateNoticeServiceImpl.java lines 805-811):**
```java
String vehicleNo = dto.getVehicleNo();
if (vehicleNo == null || vehicleNo.isEmpty() || vehicleNo.trim().isEmpty()) {
    log.info("Empty vehicle number detected, standardizing to '{}' for consistent duplicate checking",
        SystemConstant.VehicleNumber.UNLICENSED_PARKING);
    vehicleNo = SystemConstant.VehicleNumber.UNLICENSED_PARKING;
    dto.setVehicleNo(SystemConstant.VehicleNumber.UNLICENSED_PARKING);
}
```

**Impact:**
- Blank vehicles are standardized to "UNLICENSED_PARKING" BEFORE calling SpecialVehUtils
- SpecialVehUtils receives "UNLICENSED_PARKING", not blank/null

**Recommendation:**
- Document that blank vehicle handling is in CreateNoticeServiceImpl
- Update plan_condition.md to reflect actual flow

---

### 2.4 LTA Validation Exception Handling

| Aspect | Documentation | Code |
| --- | --- | --- |
| **Return Code Check** | Documentation mentions checking return code | Code catches VehicleNoException |
| **Documentation Reference** | plan_api.md Section 3.1 | SpecialVehUtils.java lines 160-174 |

**Code (SpecialVehUtils.java lines 160-174):**
```java
try {
    boolean isValid = ValidateRegistrationNo.validate(vehNo);
    return isValid;
} catch (VehicleNoException e) {
    log.debug("LTA validation failed for vehicle {}: code {}, message: {}",
             vehNo, e.getReturnCode(), e.getMessage());
    return false;
} catch (Exception e) {
    log.warn("Unexpected error during LTA validation for vehicle {}: {}",
            vehNo, e.getMessage(), e);
    return false;
}
```

**Documentation (plan_api.md):**
```
| Exception | Return Code | Description | Action |
| VehicleNoException | 1 | Valid Singapore vehicle | Return true |
| VehicleNoException | Other | Invalid vehicle number format | Return false |
```

**Impact:**
- Minor documentation clarification needed
- Code behavior matches intent (return false on exception)

**Recommendation:**
- Simplify documentation to match actual code behavior

---

## 3. Matches / Aligned Items

| Item | Documentation | Code | Status |
| --- | --- | --- | --- |
| Detection Order | Source→Blank→LTA→Dip→Mil→VIP→LastChar→Default | Same | MATCH |
| Foreign Check (C001) | sourceProvidedType = 'F' → Return 'F' | Lines 45-48 | MATCH |
| Diplomatic Regex | `^S.*CC$`, `^S.*CD$`, `^S.*TC$`, `^S.*TE$` | Lines 112-115 | MATCH |
| VIP Query Pattern | `WHERE vehicle_no = ? AND status = 'A'` | VipVehicleRepository.java line 26 | MATCH |
| Last Character Check | Character.isLetter(last char) → Return 'S' | Lines 84-87 | MATCH |
| Default Foreign | No match → Return 'F' | Lines 90-91 | MATCH |
| Entity Field: vehicle_no | varchar(14) NOT NULL | `@Column(length = 14, nullable = false)` | MATCH |
| Entity Field: vehicle_registration_type | varchar(1) nullable | `@Column(length = 1)` | MATCH |

---

## 4. Summary of Required Actions

### Documentation Updates Required

| Priority | Item | Current Doc | Should Be |
| --- | --- | --- | --- |
| HIGH | Remove offenceType from SpecialVehUtils input | Has offenceType | Remove offenceType |
| HIGH | Document where blank vehicle errors are handled | In SpecialVehUtils | In CreateNoticeServiceImpl |
| MEDIUM | Update MINDEF pattern | "contains" | "starts/ends with" |
| MEDIUM | Clarify VipVehicleRepository location | Generic reference | Specify dao/casdb path |
| LOW | Update LTA exception handling docs | Multiple return codes | Single behavior |

### Code Investigation Needed

| Priority | Item | Question |
| --- | --- | --- |
| HIGH | ErrorCodes enum | Do OCMS-1401, OCMS-1402 exist? |
| MEDIUM | VipVehicleRepository | Which one is used in production? |
| LOW | Blank vehicle Type O/E | Where is OCMS-1401/1402 returned? |

---

## 5. Appendix: Code File References

| File | Path | Purpose |
| --- | --- | --- |
| SpecialVehUtils.java | `ura-project-ocmsadminapi/.../workflows/notice_creation/core/helpers/` | Vehicle registration type detection |
| VipVehicleService.java | `ura-project-ocmsadminapi/.../crud/casdb/vipvehicle/` | VIP vehicle service |
| VipVehicleRepository.java | `ura-project-ocmsadminapi/.../crud/dao/casdb/repositories/` | VIP database queries (ACTIVE) |
| VipVehicleRepository.java | `ura-project-ocmsadminapi/.../crud/casdb/vipvehicle/` | VIP database queries (DISABLED) |
| CreateNoticeServiceImpl.java | `ura-project-ocmsadminapi/.../workflows/notice_creation/core/` | Notice creation flow |
| OcmsValidOffenceNotice.java | `ura-project-ocmsadminapi/.../crud/ocmsizdb/OcmsValidOffenceNotice/` | Entity class |

---

**End of Report**
