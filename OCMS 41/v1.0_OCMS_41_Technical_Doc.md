# OCMS 41 – Furnish Hirer/Driver

**Prepared by**

[COMPANY LOGO]

[COMPANY NAME]

---

<!--
IMPORTANT: If information already exists in the Functional Document (FD),
refer to FD instead of duplicating content.

Example:
- "Refer to FD Section 2.3 for detailed validation rules"
- "See FD Appendix A for complete field list"
- "Error codes are documented in FD Section 4.5"
-->

---

## Version History

| Version | Updated By    | Date         | Changes             |
| ------- | ------------- | ------------ | ------------------- |
| v1.0    | [Author Name] | [DD/MM/YYYY] | Document Initiation |

---

## Table of Content

| Section | Content                                             | Pages |
| ------- | --------------------------------------------------- | ----- |
| 1       | Processing Furnished Hirer and Driver from eService | [X]   |
| 1.1     | Use Case                                            | [X]   |
| 1.2     | Sync Furnish Cron                                   | [X]   |
| 1.2.1   | Data Mapping                                        | [X]   |
| 1.2.2   | Success Outcome                                     | [X]   |
| 1.2.3   | Error Handling                                      | [X]   |
| 1.3     | Auto-Approval Review                                | [X]   |
| 1.3.1   | Data Mapping                                        | [X]   |
| 1.3.2   | Success Outcome                                     | [X]   |
| 1.3.3   | Error Handling                                      | [X]   |
| 1.4     | Manual OIC Review                                   | [X]   |
| 1.4.1   | API Specification                                   | [X]   |
| 1.4.2   | Data Mapping                                        | [X]   |
| 1.4.3   | Success Outcome                                     | [X]   |
| 1.4.4   | Error Handling                                      | [X]   |
| 1.5     | Update Internet Outcome                             | [X]   |
| 1.5.1   | Data Mapping                                        | [X]   |
| 1.5.2   | Success Outcome                                     | [X]   |
| 1.5.3   | Error Handling                                      | [X]   |
| 2       | Staff Portal Manual Review                          | [X]   |
| 2.1     | Use Case                                            | [X]   |
| 2.2     | Manual Review High-Level Flow                       | [X]   |
| 2.3     | Email Report Cron                                   | [X]   |
| 2.4     | List Furnished Applications                         | [X]   |
| 2.4.1   | Default Page Behaviour                              | [X]   |
| 2.4.2   | Search Submissions                                  | [X]   |
| 2.4.3   | Check Furnishability                                | [X]   |
| 2.5     | Get Application Detail                              | [X]   |
| 2.6     | Approve Furnished Submission                        | [X]   |
| 2.7     | Reject Furnished Submission                         | [X]   |
| 3       | Staff Portal Manual Furnish or Update               | [X]   |
| 3.1     | Use Case                                            | [X]   |
| 3.2     | High-Level Furnish/Update Flow                      | [X]   |
| 3.3     | Action Button Check                                 | [X]   |
| 3.4     | Furnish Offender                                    | [X]   |
| 3.5     | Redirect Notice                                     | [X]   |
| 3.6     | Update Particulars                                  | [X]   |
| 4       | Batch Furnish and Batch Update                      | [X]   |
| 4.1     | Use Case                                            | [X]   |
| 4.2     | Batch Furnish Offender                              | [X]   |
| 4.3     | Batch Update Mailing Address                        | [X]   |
| 4.3.1   | Retrieve Outstanding Notices                        | [X]   |
| 5       | PLUS External System Integration                    | [X]   |
| 5.1     | Use Case                                            | [X]   |
| 5.2     | PLUS Update Hirer/Driver                            | [X]   |
| 5.3     | PLUS Redirect                                       | [X]   |

---

# Section 1 – Processing Furnished Hirer and Driver from eService

## 1.1 Use Case

1. The OCMS Intranet supports the Furnish Hirer/Driver eService Portal through the following key functions:Notice Synchronisation: Sync offence notice details from the OCMS Intranet to the Online Portal, enabling vehicle owners or hirers to furnish the driver or hirer particulars for their offences.
2. Furnished Submission Processing: Manage the processing workflow to determine whether furnished particulars can be auto-approved, require manual review, or must be re-submitted.T
3. he end-to-end workflow comprises the following steps:Submission Retrieval: The OCMS retrieves furnished particulars and any supporting documents submitted via the Online Portal for validation.
4. Auto-Approval Validation: OCMS validates each submission against pre-defined business rules to determine whether it qualifies for automatic approval or should be routed for officer review.
5. Manual Review and Decision: Submissions that cannot be auto-approved are routed to the OCMS Staff Portal, where Officers-in-Charge (OICs) review the details and decide whether to approve or reject them.
6. Status Synchronisation: Once a decision is made, OCMS updates the Online Portal so that vehicle owners or hirers can view the approval or rejection outcomes of their submissions.

### Transaction Number (txn_no) Generation

The `txn_no` is the primary key for furnish application records, generated when motorist submits via eService.

| Property     | Value                                  |
| ------------ | -------------------------------------- |
| Format       | `FA` + `YYYYMMDD` + `XXX`        |
| Example      | `FA202601070001`, `FA202601070002` |
| Prefix       | `FA` (Furnish Application)           |
| Date         | 8 digits (YYYYMMDD)                    |
| Sequence     | 3-4 digits, daily reset                |
| Total Length | 14-15 characters                       |
| Data Type    | varchar(20)                            |

**Generation Logic:**

1. Prefix with "FA"
2. Append current date in YYYYMMDD format
3. Append daily sequence number (resets to 001 each day)
4. Sequence generated using SQL Server sequence

---

## 1.2 Sync Furnish Cron

<!-- Insert flow diagram here -->

![Flow Diagram](./Section 1/images/1.2_Sync_Furnish_Cron.png)

NOTE: Due to page size limit, the full-sized image is appended.

| Step                                       | Description                                                                                   | Brief Description      |
| ------------------------------------------ | --------------------------------------------------------------------------------------------- | ---------------------- |
| Cron Trigger                               | Scheduled trigger runs every 5 minutes                                                        | Job scheduled          |
| Check ShedLock for existing job            | Query ocms_shedlock table to check if another job instance is running                         | Check job lock         |
| Acquire job lock                           | Lock the job to prevent concurrent execution                                                  | Acquire lock           |
| Query Internet DB for unsynced submissions | Fetch submissions with is_sync = 'N' and status = 'P' from Internet DB                        | Query unsynced records |
| For each submission: save to Intranet DB   | Insert furnished submission record to Intranet DB                                             | Save to Intranet       |
| Mark submission as synced in Internet DB   | Update is_sync = 'Y' in Internet DB                                                           | Mark as synced         |
| Sync attachment metadata to Intranet       | Copy document metadata from Internet to Intranet DB                                           | Sync documents         |
| Process Auto Approval rules                | Run auto-approval validation checks on synced submissions                                     | Process auto-approval  |
| Check for errors                           | Verify if any errors occurred during processing                                               | Check errors           |
| Send error notification email              | If errors found, send notification to support team                                            | Send error email       |
| Log job status to application log          | Record job execution status to application log (not batch table, per frequent sync guideline) | Log job status         |
| Release job lock                           | Release the ShedLock after job completion                                                     | Release lock           |

### Job Configuration

| Setting       | Value                   |
| ------------- | ----------------------- |
| Schedule      | Every 5 minutes         |
| Component     | ocmsadmincron           |
| ShedLock Name | sync_furnish_submission |

### 1.2.1 Data Mapping

| Zone | Database Table | Field Name | Value |
| ---- | -------------- | ---------- | ----- |
| Intranet | ocms_shedlock | name | sync_furnish_submission |
| Intranet | ocms_shedlock | lock_until | 2026-01-20 10:05:00 |
| Intranet | ocms_shedlock | locked_at | 2026-01-20 10:00:00 |
| Intranet | ocms_shedlock | locked_by | ocmsadmincron-instance-1 |
| Internet | eocms_furnish_application | is_sync | Y |
| Internet | eocms_furnish_application | upd_date | 2026-01-20 10:00:05 |
| Internet | eocms_furnish_application | upd_user_id | ocmsiz_app_conn |
| Intranet | ocms_furnish_application | txn_no | FA202601070001 |
| Intranet | ocms_furnish_application | notice_no | 500500303J |
| Intranet | ocms_furnish_application | vehicle_no | SNC7392R |
| Intranet | ocms_furnish_application | offence_date | 2026-01-15 19:00:00 |
| Intranet | ocms_furnish_application | pp_code | M0028 |
| Intranet | ocms_furnish_application | pp_name | Magazine Road |
| Intranet | ocms_furnish_application | last_processing_stage | RD1 |
| Intranet | ocms_furnish_application | furnish_name | John Lee |
| Intranet | ocms_furnish_application | furnish_id_type | N |
| Intranet | ocms_furnish_application | furnish_id_no | S1234567A |
| Intranet | ocms_furnish_application | furnish_mail_blk_no | 71 |
| Intranet | ocms_furnish_application | furnish_mail_floor | 07 |
| Intranet | ocms_furnish_application | furnish_mail_street_name | BEDOK NORTH |
| Intranet | ocms_furnish_application | furnish_mail_unit_no | 21 |
| Intranet | ocms_furnish_application | furnish_mail_bldg_name | RESERVOIR RISE |
| Intranet | ocms_furnish_application | furnish_mail_postal_code | 470706 |
| Intranet | ocms_furnish_application | furnish_tel_code | 65 |
| Intranet | ocms_furnish_application | furnish_tel_no | 91234567 |
| Intranet | ocms_furnish_application | furnish_email_addr | john.lee@email.com |
| Intranet | ocms_furnish_application | owner_driver_indicator | D |
| Intranet | ocms_furnish_application | hirer_owner_relationship | F |
| Intranet | ocms_furnish_application | others_relationship_desc | null |
| Intranet | ocms_furnish_application | ques_one_ans | Yes |
| Intranet | ocms_furnish_application | ques_two_ans | Yes |
| Intranet | ocms_furnish_application | ques_three_ans | null |
| Intranet | ocms_furnish_application | rental_period_from | null |
| Intranet | ocms_furnish_application | rental_period_to | null |
| Intranet | ocms_furnish_application | owner_name | Tiger City Rentals Pte Ltd |
| Intranet | ocms_furnish_application | owner_id_no | 20051827M |
| Intranet | ocms_furnish_application | owner_tel_code | 65 |
| Intranet | ocms_furnish_application | owner_tel_no | 81234567 |
| Intranet | ocms_furnish_application | owner_email_addr | kenny@tigercity.com |
| Intranet | ocms_furnish_application | corppass_staff_name | Kenny Lim |
| Intranet | ocms_furnish_application | status | P |
| Intranet | ocms_furnish_application | reason_for_review | null |
| Intranet | ocms_furnish_application | remarks | null |
| Intranet | ocms_furnish_application | cre_date | 2026-01-20 10:00:05 |
| Intranet | ocms_furnish_application | cre_user_id | ocmsiz_app_conn |
| Intranet | ocms_furnish_application | upd_date | null |
| Intranet | ocms_furnish_application | upd_user_id | null |
| Intranet | ocms_furnish_application_doc | attachment_id | 1 |
| Intranet | ocms_furnish_application_doc | txn_no | FA202601070001 |
| Intranet | ocms_furnish_application_doc | notice_no | 500500303J |
| Intranet | ocms_furnish_application_doc | file_name | rental_agreement.pdf |
| Intranet | ocms_furnish_application_doc | mime | application/pdf |
| Intranet | ocms_furnish_application_doc | size | 102400 |
| Intranet | ocms_furnish_application_doc | cre_date | 2026-01-20 10:00:06 |
| Intranet | ocms_furnish_application_doc | cre_user_id | ocmsiz_app_conn |


### 1.2.2 Success Outcome

- All unsynced furnished submissions retrieved from Internet DB
- Submissions saved to Intranet DB successfully
- is_sync updated to 'Y' in Internet DB
- Attachment metadata synced to Intranet DB
- Auto-approval checks processed for all synced submissions
- Job status logged to application log

### 1.2.3 Error Handling

#### Application Error Handling

| Error Scenario      | Definition                                                        | Brief Description                 |
| ------------------- | ----------------------------------------------------------------- | --------------------------------- |
| Job Already Running | Another instance of sync job is already running (ShedLock locked) | Job skips execution, logs warning |
| No Records Found    | No unsynced submissions found in Internet DB                      | Job completes with no processing  |
| Connection Timeout  | Cannot connect to Internet database                               | Job fails, error logged           |

---

## 1.3 Auto-Approval Review

<!-- Insert flow diagram here -->

![Flow Diagram](./Section 1/images/1.3_Auto_Approval_Review.png)

NOTE: Due to page size limit, the full-sized image is appended.

| Step                                         | Description                                                           | Brief Description       |
| -------------------------------------------- | --------------------------------------------------------------------- | ----------------------- |
| Get synced submissions pending review        | Query Intranet DB for submissions with status = 'P' and is_sync = 'Y' | Get pending submissions |
| For each submission                          | Iterate through each submission for auto-approval checks              | Loop submissions        |
| Same ID type & ID No?                        | Check if furnished ID type and ID number match existing records       | Check ID match          |
| Furnished same ID within 30 days?            | Check if same ID was furnished within last 30 days                    | Check recent furnish    |
| Processing stage RD1?                        | Check if notice is at processing stage RD1                            | Check processing stage  |
| Mark for AUTO APPROVAL                       | Submission passes all checks, mark for auto-approval                  | Auto-approve            |
| Mark for MANUAL OIC REVIEW                   | Submission fails any check, route to manual review                    | Route to manual review  |
| Update status = A in Intranet                | Update submission status to 'A' (Approved) in Intranet DB             | Update status           |
| Insert into ocms_offence_notice_owner_driver | Create new offender record with furnished particulars                 | Create offender record  |
| Update processing stage                      | Update notice processing stage (DN for Driver, RD for Hirer)          | Update stage            |
| Update Internet DB outcome                   | Sync approval status to Internet DB                                   | Sync to Internet        |
| Send OIC notification email                  | For manual review cases, send email notification to OIC               | Notify OIC              |
| Aggregate results                            | Collect auto-approved and manual review counts                        | Aggregate results       |

### Auto-Approval Checks

| Check                            | Pass Condition                       | Fail Action            |
| -------------------------------- | ------------------------------------ | ---------------------- |
| Same ID type & ID No             | ID type and number match submission  | Route to Manual Review |
| Furnished same ID within 30 days | No same ID furnished in last 30 days | Route to Manual Review |
| Processing stage RD1             | Notice is at stage RD1               | Route to Manual Review |

### 1.3.1 Data Mapping

| Zone | Database Table | Field Name | Value |
| ---- | -------------- | ---------- | ----- |
| Intranet | ocms_furnish_application | status | A (Auto-approved) or P (Pending manual review) |
| Intranet | ocms_furnish_application | remarks | Auto Approved by SYSTEM |
| Intranet | ocms_furnish_application | upd_date | 2026-01-20 10:00:10 |
| Intranet | ocms_furnish_application | upd_user_id | ocmsiz_app_conn |
| Intranet | ocms_offence_notice_owner_driver | notice_no | 500500303J |
| Intranet | ocms_offence_notice_owner_driver | owner_driver_indicator | D |
| Intranet | ocms_offence_notice_owner_driver | id_type | N |
| Intranet | ocms_offence_notice_owner_driver | id_no | S1234567A |
| Intranet | ocms_offence_notice_owner_driver | name | John Lee |
| Intranet | ocms_offence_notice_owner_driver | offender_indicator | Y |
| Intranet | ocms_offence_notice_owner_driver | cre_date | 2026-01-20 10:00:10 |
| Intranet | ocms_offence_notice_owner_driver | cre_user_id | ocmsiz_app_conn |
| Intranet | ocms_valid_offence_notice | last_processing_stage | DN (Driver) or RD2 (Hirer) |
| Intranet | ocms_valid_offence_notice | upd_date | 2026-01-20 10:00:10 |
| Intranet | ocms_valid_offence_notice | upd_user_id | ocmsiz_app_conn |
| Internet | eocms_furnish_application | status | A (Auto-approved) or P (Pending) |
| Internet | eocms_furnish_application | upd_date | 2026-01-20 10:00:11 |
| Internet | eocms_furnish_application | upd_user_id | ocmsiz_app_conn |

### 1.3.2 Success Outcome

- All synced submissions reviewed for auto-approval criteria
- Qualifying submissions auto-approved (status = 'A')
- Offender records created for auto-approved submissions
- Processing stage updated appropriately
- Non-qualifying submissions routed to manual review
- OIC notified via email for pending manual reviews

### 1.3.3 Error Handling

| Error Scenario                 | Definition                                                  | Brief Description                      |
| ------------------------------ | ----------------------------------------------------------- | -------------------------------------- |
| Offender Record Insert Failed  | Unable to create record in ocms_offence_notice_owner_driver | Add to error list, continue processing |
| Processing Stage Update Failed | Unable to update notice processing stage                    | Add to error list, continue processing |
| Internet DB Update Failed      | Unable to sync outcome to Internet DB                       | Retry x3, then log error               |

---

## 1.4 Manual OIC Review

<!-- Insert flow diagram here -->

![Flow Diagram](./Section 1/images/1.4_Manual_OIC_Review.png)

NOTE: Due to page size limit, the full-sized image is appended.

| Step                                                          | Description                                                      | Brief Description      |
| ------------------------------------------------------------- | ---------------------------------------------------------------- | ---------------------- |
| Staff portal view pending submission dashboard                | OIC views list of pending submissions requiring manual review    | View dashboard         |
| Select submission to review                                   | OIC selects a submission from the list to review details         | Select submission      |
| Display review form with submission details                   | System displays submission details with editable fields          | Display form           |
| View supporting documents                                     | OIC views uploaded supporting documents (rental agreement, etc.) | View documents         |
| OIC select decision (Approve Hirer / Approve Driver / Reject) | OIC makes approval or rejection decision                         | Select decision        |
| Enter remarks (optional)                                      | OIC enters optional remarks for the decision                     | Enter remarks          |
| Select notification (Email/SMS)                               | OIC selects notification method for owner/furnished person       | Select notification    |
| Submit decision                                               | OIC submits the decision to backend                              | Submit decision        |
| Validate request                                              | Backend validates request format and required fields             | Validate request       |
| Check submission status = P                                   | Verify submission is still pending (not already processed)       | Check status           |
| Update status = A or R                                        | Update submission status to Approved or Rejected                 | Update status          |
| Insert into ocms_offence_notice_owner_driver                  | For approval: create offender record with furnished particulars  | Create offender record |
| Set offender_indicator = Y                                    | Mark new offender as current offender                            | Set current offender   |
| Update processing stage                                       | Update notice stage (DN for Driver, RD for Hirer)                | Update stage           |
| Revive TS-PDP suspension                                      | Revive temporary suspension after approval                       | Revive suspension      |
| Keep TS-PDP active                                            | For rejection: keep suspension active for resubmission           | Keep suspension        |
| Resend notice to eService                                     | For rejection: sync notice back to allow resubmission            | Resend notice          |
| Send email/SMS notification                                   | Send notification to owner and/or furnished person               | Send notification      |
| Update Internet DB outcome                                    | Sync decision outcome to Internet DB                             | Sync to Internet       |
| Display success message                                       | Show confirmation message to OIC                                 | Display success        |

### 1.4.1 API Specification

#### API List Pending Submissions

| Field            | Value                                                                                        |
| ---------------- | -------------------------------------------------------------------------------------------- |
| API Name         | List Pending Submissions                                                                     |
| URL              | UAT: https://[domain]/api/furnish/pending `<br>` PRD: https://[domain]/api/furnish/pending |
| Description      | Get list of pending furnished submissions for OIC review                                     |
| Method           | POST                                                                                         |
| Header           | `{ "Authorization": "Bearer [token]", "Content-Type": "application/json" }`                |
| Payload          | `{ "$skip": 0, "$limit": 10 }`                                                             |
| Response         | `{ "total": 100, "limit": 10, "skip": 0, "data": [...] }`                                  |
| Response (Empty) | `{ "total": 0, "limit": 10, "skip": 0, "data": [] }`                                       |

#### API Get Submission Detail

| Field            | Value                                                                                      |
| ---------------- | ------------------------------------------------------------------------------------------ |
| API Name         | Get Submission Detail                                                                      |
| URL              | UAT: https://[domain]/api/furnish/detail `<br>` PRD: https://[domain]/api/furnish/detail |
| Description      | Get detailed view of a furnished submission                                                |
| Method           | POST                                                                                       |
| Header           | `{ "Authorization": "Bearer [token]", "Content-Type": "application/json" }`              |
| Payload          | `{ "txnNo": "FH202601070001" }`                                                          |
| Response         | `{ "data": { "appCode": "OCMS-2000", "message": "Success", ... } }`                      |
| Response Failure | `{ "data": { "appCode": "OCMS-4004", "message": "Not found" } }`                         |

#### API Approve Submission

| Field                   | Value                                                                                                                                                     |
| ----------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------- |
| API Name                | Approve Furnished Submission                                                                                                                              |
| URL                     | POST /${api.version}/furnish/officer/approve                                                                                                              |
| Description             | Approve a furnished submission and create offender record                                                                                                 |
| Request (Approve Hirer) | `{ "txnNo": "FA202601070001", "ownerDriverIndicator": "H", "remarks": "Documents verified, rental agreement valid", "sendEmail": true, "sendSms": false }` |
| Request (Approve Driver)| `{ "txnNo": "FA202601070001", "ownerDriverIndicator": "D", "remarks": "Driver identity confirmed", "sendEmail": true, "sendSms": true }`                  |
| Response (Success)      | `{ "data": { "appCode": "OCMS-2000", "message": "Submission approved successfully", "txnNo": "FA202601070001", "noticeNo": "500500303J", "newStatus": "A", "offenderCreated": true, "newProcessingStage": "RD1" } }` |
| Response (Failure)      | `{ "data": { "appCode": "OCMS-4001", "message": "Submission already processed", "txnNo": "FA202601070001", "currentStatus": "A" } }`                      |

#### API Reject Submission

| Field              | Value                                                                                                                                                                       |
| ------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| API Name           | Reject Furnished Submission                                                                                                                                                 |
| URL                | POST /${api.version}/furnish/officer/reject                                                                                                                                 |
| Description        | Reject a furnished submission for motorist to resubmit                                                                                                                      |
| Request            | `{ "txnNo": "FA202601070001", "remarks": "Supporting documents unclear, please resubmit with clearer copy", "sendEmail": true, "sendSms": false }`                          |
| Response (Success) | `{ "data": { "appCode": "OCMS-2000", "message": "Submission rejected successfully", "txnNo": "FA202601070001", "noticeNo": "500500303J", "newStatus": "R", "resubmissionAllowed": true } }` |
| Response (Failure) | `{ "data": { "appCode": "OCMS-4001", "message": "Remarks is required for rejection", "txnNo": "FA202601070001" } }`                                                         |

### 1.4.2 Data Mapping

| Zone | Database Table | Field Name | Value |
| ---- | -------------- | ---------- | ----- |
| Intranet | ocms_furnish_application | status | A (Approved) or R (Rejected) |
| Intranet | ocms_furnish_application | remarks | Documents verified, approved |
| Intranet | ocms_furnish_application | upd_date | 2026-01-20 14:30:00 |
| Intranet | ocms_furnish_application | upd_user_id | ALICIATAN |
| Intranet | ocms_offence_notice_owner_driver | notice_no | 500500303J |
| Intranet | ocms_offence_notice_owner_driver | owner_driver_indicator | H |
| Intranet | ocms_offence_notice_owner_driver | id_type | N |
| Intranet | ocms_offence_notice_owner_driver | id_no | S1234567A |
| Intranet | ocms_offence_notice_owner_driver | name | John Lee |
| Intranet | ocms_offence_notice_owner_driver | offender_indicator | Y |
| Intranet | ocms_offence_notice_owner_driver | cre_date | 2026-01-20 14:30:00 |
| Intranet | ocms_offence_notice_owner_driver | cre_user_id | ALICIATAN |
| Internet | eocms_furnish_application | status | A (Approved) or R (Rejected) |
| Internet | eocms_furnish_application | remarks | Documents verified, approved |
| Internet | eocms_furnish_application | upd_date | 2026-01-20 14:30:01 |
| Internet | eocms_furnish_application | upd_user_id | ocmsiz_app_conn |

### 1.4.3 Success Outcome

- OIC successfully reviews and makes decision on submission
- For Approval:
  - Submission status updated to 'A' in Intranet DB
  - Offender record created with offender_indicator = 'Y'
  - Processing stage updated (DN for Driver, RD for Hirer)
  - TS-PDP suspension revived
  - Outcome synced to Internet DB
- For Rejection:
  - Submission status updated to 'R' in Intranet DB
  - TS-PDP suspension kept active
  - Notice resent to eService for motorist resubmission
  - Outcome synced to Internet DB
- Notifications sent as per OIC selection

### 1.4.4 Error Handling

#### Application Error Handling

| Error Scenario            | Definition                                               | Brief Description                                          |
| ------------------------- | -------------------------------------------------------- | ---------------------------------------------------------- |
| Validation Failed         | Request validation failed (missing required fields)      | Return error response, display error message               |
| Already Processed         | Submission status is not 'P' (already approved/rejected) | Return error response, display "already processed" message |
| Internet DB Update Failed | Unable to sync outcome to Internet DB                    | Retry x3, log error if all retries fail                    |

#### API Error Handling

| Error Scenario       | App Error Code | User Message                                  | Brief Description                  |
| -------------------- | -------------- | --------------------------------------------- | ---------------------------------- |
| Validation Failed    | OCMS-4001      | Validation failed                             | Request validation error           |
| Not Found            | OCMS-4004      | Submission not found                          | Transaction number not found       |
| Already Processed    | OCMS-4009      | Submission already processed                  | Cannot modify processed submission |
| General Server Error | OCMS-5000      | Something went wrong. Please try again later. | Server error                       |

---

## 1.5 Update Internet Outcome

<!-- Insert flow diagram here -->

![Flow Diagram](./Section 1/images/1.5_Update_Internet_Outcome.png)

NOTE: Due to page size limit, the full-sized image is appended.

| Step                             | Description                                                    | Brief Description |
| -------------------------------- | -------------------------------------------------------------- | ----------------- |
| Receive outcome data             | Receive approved/rejected submission data from calling process | Receive data      |
| Connect to Internet DB           | Establish database connection to Internet zone                 | Connect to DB     |
| Retry x3                         | If connection fails, retry up to 3 times                       | Retry connection  |
| Update eocms_furnish_application | Update status, reason_for_review, remarks in Internet DB       | Update record     |
| Retry x3                         | If update fails, retry up to 3 times                           | Retry update      |
| Commit transaction               | Persist changes to Internet DB                                 | Commit changes    |
| Log error                        | If all retries fail, log error details                         | Log error         |
| Return success                   | Return success status to calling process                       | Return success    |
| Return error                     | Return error status to calling process                         | Return error      |

### 1.5.1 Data Mapping

**eocms_furnish_application (Internet) - UPDATE**

| Zone | Database Table | Field Name | Value |
| ---- | -------------- | ---------- | ----- |
| Internet | eocms_furnish_application | status | A (Approved) or R (Rejected) |
| Internet | eocms_furnish_application | reason_for_review | Auto-approval check failed: Prior submission exists |
| Internet | eocms_furnish_application | remarks | Documents verified, approved |
| Internet | eocms_furnish_application | upd_date | 2026-01-20 14:30:01 |
| Internet | eocms_furnish_application | upd_user_id | ocmsiz_app_conn |

### 1.5.2 Success Outcome

- Connection to Internet DB established successfully
- Submission status updated (A = Approved, R = Rejected)
- Reason for review and remarks synced
- Audit fields updated (upd_date, upd_user_id)
- Transaction committed successfully
- Motorist can view outcome in eService portal

### 1.5.3 Error Handling

| Error Scenario    | Definition                                       | Brief Description              |
| ----------------- | ------------------------------------------------ | ------------------------------ |
| Connection Failed | Unable to connect to Internet DB after 3 retries | Log error, return error status |
| Update Failed     | Unable to update record after 3 retries          | Log error, return error status |

---

# Section 2 – Staff Portal Manual Review

## 2.1 Use Case

1. Furnished submissions that cannot be auto approved will be routed to OICs for manual review.
2. OICs will be alerted to these submissions via an email that will be sent at 9am.
3. They can then review the submissions via the Staff Portal to decide whether the submissions can be approved or should be rejected.

---

## 2.2 Manual Review High-Level Flow

<!-- Insert flow diagram here -->

![Flow Diagram](./Section 2/images/2.2_Manual_Review_HL.png)

NOTE: Due to page size limit, the full-sized image is appended.

| Step                                     | Description                                                                   | Brief Description    |
| ---------------------------------------- | ----------------------------------------------------------------------------- | -------------------- |
| OIC receives email notification          | Daily cron sends email with pending submission count                          | Email notification   |
| OIC login to Staff Portal                | OIC accesses Staff Portal with credentials                                    | Login                |
| View Furnished Hirer/Driver Summary List | Display list of pending submissions                                           | View list            |
| Search/Filter submissions                | OIC applies filters (status, notice no, vehicle no, date range)               | Search/Filter        |
| Select submission to review              | OIC clicks on a submission row to view details                                | Select submission    |
| View submission details                  | System displays notice info, submitter info, furnished person info, documents | View details         |
| Notice still furnishable?                | System checks if notice is still at furnishable stage                         | Check furnishability |
| Display prompt: Not furnishable          | If not furnishable, show warning but allow decision                           | Show warning         |
| OIC select decision                      | OIC chooses Approve Hirer, Approve Driver, or Reject                          | Select decision      |
| Enter remarks (optional)                 | OIC enters optional remarks for audit trail                                   | Enter remarks        |
| Send Email/SMS?                          | OIC decides whether to send notification                                      | Notification choice  |
| Compose Email/SMS message                | OIC selects template or enters custom message                                 | Compose message      |
| Review Summary page                      | OIC reviews all selections before submission                                  | Review summary       |
| Submit decision                          | OIC confirms and submits the decision                                         | Submit               |
| Validate request                         | Backend validates request format and required fields                          | Validate             |
| Query application by txnNo               | Retrieve submission from database                                             | Query DB             |
| Status = P or S?                         | Verify submission is still pending or resubmission                            | Check status         |
| Approve or Reject?                       | Branch based on OIC decision                                                  | Decision branch      |
| Update status = A                        | For approval: update status to Approved                                       | Update status        |
| Create H/D record                        | Insert new record in ocms_offence_notice_owner_driver                         | Create record        |
| Set current offender                     | Set offender_indicator = 'Y'                                                  | Set offender         |
| Update processing stage                  | Update notice stage (RD for Hirer, DN for Driver)                             | Update stage         |
| Revive TS-PDP suspension                 | Revive temporary suspension                                                   | Revive suspension    |
| Update status = R                        | For rejection: update status to Rejected                                      | Update status        |
| Keep TS-PDP active                       | Keep suspension active for resubmission                                       | Keep suspension      |
| Resend notice to eService                | Sync notice back to Internet for resubmission                                 | Resend notice        |
| Sync to Internet DB                      | Update eocms_furnish_application with outcome                                 | Sync to Internet     |
| Send notification?                       | Check if notification should be sent                                          | Check notification   |
| Send Email/SMS                           | Send notification to owner and/or furnished person                            | Send notification    |
| Return success response                  | Return success status to frontend                                             | Return success       |
| Display success message                  | Show confirmation message to OIC                                              | Display success      |

### Decision Points

| Decision                  | Yes Path                      | No Path                          |
| ------------------------- | ----------------------------- | -------------------------------- |
| Notice still furnishable? | Proceed to decision selection | Display warning, allow proceed   |
| Send Email/SMS?           | Compose message               | Skip to review summary           |
| Valid request?            | Continue processing           | Return validation error          |
| Status = P or S?          | Continue processing           | Return "already processed" error |
| Approve or Reject?        | Approve path                  | Reject path                      |
| Send notification?        | Send Email/SMS                | Skip notification                |

### 2.2.1 Data Mapping

| Zone | Database Table | Field Name | Value |
| ---- | -------------- | ---------- | ----- |
| Intranet | ocms_furnish_application | status | A (Approved) or R (Rejected) |
| Intranet | ocms_furnish_application | remarks | Documents verified |
| Intranet | ocms_furnish_application | upd_date | 2026-01-20 14:30:00 |
| Intranet | ocms_furnish_application | upd_user_id | ALICIATAN |
| Intranet | ocms_offence_notice_owner_driver | notice_no | 500500303J |
| Intranet | ocms_offence_notice_owner_driver | owner_driver_indicator | H |
| Intranet | ocms_offence_notice_owner_driver | id_type | N |
| Intranet | ocms_offence_notice_owner_driver | id_no | S1234567A |
| Intranet | ocms_offence_notice_owner_driver | name | John Lee |
| Intranet | ocms_offence_notice_owner_driver | offender_indicator | Y |
| Intranet | ocms_offence_notice_owner_driver | cre_date | 2026-01-20 14:30:00 |
| Intranet | ocms_offence_notice_owner_driver | cre_user_id | ALICIATAN |
| Intranet | ocms_offence_notice_owner_driver_addr | notice_no | 500500303J |
| Intranet | ocms_offence_notice_owner_driver_addr | owner_driver_indicator | H |
| Intranet | ocms_offence_notice_owner_driver_addr | type_of_address | M |
| Intranet | ocms_offence_notice_owner_driver_addr | blk_hse_no | 71 |
| Intranet | ocms_offence_notice_owner_driver_addr | street_name | BEDOK NORTH |
| Intranet | ocms_offence_notice_owner_driver_addr | postal_code | 470706 |
| Intranet | ocms_offence_notice_owner_driver_addr | cre_date | 2026-01-20 14:30:00 |
| Intranet | ocms_offence_notice_owner_driver_addr | cre_user_id | ALICIATAN |
| Intranet | ocms_valid_offence_notice | last_processing_stage | RD2 |
| Intranet | ocms_valid_offence_notice | is_sync | N |
| Intranet | ocms_valid_offence_notice | upd_date | 2026-01-20 14:30:00 |
| Intranet | ocms_valid_offence_notice | upd_user_id | ALICIATAN |
| Internet | eocms_furnish_application | status | A (Approved) or R (Rejected) |
| Internet | eocms_furnish_application | reason_for_review | null |
| Internet | eocms_furnish_application | remarks | Documents verified |
| Internet | eocms_furnish_application | upd_date | 2026-01-20 14:30:01 |
| Internet | eocms_furnish_application | upd_user_id | ocmsiz_app_conn |
| Internet | eocms_offence_notice_owner_driver | notice_no | 500500303J |
| Internet | eocms_offence_notice_owner_driver | owner_driver_indicator | H |
| Internet | eocms_offence_notice_owner_driver | id_no | S1234567A |
| Internet | eocms_offence_notice_owner_driver | offender_indicator | Y |
| Internet | eocms_offence_notice_owner_driver | cre_date | 2026-01-20 14:30:01 |
| Internet | eocms_offence_notice_owner_driver | cre_user_id | ocmsiz_app_conn |

### 2.2.2 Success Outcome

- OIC successfully completes manual review workflow
- Submission status updated in both Intranet and Internet DB
- For Approval: H/D record created, processing stage updated, suspension revived
- For Rejection: Suspension kept active, notice available for resubmission
- Notifications sent to relevant parties

### 2.2.3 Error Handling

| Error Scenario      | Definition                           | Brief Description                  |
| ------------------- | ------------------------------------ | ---------------------------------- |
| Validation Failed   | Missing required fields in request   | Return validation error            |
| Already Processed   | Submission already approved/rejected | Return business error              |
| DB Update Failed    | Database operation failed            | Return server error                |
| Notification Failed | Email/SMS send failed                | Log error, continue (non-blocking) |

---

## 2.3 Email Report Cron

<!-- Insert flow diagram here -->

![Flow Diagram](./Section 2/images/2.3_Email_Report_Cron.png)

NOTE: Due to page size limit, the full-sized image is appended.

| Step                                | Description                                           | Brief Description |
| ----------------------------------- | ----------------------------------------------------- | ----------------- |
| Cron Trigger                        | Scheduled trigger runs daily at configured time       | Job scheduled     |
| Check ShedLock                      | Query ocms_shedlock to prevent concurrent execution   | Check job lock    |
| Query pending submissions count     | Count submissions with status = 'P' or 'S' | Count pending     |
| Pending count > 0?                  | Check if there are submissions requiring review       | Check count       |
| Compose email content               | Build email with pending count and dashboard link     | Compose email     |
| Send email to OIC distribution list | Send notification email to configured recipients      | Send email        |
| Log job status                      | Record job execution in ocms_batch_job                | Log status        |
| Release job lock                    | Release ShedLock after completion                     | Release lock      |

### Job Configuration

| Setting       | Value                                |
| ------------- | ------------------------------------ |
| Schedule      | Daily at 8:00 AM                     |
| Component     | ocmsadmincron                        |
| ShedLock Name | furnish_email_report                 |
| Recipients    | OIC distribution list (configurable) |

### 2.3.1 Data Mapping

**ocms_shedlock (Intranet) - UPDATE**

| Zone | Database Table | Field Name | Value |
| ---- | -------------- | ---------- | ----- |
| Intranet | ocms_shedlock | name | furnish_email_report |
| Intranet | ocms_shedlock | lock_until | 2026-01-20 08:05:00 |
| Intranet | ocms_shedlock | locked_at | 2026-01-20 08:00:00 |
| Intranet | ocms_shedlock | locked_by | ocmsadmincron-instance-1 |

**ocms_batch_job (Intranet) - INSERT**

| Zone | Database Table | Field Name | Value |
| ---- | -------------- | ---------- | ----- |
| Intranet | ocms_batch_job | name | furnish_email_report |
| Intranet | ocms_batch_job | run_status | SUCCESS |
| Intranet | ocms_batch_job | log_text | Email sent: 5 pending submissions |
| Intranet | ocms_batch_job | cre_date | 2026-01-20 08:00:15 |
| Intranet | ocms_batch_job | cre_user_id | ocmsiz_app_conn |

### 2.3.2 Success Outcome

- Job executes daily at scheduled time
- Email sent to OIC distribution list with pending submission count
- Job status logged as 'Success'

### 2.3.3 Error Handling

| Error Scenario         | Definition                              | Brief Description                        |
| ---------------------- | --------------------------------------- | ---------------------------------------- |
| Job Already Running    | ShedLock indicates concurrent execution | Skip execution, log warning              |
| Email Send Failed      | Unable to send email notification       | Log error, mark job as failed            |
| No Pending Submissions | Count = 0                               | Skip email, log "no pending submissions" |

---

## 2.4 List Furnished Applications

<!-- Insert flow diagram here -->

![Flow Diagram](./Section 2/images/2.4_List_Applications.png)

NOTE: Due to page size limit, the full-sized image is appended.

| Step                      | Description                                      | Brief Description |
| ------------------------- | ------------------------------------------------ | ----------------- |
| Receive list request      | API receives POST request with filter parameters | Receive request   |
| Validate request          | Validate filter parameters and pagination        | Validate          |
| Build query               | Construct SQL query with filters                 | Build query       |
| Execute query             | Run query against ocms_furnish_application       | Execute query     |
| Map results               | Transform database results to response DTO       | Map results       |
| Return paginated response | Return total count and data array                | Return response   |

### 2.4.1 API Specification

| Field            | Value                                                                                                                                                                                                                                                                                                               |
| ---------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| API Name         | List Furnished Applications                                                                                                                                                                                                                                                                                         |
| URL              | POST /${api.version}/furnish/officer/list                                                                                                                                                                                                                                                                           |
| Description      | Lists furnished applications with optional filters for OIC dashboard                                                                                                                                                                                                                                                |
| Request          | `{ "statuses": ["P", "S"], "noticeNo": "500500303J", "vehicleNo": "SNC7392R", "furnishIdNo": "S1234567A", "submissionDateFrom": "2025-01-01T00:00:00", "submissionDateTo": "2025-12-31T23:59:59", "page": 0, "pageSize": 10, "sortBy": "submissionDate", "sortDirection": "DESC" }`                                 |
| Response         | `{ "total": 100, "limit": 10, "skip": 0, "data": [{ "txnNo": "FH202601070001", "noticeNo": "500500303J", "vehicleNo": "SNC7392R", "offenceDateTime": "2025-07-10T08:26:00", "processingStage": "RD1", "status": "P", "submissionDateTime": "2025-08-04T17:41:00", "submitterName": "JOHN LEE", ... }] }`           |
| Response (Empty) | `{ "total": 0, "limit": 10, "skip": 0, "data": [] }`                                                                                                                                                                                                                                                                |
| Response Failure | `{ "data": { "appCode": "OCMS-4001", "message": "Invalid date range", "details": "submissionDateFrom cannot be after submissionDateTo" } }`                                                                                                                                                                         |

### 2.4.2 Data Mapping

**ocms_furnish_application (Intranet) - SELECT**

| Zone | Database Table | Field Name | Value |
| ---- | -------------- | ---------- | ----- |
| Intranet | ocms_furnish_application | txn_no | FA202601070001 |
| Intranet | ocms_furnish_application | notice_no | 500500303J |
| Intranet | ocms_furnish_application | vehicle_no | SNC7392R |
| Intranet | ocms_furnish_application | offence_date | 2026-01-15 19:00:00 |
| Intranet | ocms_furnish_application | status | P |
| Intranet | ocms_furnish_application | cre_date | 2026-01-20 10:00:05 |
| Intranet | ocms_furnish_application | owner_name | Tiger City Rentals Pte Ltd |
| Intranet | ocms_furnish_application | furnish_name | John Lee |
| Intranet | ocms_furnish_application | owner_driver_indicator | D |
| Intranet | ocms_furnish_application | reason_for_review | HST ID |
| Intranet | ocms_furnish_application | last_processing_stage | RD1 |

### 2.4.3 Success Outcome

- Paginated list of furnished applications returned
- Results filtered based on provided parameters
- Total count returned for pagination

### 2.4.4 Error Handling

| Error Scenario     | App Error Code | User Message         | Brief Description         |
| ------------------ | -------------- | -------------------- | ------------------------- |
| Invalid Date Range | OCMS-4001      | Invalid date range   | From date after to date   |
| Invalid Page Size  | OCMS-4001      | Invalid page size    | Page size exceeds maximum |
| Server Error       | OCMS-5000      | Something went wrong | Database query failed     |

---

## 2.4.1 Default Page Behaviour

<!-- Insert flow diagram here -->

![Flow Diagram](./Section 2/images/2.4.1_Default_Page_Behaviour.png)

NOTE: Due to page size limit, the full-sized image is appended.

| Step                | Description                                | Brief Description |
| ------------------- | ------------------------------------------ | ----------------- |
| Page Load           | User navigates to Furnished H/D dashboard  | Page load         |
| Set default filters | Set status filter to ['P', 'S'] | Set defaults      |
| Set default sort    | Sort by submissionDate DESC                | Set sort          |
| Call List API       | Fetch first page of results                | Fetch data        |
| Display results     | Render table with pagination               | Display table     |

### Default Configuration

| Setting        | Default Value         |
| -------------- | --------------------- |
| Status Filter  | ['P', 'S'] |
| Sort By        | submissionDate        |
| Sort Direction | DESC                  |
| Page Size      | 10                    |

---

## 2.4.2 Search Submissions

<!-- Insert flow diagram here -->

![Flow Diagram](./Section 2/images/2.4.2_Search_Submissions.png)

NOTE: Due to page size limit, the full-sized image is appended.

| Step                        | Description                             | Brief Description |
| --------------------------- | --------------------------------------- | ----------------- |
| User enters search criteria | OIC enters filter values in search form | Enter criteria    |
| Validate input              | Frontend validates input format         | Validate          |
| Build filter object         | Construct filter parameters             | Build filters     |
| Call List API with filters  | Send request with filter parameters     | Call API          |
| Display filtered results    | Update table with search results        | Display results   |
| No results found            | Show "no results" message if empty      | Handle empty      |

### Search Fields

| Field                | Input Type   | Validation                 |
| -------------------- | ------------ | -------------------------- |
| Notice No            | Text         | Alphanumeric, max 20 chars |
| Vehicle No           | Text         | Alphanumeric, max 10 chars |
| Furnished ID         | Text         | Alphanumeric, max 20 chars |
| Status               | Multi-select | P, S, A, R      |
| Submission Date From | Date picker  | Valid date                 |
| Submission Date To   | Date picker  | Valid date, >= From date   |

---

## 2.4.3 Check Furnishability

<!-- Insert flow diagram here -->

![Flow Diagram](./Section 2/images/2.4.3_Check_Furnishability.png)

NOTE: Due to page size limit, the full-sized image is appended.

| Step                                   | Description                                                      | Brief Description    |
| -------------------------------------- | ---------------------------------------------------------------- | -------------------- |
| OIC clicks Notice Number               | OIC clicks notice number from summary list to view details       | Click notice         |
| Open new tab, load detail page         | System opens submission detail in new browser tab                | Open detail          |
| Call furnishability-check API          | Frontend calls API with txnNo and noticeNo                       | Call API             |
| Query submission details               | Backend retrieves submission from ocms_furnish_application       | Query submission     |
| CHECK 1: Active PS?                    | Check if notice has active Permanent Suspension                  | Check PS             |
| CHECK 2: Existing H/D in DB?           | Check if existing Hirer/Driver record exists                     | Check existing H/D   |
| CHECK 3: Furnished ID = existing H/D?  | Compare furnished ID with existing H/D record                    | Compare ID           |
| CHECK 4: Furnished role = same role?   | Check if furnished role matches existing role                    | Check role match     |
| CHECK 5: Owner is still current offender? | Verify Owner is still the current offender                    | Check current owner  |
| Build response with check results      | Aggregate all check results into response                        | Build response       |
| Display prompt message                 | Show warning/confirmation based on check results                 | Display prompt       |
| Display Submission Details screen      | Show detail screen with approve/reject options                   | Display details      |

### 2.4.3.1 API Specification

| Field              | Value                                                                                                                                                                       |
| ------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| API Name           | Check Furnishability                                                                                                                                                        |
| URL                | POST /${api.version}/furnish/officer/furnishability-check                                                                                                                   |
| Description        | Checks whether a furnished submission can be approved based on multiple validation rules                                                                                    |
| Request            | `{ "txnNo": "FA202601070001", "noticeNo": "500500303J" }`                                                                                                                   |
| Response (Pass)    | `{ "data": { "appCode": "OCMS-2000", "isFurnishable": true, "shouldReject": [], "checks": [{ "checkName": "PS_CHECK", "passed": true, "message": null }, { "checkName": "EXISTING_HD_CHECK", "passed": true, "message": null }, { "checkName": "ID_MATCH_CHECK", "passed": true, "message": null }, { "checkName": "ROLE_MATCH_CHECK", "passed": true, "message": null }, { "checkName": "CURRENT_OWNER_CHECK", "passed": true, "message": null }], "promptMessage": null } }` |
| Response (Warning) | `{ "data": { "appCode": "OCMS-2000", "isFurnishable": true, "shouldReject": ["ID_MISMATCH"], "checks": [{ "checkName": "PS_CHECK", "passed": true, "message": null }, { "checkName": "ID_MATCH_CHECK", "passed": false, "message": "Furnished ID does not match existing Hirer/Driver" }], "promptMessage": "Warning: Furnished ID does not match existing record. Proceed with caution." } }` |
| Response (Reject)  | `{ "data": { "appCode": "OCMS-2000", "isFurnishable": false, "shouldReject": ["PS_ACTIVE"], "checks": [{ "checkName": "PS_CHECK", "passed": false, "message": "Notice has active Permanent Suspension" }], "promptMessage": "This submission must be rejected because the notice has an active Permanent Suspension." } }` |

### Furnishability Checks

| Check Name           | Description                                      | Blocking | Action if Failed                    |
| -------------------- | ------------------------------------------------ | -------- | ----------------------------------- |
| PS_CHECK             | Check for active Permanent Suspension            | Yes      | Requires rejection                  |
| EXISTING_HD_CHECK    | Check if Notice has existing Hirer/Driver        | No       | Show prompt (info only)             |
| ID_MATCH_CHECK       | Check if Furnished ID matches existing H/D       | No       | Show warning prompt                 |
| ROLE_MATCH_CHECK     | Check if Furnished role matches existing role    | No       | Show warning prompt                 |
| CURRENT_OWNER_CHECK  | Check if Owner is still current offender         | No       | Show warning prompt                 |

### Furnishable Stages

| Stage | Description                        | Furnishable |
| ----- | ---------------------------------- | ----------- |
| ENA   | Enforcement Notice Acknowledgement | Yes         |
| RD1   | Reminder 1                         | Yes         |
| RD2   | Reminder 2                         | Yes         |
| RR3   | Reminder 3                         | Yes         |
| DN    | Driver Notice                      | No          |
| WO    | Warrant of Arrest                  | No          |

### 2.4.3.2 Data Mapping

| Zone     | Database Table                     | Field Name               | Value                    |
| -------- | ---------------------------------- | ------------------------ | ------------------------ |
| Intranet | ocms_furnish_application           | txn_no                   | FA202601070001           |
| Intranet | ocms_furnish_application           | notice_no                | 500500303J               |
| Intranet | ocms_furnish_application           | furnish_id_no            | S1234567A                |
| Intranet | ocms_furnish_application           | owner_driver_indicator   | D                        |
| Intranet | ocms_suspended_notice              | notice_no                | 500500303J               |
| Intranet | ocms_suspended_notice              | suspension_type          | PS                       |
| Intranet | ocms_suspended_notice              | date_of_revival          | NULL (active)            |
| Intranet | ocms_offence_notice_owner_driver   | notice_no                | 500500303J               |
| Intranet | ocms_offence_notice_owner_driver   | owner_driver_indicator   | H or D                   |
| Intranet | ocms_offence_notice_owner_driver   | id_no                    | S1234567A                |
| Intranet | ocms_offence_notice_owner_driver   | offender_indicator       | Y                        |

### 2.4.3.3 Success Outcome

- All furnishability checks executed successfully
- isFurnishable flag returned based on blocking checks
- Warning prompts displayed for non-blocking check failures
- OIC can proceed to approve/reject with full awareness of check results

### 2.4.3.4 Error Handling

| Error Scenario     | App Error Code | User Message                    | Brief Description            |
| ------------------ | -------------- | ------------------------------- | ---------------------------- |
| txnNo Required     | OCMS-4001      | Transaction number is required  | Missing txnNo in request     |
| noticeNo Required  | OCMS-4001      | Notice number is required       | Missing noticeNo in request  |
| Submission Not Found | OCMS-4004    | Furnished submission not found  | txnNo does not exist         |
| Notice Not Found   | OCMS-4004      | Notice not found                | noticeNo does not exist      |
| Server Error       | OCMS-5000      | Something went wrong            | Database query failed        |

---

## 2.5 Get Application Detail

<!-- Insert flow diagram here -->

![Flow Diagram](./Section 2/images/2.5_Get_Detail.png)

NOTE: Due to page size limit, the full-sized image is appended.

| Step                       | Description                        | Brief Description    |
| -------------------------- | ---------------------------------- | -------------------- |
| Receive detail request     | API receives request with txnNo    | Receive request      |
| Validate txnNo             | Check txnNo format and presence    | Validate             |
| Query application          | Fetch application by txn_no        | Query application    |
| Application found?         | Check if record exists             | Check exists         |
| Query notice details       | Fetch notice information           | Query notice         |
| Query supporting documents | Fetch attached documents           | Query documents      |
| Check furnishability       | Verify notice is still furnishable | Check furnishability |
| Build response             | Assemble complete detail response  | Build response       |
| Return detail response     | Return full application details    | Return response      |

### 2.5.1 API Specification

| Field              | Value                                                                                                                                                                       |
| ------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| API Name           | Get Application Detail                                                                                                                                                      |
| URL                | POST /${api.version}/furnish/officer/{txnNo}                                                                                                                                |
| Description        | Retrieves detailed view of a furnished application                                                                                                                          |
| Request            | `{ "txnNo": "FH202601070001" }`                                                                                                                                             |
| Response           | `{ "success": true, "data": { "txnNo": "FH202601070001", "noticeDetails": { "noticeNo": "500500303J", "vehicleNo": "SNC7392R", ... }, "submitterDetails": { ... }, "furnishedDetails": { ... }, "supportingDocuments": [...], "noticeStatus": { "isFurnishable": true, ... } } }` |
| Response (Failure) | `{ "data": { "appCode": "OCMS-4004", "message": "Furnished application not found", "txnNo": "FH202601070001" } }`                                                           |

### 2.5.2 Data Mapping

| Zone | Database Table | Field Name | Value |
| ---- | -------------- | ---------- | ----- |
| Intranet | ocms_furnish_application | txn_no | FA202601070001 |
| Intranet | ocms_furnish_application | notice_no | 500500303J |
| Intranet | ocms_furnish_application | owner_name | Tiger City Rentals Pte Ltd |
| Intranet | ocms_furnish_application | owner_id_no | 20051827M |
| Intranet | ocms_furnish_application | furnish_name | John Lee |
| Intranet | ocms_furnish_application | furnish_id_no | S1234567A |
| Intranet | ocms_furnish_application | furnish_id_type | N |
| Intranet | ocms_furnish_application | owner_driver_indicator | D |
| Intranet | ocms_furnish_application | status | P |
| Intranet | ocms_furnish_application | reason_for_review | HST ID |
| Intranet | ocms_valid_offence_notice | notice_no | 500500303J |
| Intranet | ocms_valid_offence_notice | vehicle_no | SNC7392R |
| Intranet | ocms_valid_offence_notice | pp_code | A0004 |
| Intranet | ocms_valid_offence_notice | pp_name | ALIWAL STREET |
| Intranet | ocms_valid_offence_notice | notice_date_and_time | 2026-01-15 08:26:00 |
| Intranet | ocms_valid_offence_notice | last_processing_stage | RD1 |
| Intranet | ocms_furnish_application_doc | attachment_id | 1 |
| Intranet | ocms_furnish_application_doc | txn_no | FA202601070001 |
| Intranet | ocms_furnish_application_doc | file_name | rental_agreement.pdf |
| Intranet | ocms_furnish_application_doc | mime | application/pdf |
| Intranet | ocms_furnish_application_doc | size | 2097152 |

### 2.5.3 Success Outcome

- Complete application details returned including notice, submitter, furnished person, and documents
- Furnishability status checked and returned

### 2.5.4 Error Handling

| Error Scenario | App Error Code | User Message                    | Brief Description     |
| -------------- | -------------- | ------------------------------- | --------------------- |
| txnNo Required | OCMS-4001      | Transaction number is required  | Missing txnNo         |
| Not Found      | OCMS-4004      | Furnished application not found | Record does not exist |
| Server Error   | OCMS-5000      | Something went wrong            | Database query failed |

---

## 2.6 Approve Furnished Submission

<!-- Insert flow diagram here -->

![Flow Diagram](./Section 2/images/2.6_Approve_Submission.png)

NOTE: Due to page size limit, the full-sized image is appended.

| Step                       | Description                                                            | Brief Description    |
| -------------------------- | ---------------------------------------------------------------------- | -------------------- |
| Receive approve request    | API receives approval request                                          | Receive request      |
| Validate request           | Validate required fields (txnNo, officerId)                            | Validate             |
| Query application          | Fetch application by txn_no                                            | Query application    |
| Check status = P or S      | Verify submission is pending or resubmission                           | Check status         |
| Update status = A          | Update ocms_furnish_application.status = 'A'                           | Update status        |
| Insert H/D record          | Create record in ocms_offence_notice_owner_driver                      | Insert H/D           |
| Insert H/D address         | Create address record in ocms_offence_notice_owner_driver_addr         | Insert address       |
| Set offender_indicator = Y | Mark as current offender                                               | Set offender         |
| Update processing stage    | Update notice stage (RD for Hirer, DN for Driver)                      | Update stage         |
| Revive TS-PDP suspension   | Revive temporary suspension for furnished person                       | Revive suspension    |
| Sync to Internet DB        | Update eocms_furnish_application and eocms_offence_notice_owner_driver | Sync Internet        |
| Send notifications?        | Check if email/SMS should be sent                                      | Check notification   |
| Send Email to Owner        | Send approval notification to owner                                    | Send owner email     |
| Send Email to Furnished    | Send notification to furnished person                                  | Send furnished email |
| Send SMS to Furnished      | Send SMS to furnished person                                           | Send SMS             |
| Return success             | Return success response                                                | Return success       |

### 2.6.1 API Specification

| Field              | Value                                                                                                                                                                       |
| ------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| API Name           | Approve Furnished Submission                                                                                                                                                |
| URL                | POST /${api.version}/furnish/officer/approve                                                                                                                                |
| Description        | Approves a furnished submission and adds the furnished person as Current Offender                                                                                           |
| Request            | `{ "txnNo": "FH202601070001", "officerId": "ALICIATAN", "sendEmailToOwner": true, "sendEmailToFurnished": true, "sendSmsToFurnished": false, "emailTemplateId": "APPROVED_HIRER_INDIVIDUAL", "remarks": "Approved as verified hirer" }` |
| Response (Success) | `{ "success": true, "txnNo": "FH202601070001", "noticeNo": "500500303J", "hirerDriverRecordUpdated": true, "suspensionRevived": true, "emailSentToOwner": true, "emailSentToFurnished": true, "smsSentToFurnished": false, "message": "Furnished submission approved successfully" }` |
| Response (Failure) | `{ "data": { "appCode": "OCMS-4009", "message": "Submission already processed", "txnNo": "FH202601070001", "currentStatus": "A" } }`                                        |

### 2.6.2 Data Mapping

| Zone | Database Table | Field Name | Value |
| ---- | -------------- | ---------- | ----- |
| Intranet | ocms_furnish_application | status | A |
| Intranet | ocms_furnish_application | remarks | Approved as verified hirer |
| Intranet | ocms_furnish_application | upd_date | 2026-01-20 14:30:00 |
| Intranet | ocms_furnish_application | upd_user_id | ALICIATAN |
| Intranet | ocms_offence_notice_owner_driver | notice_no | 500500303J |
| Intranet | ocms_offence_notice_owner_driver | owner_driver_indicator | H |
| Intranet | ocms_offence_notice_owner_driver | id_type | N |
| Intranet | ocms_offence_notice_owner_driver | id_no | S1234567A |
| Intranet | ocms_offence_notice_owner_driver | name | John Lee |
| Intranet | ocms_offence_notice_owner_driver | offender_indicator | Y |
| Intranet | ocms_offence_notice_owner_driver | email_addr | john.lee@email.com |
| Intranet | ocms_offence_notice_owner_driver | offender_tel_code | 65 |
| Intranet | ocms_offence_notice_owner_driver | offender_tel_no | 91234567 |
| Intranet | ocms_offence_notice_owner_driver | cre_date | 2026-01-20 14:30:00 |
| Intranet | ocms_offence_notice_owner_driver | cre_user_id | ALICIATAN |
| Intranet | ocms_offence_notice_owner_driver_addr | notice_no | 500500303J |
| Intranet | ocms_offence_notice_owner_driver_addr | owner_driver_indicator | H |
| Intranet | ocms_offence_notice_owner_driver_addr | type_of_address | M |
| Intranet | ocms_offence_notice_owner_driver_addr | blk_hse_no | 71 |
| Intranet | ocms_offence_notice_owner_driver_addr | street_name | BEDOK NORTH |
| Intranet | ocms_offence_notice_owner_driver_addr | postal_code | 470706 |
| Intranet | ocms_offence_notice_owner_driver_addr | cre_date | 2026-01-20 14:30:00 |
| Intranet | ocms_offence_notice_owner_driver_addr | cre_user_id | ALICIATAN |
| Intranet | ocms_valid_offence_notice | last_processing_stage | RD2 |
| Intranet | ocms_valid_offence_notice | is_sync | N |
| Intranet | ocms_valid_offence_notice | upd_date | 2026-01-20 14:30:00 |
| Intranet | ocms_valid_offence_notice | upd_user_id | ALICIATAN |
| Internet | eocms_furnish_application | status | A |
| Internet | eocms_furnish_application | remarks | Approved as verified hirer |
| Internet | eocms_furnish_application | upd_date | 2026-01-20 14:30:01 |
| Internet | eocms_furnish_application | upd_user_id | ocmsiz_app_conn |
| Internet | eocms_offence_notice_owner_driver | notice_no | 500500303J |
| Internet | eocms_offence_notice_owner_driver | owner_driver_indicator | H |
| Internet | eocms_offence_notice_owner_driver | id_no | S1234567A |
| Internet | eocms_offence_notice_owner_driver | offender_indicator | Y |
| Internet | eocms_offence_notice_owner_driver | cre_date | 2026-01-20 14:30:01 |
| Internet | eocms_offence_notice_owner_driver | cre_user_id | ocmsiz_app_conn |

### 2.6.3 Success Outcome

- Submission status updated to 'A' (Approved)
- Hirer/Driver record created with offender_indicator = 'Y'
- Mailing address record created
- Processing stage updated (RD for Hirer, DN for Driver)
- TS-PDP suspension revived
- Outcome synced to Internet DB
- Notifications sent based on OIC selection

### 2.6.4 Error Handling

| Error Scenario         | App Error Code | User Message                             | Brief Description         |
| ---------------------- | -------------- | ---------------------------------------- | ------------------------- |
| Validation Failed      | OCMS-4001      | Validation failed                        | Missing required fields   |
| Not Found              | OCMS-4004      | Submission not found                     | txnNo does not exist      |
| Already Processed      | OCMS-4009      | Submission already processed             | Status is not P or S      |
| Notice Not Furnishable | OCMS-4010      | Notice is no longer at furnishable stage | Processing stage changed  |
| Server Error           | OCMS-5000      | Something went wrong                     | Database operation failed |

---

## 2.7 Reject Furnished Submission

<!-- Insert flow diagram here -->

![Flow Diagram](./Section 2/images/2.7_Reject_Submission.png)

NOTE: Due to page size limit, the full-sized image is appended.

| Step                      | Description                                                  | Brief Description |
| ------------------------- | ------------------------------------------------------------ | ----------------- |
| Receive reject request    | API receives rejection request                               | Receive request   |
| Validate request          | Validate required fields (txnNo, officerId, rejectionReason) | Validate          |
| Query application         | Fetch application by txn_no                                  | Query application |
| Check status = P or S     | Verify submission is pending or resubmission                 | Check status      |
| Update status = R         | Update ocms_furnish_application.status = 'R'                 | Update status     |
| Keep TS-PDP active        | Do not revive suspension, keep active for resubmission       | Keep suspension   |
| Sync to Internet DB       | Update eocms_furnish_application with rejection status       | Sync Internet     |
| Resend notice to eService | Mark notice for resync to allow resubmission                 | Resend notice     |
| Send Email to Owner       | Send rejection notification with reason                      | Send email        |
| Return success            | Return success response                                      | Return success    |

### 2.7.1 API Specification

| Field              | Value                                                                                                                                                                       |
| ------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| API Name           | Reject Furnished Submission                                                                                                                                                 |
| URL                | POST /${api.version}/furnish/officer/reject                                                                                                                                 |
| Description        | Rejects a furnished submission and sends rejection notification                                                                                                             |
| Request            | `{ "txnNo": "FH202601070001", "officerId": "ALICIATAN", "sendEmailToOwner": true, "emailTemplateId": "REJECTED_DOCS_REQUIRED", "rejectionReason": "Insufficient supporting documents", "remarks": "Required documents not provided" }` |
| Response (Success) | `{ "success": true, "txnNo": "FH202601070001", "noticeNo": "500500303J", "emailSentToOwner": true, "noticeResentToPortal": true, "message": "Furnished submission rejected successfully" }` |
| Response (Failure) | `{ "data": { "appCode": "OCMS-4001", "message": "Rejection reason is required", "txnNo": "FH202601070001" } }`                                                              |

### 2.7.2 Data Mapping

| Zone | Database Table | Field Name | Value |
| ---- | -------------- | ---------- | ----- |
| Intranet | ocms_furnish_application | status | R |
| Intranet | ocms_furnish_application | reason_for_review | Insufficient supporting documents |
| Intranet | ocms_furnish_application | remarks | Required documents not provided |
| Intranet | ocms_furnish_application | upd_date | 2026-01-20 14:45:00 |
| Intranet | ocms_furnish_application | upd_user_id | ALICIATAN |
| Intranet | ocms_valid_offence_notice | is_sync | N |
| Intranet | ocms_valid_offence_notice | upd_date | 2026-01-20 14:45:00 |
| Intranet | ocms_valid_offence_notice | upd_user_id | ALICIATAN |
| Internet | eocms_furnish_application | status | R |
| Internet | eocms_furnish_application | reason_for_review | Insufficient supporting documents |
| Internet | eocms_furnish_application | remarks | Required documents not provided |
| Internet | eocms_furnish_application | upd_date | 2026-01-20 14:45:01 |
| Internet | eocms_furnish_application | upd_user_id | ocmsiz_app_conn |

### 2.7.3 Success Outcome

- Submission status updated to 'R' (Rejected)
- Rejection reason recorded
- TS-PDP suspension kept active
- Notice marked for resync to eService portal
- Owner can resubmit furnished request
- Rejection notification sent to owner

### 2.7.4 Error Handling

| Error Scenario            | App Error Code | User Message                 | Brief Description         |
| ------------------------- | -------------- | ---------------------------- | ------------------------- |
| Validation Failed         | OCMS-4001      | Validation failed            | Missing required fields   |
| Rejection Reason Required | OCMS-4001      | Rejection reason is required | Missing rejectionReason   |
| Not Found                 | OCMS-4004      | Submission not found         | txnNo does not exist      |
| Already Processed         | OCMS-4009      | Submission already processed | Status is not P or S      |
| Server Error              | OCMS-5000      | Something went wrong         | Database operation failed |

---

# Section 3 – Staff Portal Manual Furnish or Update

## 3.1 Use Case

1. OICs can use the OCMS Staff Portal to: Update the particulars of an existing Owner, Hirer or Driver
2. Furnish a new Owner, Hirer or Driver
3. OICs can do so via the View Notice screen’s Owner/Hirer/Driver Details tab (Refer to Section 5 of the v1.7 OCMS 7 Functional Document).

---

## 3.2 High-Level Furnish/Update Flow

<!-- Insert flow diagram here -->

![Flow Diagram](./Section 3/images/3.2_High_Level_Furnish_Update.png)

NOTE: Due to page size limit, the full-sized image is appended.

| Step                                   | Description                                                 | Brief Description  |
| -------------------------------------- | ----------------------------------------------------------- | ------------------ |
| OIC navigates to Search Notices page   | OIC accesses notice search functionality                    | Navigate to search |
| OIC searches for Notice                | Enter notice number or vehicle number                       | Search notice      |
| OIC clicks Notice Number               | Select notice from search results                           | Click notice       |
| Portal opens Notice details in new tab | System displays notice detail page                          | Open details       |
| OIC clicks Owner/Hirer/Driver sub-tab  | Navigate to offender management section                     | Click sub-tab      |
| OIC clicks UNLOCK button               | Enable edit mode for offender particulars                   | Unlock             |
| Which action?                          | System determines available action based on offender status | Determine action   |
| FURNISH: Add new offender              | Add new Owner, Hirer, or Driver                             | Furnish            |
| REDIRECT: Transfer to another          | Transfer offender indicator to another role                 | Redirect           |
| UPDATE: Modify existing                | Update particulars of current offender                      | Update             |
| Portal validates data                  | Frontend validation of input fields                         | Validate           |
| Portal calls backend API               | Send request to appropriate API endpoint                    | Call API           |
| Portal receives response               | Process API response                                        | Receive response   |
| Display outcome                        | Show success or error message to OIC                        | Display result     |

### Action Button Rules

| Condition                             | FURNISH | REDIRECT | UPDATE |
| ------------------------------------- | ------- | -------- | ------ |
| No existing offender for role         | Show    | Hide     | Hide   |
| Offender exists, is Current Offender  | Hide    | Hide     | Show   |
| Offender exists, not Current Offender | Hide    | Show     | Hide   |

### 3.2.1 Data Mapping

| Zone | Database Table | Field Name | Value |
| ---- | -------------- | ---------- | ----- |
| Intranet | ocms_valid_offence_notice | notice_no | 500500303J |
| Intranet | ocms_valid_offence_notice | vehicle_no | SNC7392R |
| Intranet | ocms_valid_offence_notice | last_processing_stage | RD1 |
| Intranet | ocms_offence_notice_owner_driver | notice_no | 500500303J |
| Intranet | ocms_offence_notice_owner_driver | owner_driver_indicator | H |
| Intranet | ocms_offence_notice_owner_driver | id_no | S1234567A |
| Intranet | ocms_offence_notice_owner_driver | name | John Lee |
| Intranet | ocms_offence_notice_owner_driver | offender_indicator | Y |

### 3.2.2 Success Outcome

- OIC successfully navigates to offender management screen
- Appropriate action button displayed based on offender status
- Selected action completed successfully
- Changes reflected in database and synced to Internet

### 3.2.3 Error Handling

| Error Scenario    | Definition                   | Brief Description                         |
| ----------------- | ---------------------------- | ----------------------------------------- |
| Notice Not Found  | Notice number does not exist | Display "Notice not found" message        |
| Validation Failed | Frontend validation failed   | Show validation error, prevent submission |
| API Error         | Backend processing failed    | Display error message from API response   |

---

## 3.3 Action Button Check

<!-- Insert flow diagram here -->

![Flow Diagram](./Section 3/images/3.3_Action_Button_Check.png)

NOTE: Due to page size limit, the full-sized image is appended.

| Step                                      | Description                                       | Brief Description |
| ----------------------------------------- | ------------------------------------------------- | ----------------- |
| OIC clicks UNLOCK button                  | OIC clicks unlock to enable edit mode             | Click unlock      |
| Portal detects presence of particulars    | Check if offender record exists for selected role | Check record      |
| Does offender record exist for this role? | Query database for existing offender              | Check existence   |
| Display FURNISH button only               | No record exists - allow adding new offender      | Show FURNISH      |
| Is this offender the Current Offender?    | Check offender_indicator = 'Y'                    | Check current     |
| Display UPDATE button only                | Is current offender - allow updating particulars  | Show UPDATE       |
| Display REDIRECT button only              | Not current offender - allow redirecting          | Show REDIRECT     |
| Portal unlocks fields for editing         | Enable input fields for selected action           | Unlock fields     |
| OIC proceeds with selected action         | OIC clicks the action button and enters data      | Proceed           |

### Decision Logic

| Check                | Condition                 | Result           |
| -------------------- | ------------------------- | ---------------- |
| Record Exists?       | No record in OND for role | Display FURNISH  |
| Is Current Offender? | offender_indicator = 'Y'  | Display UPDATE   |
| Is Current Offender? | offender_indicator = 'N'  | Display REDIRECT |

### 3.3.1 Data Mapping

| Zone | Database Table | Field Name | Value |
| ---- | -------------- | ---------- | ----- |
| Intranet | ocms_offence_notice_owner_driver | notice_no | 500500303J |
| Intranet | ocms_offence_notice_owner_driver | owner_driver_indicator | H |
| Intranet | ocms_offence_notice_owner_driver | offender_indicator | Y |

### 3.3.2 Success Outcome

- Correct action button displayed based on offender status
- Fields unlocked for editing
- OIC can proceed with selected action

---

## 3.4 Furnish Offender

<!-- Insert flow diagram here -->

![Flow Diagram](./Section 3/images/3.4_Furnish_Offender.png)

NOTE: Due to page size limit, the full-sized image is appended.

| Step                        | Description                                      | Brief Description |
| --------------------------- | ------------------------------------------------ | ----------------- |
| OIC clicks FURNISH button   | OIC initiates furnish action                     | Click FURNISH     |
| OIC enters offender details | Enter ID type, ID number, name, contact, address | Enter details     |
| OIC clicks Submit           | Submit the furnish request                       | Click Submit      |
| Frontend validation pass?   | Validate required fields and format              | Validate frontend |
| Show validation error       | Display validation error if failed               | Show error        |
| Receive request             | Backend receives furnish request                 | Receive request   |
| Bean validation             | Validate request body against constraints        | Bean validation   |
| Return VALIDATION_ERROR     | Return error if validation failed                | Return error      |
| Query notice by noticeNo    | Fetch notice from ocms_valid_offence_notice      | Query notice      |
| Return NOT_FOUND            | Return error if notice not found                 | Return error      |
| Check furnish eligibility   | Verify notice is at furnishable stage            | Check eligibility |
| Return NOT_FURNISHABLE      | Return error if not eligible                     | Return error      |
| Insert/Update OND record    | Create or update offender record                 | Insert/Update OND |
| Set offender_indicator = Y  | Mark as current offender                         | Set current       |
| Insert OND_ADDR record      | Create mailing address record                    | Insert address    |
| Update processing stage     | Update notice processing stage                   | Update stage      |
| Sync to Internet DB         | Sync changes to Internet database                | Sync Internet     |
| Return success              | Return success response                          | Return success    |
| Display success message     | Show success message to OIC                      | Display success   |

### 3.4.1 API Specification

| Field            | Value                                                                                                                                                                                                                                                                                                                                                                                              |
| ---------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| API Name         | Furnish Offender                                                                                                                                                                                                                                                                                                                                                                                   |
| URL              | POST /${api.version}/staff-furnish/furnish                                                                                                                                                                                                                                                                                                                                                         |
| Description      | Adds a new Owner, Hirer or Driver as the Current Offender                                                                                                                                                                                                                                                                                                                                          |
| Request          | `{ "noticeNo": "500500303J", "ownerDriverIndicator": "H", "idType": "N", "idNo": "S1234567A", "name": "JOHN LEE", "emailAddr": "john.lee@email.com", "telCode": "65", "telNo": "91234567", "address": { "blkHseNo": "123", "streetName": "ORCHARD ROAD", "bldgName": "PLAZA TOWER", "floorNo": "01", "unitNo": "01", "postalCode": "238888" }, "hirerOwnerRelationship": "L", "rentalPeriodFrom": "2025-01-01", "rentalPeriodTo": "2025-12-31", "remarks": "Furnished by OIC" }` |
| Response         | `{ "data": { "appCode": "OCMS-2000", "message": "Hirer furnished successfully", "noticeNo": "500500303J", "ownerDriverIndicator": "H", "newProcessingStage": "RD2" } }`                                                                                                                                                                                                                            |
| Response Failure | `{ "data": { "appCode": "OCMS-4004", "message": "Notice not found", "noticeNo": "500500303J" } }`                                                                                                                                                                                                                                                                                                  |

### 3.4.2 Data Mapping

| Zone | Database Table | Field Name | Value |
| ---- | -------------- | ---------- | ----- |
| Intranet | ocms_offence_notice_owner_driver | notice_no | 500500303J |
| Intranet | ocms_offence_notice_owner_driver | owner_driver_indicator | H |
| Intranet | ocms_offence_notice_owner_driver | id_type | N |
| Intranet | ocms_offence_notice_owner_driver | id_no | S1234567A |
| Intranet | ocms_offence_notice_owner_driver | name | JOHN LEE |
| Intranet | ocms_offence_notice_owner_driver | email_addr | john.lee@email.com |
| Intranet | ocms_offence_notice_owner_driver | offender_tel_code | 65 |
| Intranet | ocms_offence_notice_owner_driver | offender_tel_no | 91234567 |
| Intranet | ocms_offence_notice_owner_driver | offender_indicator | Y |
| Intranet | ocms_offence_notice_owner_driver | is_sync | N |
| Intranet | ocms_offence_notice_owner_driver | cre_user_id | ocmsiz_app_conn |
| Intranet | ocms_offence_notice_owner_driver_addr | notice_no | 500500303J |
| Intranet | ocms_offence_notice_owner_driver_addr | owner_driver_indicator | H |
| Intranet | ocms_offence_notice_owner_driver_addr | type_of_address | M |
| Intranet | ocms_offence_notice_owner_driver_addr | blk_hse_no | 123 |
| Intranet | ocms_offence_notice_owner_driver_addr | street_name | ORCHARD ROAD |
| Intranet | ocms_offence_notice_owner_driver_addr | bldg_name | PLAZA TOWER |
| Intranet | ocms_offence_notice_owner_driver_addr | floor_no | 01 |
| Intranet | ocms_offence_notice_owner_driver_addr | unit_no | 01 |
| Intranet | ocms_offence_notice_owner_driver_addr | postal_code | 238888 |
| Intranet | ocms_valid_offence_notice | last_processing_stage | RD2 |
| Internet | eocms_offence_notice_owner_driver | notice_no | 500500303J |
| Internet | eocms_offence_notice_owner_driver | owner_driver_indicator | H |
| Internet | eocms_offence_notice_owner_driver | offender_indicator | Y |
| Internet | eocms_offence_notice_owner_driver | cre_user_id | ocmsez_app_conn |

### Processing Stage Update

| Offender Type | New Processing Stage |
| ------------- | -------------------- |
| Owner (O)     | OW                   |
| Hirer (H)     | RD1 or RD2           |
| Driver (D)    | DN                   |

### 3.4.3 Success Outcome

- New offender record created in ocms_offence_notice_owner_driver
- offender_indicator set to 'Y' (Current Offender)
- Mailing address created in ocms_offence_notice_owner_driver_addr
- Processing stage updated in ocms_valid_offence_notice
- Changes synced to Internet DB
- Previous offender (if any) has offender_indicator set to 'N'

### 3.4.4 Error Handling

| Error Scenario    | App Error Code | User Message                          | Brief Description                    |
| ----------------- | -------------- | ------------------------------------- | ------------------------------------ |
| Validation Failed | OCMS-4000      | Validation error: {field} - {message} | Missing or invalid required fields   |
| Notice Not Found  | OCMS-4004      | Notice not found                      | Notice number does not exist         |
| Not Furnishable   | OCMS-4001      | Notice is not at furnishable stage    | Processing stage not eligible        |
| Stage After CPC   | OCMS-4002      | Notice is at final processing stage   | Cannot furnish after CPC             |
| Server Error      | OCMS-5000      | Internal server error                 | Database operation failed            |
| Sync Failed       | OCMS-5002      | Failed to sync to Internet DB         | Internet sync failed after 3 retries |

---

## 3.5 Redirect Notice

<!-- Insert flow diagram here -->

![Flow Diagram](./Section 3/images/3.5_Redirect_Notice.png)

NOTE: Due to page size limit, the full-sized image is appended.

| Step                              | Description                                       | Brief Description    |
| --------------------------------- | ------------------------------------------------- | -------------------- |
| OIC clicks REDIRECT button        | OIC initiates redirect action                     | Click REDIRECT       |
| OIC selects target role           | Select new role (Owner, Hirer, Driver)            | Select role          |
| OIC enters new offender details   | Enter particulars for new offender                | Enter details        |
| OIC clicks Submit                 | Submit the redirect request                       | Click Submit         |
| Frontend validation pass?         | Validate required fields and format               | Validate frontend    |
| Show validation error             | Display validation error if failed                | Show error           |
| Receive request                   | Backend receives redirect request                 | Receive request      |
| Bean validation                   | Validate request body against constraints         | Bean validation      |
| Return VALIDATION_ERROR           | Return error if validation failed                 | Return error         |
| Query notice by noticeNo          | Fetch notice from ocms_valid_offence_notice       | Query notice         |
| Return NOT_FOUND                  | Return error if notice not found                  | Return error         |
| Check redirect eligibility        | Verify notice can be redirected                   | Check eligibility    |
| Return NOT_REDIRECTABLE           | Return error if not eligible                      | Return error         |
| Same role?                        | Check if redirecting to same role                 | Check same role      |
| Return REDIRECT_SAME_ROLE         | Return error if same role                         | Return error         |
| Update source offender            | Set offender_indicator = 'N' for source           | Update source        |
| Insert/Update target OND          | Create or update target offender record           | Insert/Update target |
| Set target offender_indicator = Y | Mark new offender as current                      | Set current          |
| Insert OND_ADDR record            | Create mailing address for new offender           | Insert address       |
| Reset processing stage            | Reset processing stage based on new offender type | Reset stage          |
| Sync to Internet DB               | Sync changes to Internet database                 | Sync Internet        |
| Return success                    | Return success response                           | Return success       |
| Display success message           | Show success message to OIC                       | Display success      |

### 3.5.1 API Specification

| Field            | Value                                                                                                                                                                                                                                                                                                                                                                                          |
| ---------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| API Name         | Redirect Notice                                                                                                                                                                                                                                                                                                                                                                                |
| URL              | POST /${api.version}/staff-furnish/redirect                                                                                                                                                                                                                                                                                                                                                    |
| Description      | Transfers the Offender Indicator to another person/role                                                                                                                                                                                                                                                                                                                                        |
| Request          | `{ "noticeNo": "500500303J", "fromOwnerDriverIndicator": "O", "toOwnerDriverIndicator": "H", "idType": "N", "idNo": "S1234567A", "name": "JOHN LEE", "emailAddr": "john.lee@email.com", "telCode": "65", "telNo": "91234567", "address": { "blkHseNo": "123", "streetName": "ORCHARD ROAD", "bldgName": "PLAZA TOWER", "floorNo": "01", "unitNo": "01", "postalCode": "238888" }, "remarks": "Redirected by OIC" }` |
| Response         | `{ "data": { "appCode": "OCMS-2000", "message": "Notice redirected successfully", "noticeNo": "500500303J", "redirectedFrom": "O", "redirectedTo": "H", "newProcessingStage": "RD1" } }`                                                                                                                                                                                                       |
| Response Failure | `{ "data": { "appCode": "OCMS-4005", "message": "Cannot redirect to the same role", "noticeNo": "500500303J" } }`                                                                                                                                                                                                                                                                              |

### 3.5.2 Data Mapping

| Zone | Database Table | Field Name | Value |
| ---- | -------------- | ---------- | ----- |
| Intranet | ocms_offence_notice_owner_driver | notice_no | 500500303J |
| Intranet | ocms_offence_notice_owner_driver | owner_driver_indicator | O (source) |
| Intranet | ocms_offence_notice_owner_driver | offender_indicator | N |
| Intranet | ocms_offence_notice_owner_driver | is_sync | N |
| Intranet | ocms_offence_notice_owner_driver | notice_no | 500500303J |
| Intranet | ocms_offence_notice_owner_driver | owner_driver_indicator | H (target) |
| Intranet | ocms_offence_notice_owner_driver | id_type | N |
| Intranet | ocms_offence_notice_owner_driver | id_no | S1234567A |
| Intranet | ocms_offence_notice_owner_driver | name | JOHN LEE |
| Intranet | ocms_offence_notice_owner_driver | offender_indicator | Y |
| Intranet | ocms_offence_notice_owner_driver | is_sync | N |
| Intranet | ocms_offence_notice_owner_driver_addr | notice_no | 500500303J |
| Intranet | ocms_offence_notice_owner_driver_addr | owner_driver_indicator | H |
| Intranet | ocms_offence_notice_owner_driver_addr | type_of_address | M |
| Intranet | ocms_offence_notice_owner_driver_addr | blk_hse_no | 123 |
| Intranet | ocms_offence_notice_owner_driver_addr | street_name | ORCHARD ROAD |
| Intranet | ocms_offence_notice_owner_driver_addr | postal_code | 238888 |
| Intranet | ocms_valid_offence_notice | last_processing_stage | RD1 |
| Internet | eocms_offence_notice_owner_driver | notice_no | 500500303J |
| Internet | eocms_offence_notice_owner_driver | owner_driver_indicator | H |
| Internet | eocms_offence_notice_owner_driver | offender_indicator | Y |
| Internet | eocms_offence_notice_owner_driver | cre_user_id | ocmsez_app_conn |

### 3.5.3 Success Outcome

- Source offender's offender_indicator updated to 'N'
- Target offender record created/updated with offender_indicator = 'Y'
- Mailing address created for target offender
- Processing stage reset based on new offender type
- Changes synced to Internet DB

### 3.5.4 Error Handling

| Error Scenario       | App Error Code | User Message                               | Brief Description                  |
| -------------------- | -------------- | ------------------------------------------ | ---------------------------------- |
| Validation Failed    | OCMS-4000      | Validation error: {field} - {message}      | Missing or invalid required fields |
| Notice Not Found     | OCMS-4004      | Notice not found                           | Notice number does not exist       |
| Redirect Same Role   | OCMS-4005      | Cannot redirect to the same role           | from and to roles are identical    |
| Not Current Offender | OCMS-4004      | Cannot redirect - not the current offender | Source is not current offender     |
| Server Error         | OCMS-5000      | Internal server error                      | Database operation failed          |

---

## 3.6 Update Particulars

<!-- Insert flow diagram here -->

![Flow Diagram](./Section 3/images/3.6_Update_Particulars.png)

NOTE: Due to page size limit, the full-sized image is appended.

| Step                                | Description                               | Brief Description |
| ----------------------------------- | ----------------------------------------- | ----------------- |
| OIC clicks UPDATE button            | OIC initiates update action               | Click UPDATE      |
| OIC modifies offender details       | Edit name, contact, address fields        | Modify details    |
| OIC clicks Submit                   | Submit the update request                 | Click Submit      |
| Frontend validation pass?           | Validate modified fields                  | Validate frontend |
| Show validation error               | Display validation error if failed        | Show error        |
| Receive request                     | Backend receives update request           | Receive request   |
| Bean validation                     | Validate request body against constraints | Bean validation   |
| Return VALIDATION_ERROR             | Return error if validation failed         | Return error      |
| Query offender by noticeNo and role | Fetch offender record                     | Query offender    |
| Return NOT_FOUND                    | Return error if offender not found        | Return error      |
| Is current offender?                | Check offender_indicator = 'Y'            | Check current     |
| Return NOT_CURRENT_OFFENDER         | Return error if not current               | Return error      |
| Update OND record                   | Update offender particulars               | Update OND        |
| Update OND_ADDR record              | Update mailing address                    | Update address    |
| Sync to Internet DB                 | Sync changes to Internet database         | Sync Internet     |
| Return success                      | Return success response                   | Return success    |
| Display success message             | Show success message to OIC               | Display success   |

### 3.6.1 API Specification

| Field            | Value                                                                                                                                                                                                                                                                                                                       |
| ---------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| API Name         | Update Offender Particulars                                                                                                                                                                                                                                                                                                 |
| URL              | POST /${api.version}/staff-furnish/update                                                                                                                                                                                                                                                                                   |
| Description      | Updates the particulars of an existing Current Offender                                                                                                                                                                                                                                                                     |
| Request          | `{ "noticeNo": "500500303J", "ownerDriverIndicator": "H", "name": "JOHN LEE UPDATED", "emailAddr": "john.lee.new@email.com", "telCode": "65", "telNo": "98765432", "address": { "blkHseNo": "456", "streetName": "MARINA BAY", "bldgName": "TOWER A", "floorNo": "02", "unitNo": "02", "postalCode": "018989" }, "remarks": "Address updated by OIC" }` |
| Response         | `{ "data": { "appCode": "OCMS-2000", "message": "Offender particulars updated successfully", "noticeNo": "500500303J", "ownerDriverIndicator": "H" } }`                                                                                                                                                                     |
| Response Failure | `{ "data": { "appCode": "OCMS-4004", "message": "Cannot update - not the current offender", "noticeNo": "500500303J" } }`                                                                                                                                                                                                   |

### 3.6.2 Data Mapping

| Zone | Database Table | Field Name | Value |
| ---- | -------------- | ---------- | ----- |
| Intranet | ocms_offence_notice_owner_driver | notice_no | 500500303J |
| Intranet | ocms_offence_notice_owner_driver | owner_driver_indicator | H |
| Intranet | ocms_offence_notice_owner_driver | name | JOHN LEE UPDATED |
| Intranet | ocms_offence_notice_owner_driver | email_addr | john.lee.new@email.com |
| Intranet | ocms_offence_notice_owner_driver | offender_tel_code | 65 |
| Intranet | ocms_offence_notice_owner_driver | offender_tel_no | 98765432 |
| Intranet | ocms_offence_notice_owner_driver | is_sync | N |
| Intranet | ocms_offence_notice_owner_driver | upd_user_id | ocmsiz_app_conn |
| Intranet | ocms_offence_notice_owner_driver_addr | blk_hse_no | 456 |
| Intranet | ocms_offence_notice_owner_driver_addr | street_name | MARINA BAY |
| Intranet | ocms_offence_notice_owner_driver_addr | bldg_name | TOWER A |
| Intranet | ocms_offence_notice_owner_driver_addr | floor_no | 02 |
| Intranet | ocms_offence_notice_owner_driver_addr | unit_no | 02 |
| Intranet | ocms_offence_notice_owner_driver_addr | postal_code | 018989 |
| Internet | eocms_offence_notice_owner_driver | notice_no | 500500303J |
| Internet | eocms_offence_notice_owner_driver | owner_driver_indicator | H |
| Internet | eocms_offence_notice_owner_driver | name | JOHN LEE UPDATED |
| Internet | eocms_offence_notice_owner_driver | upd_user_id | ocmsez_app_conn |

### 3.6.3 Success Outcome

- Offender particulars updated in ocms_offence_notice_owner_driver
- Mailing address updated in ocms_offence_notice_owner_driver_addr
- Changes synced to Internet DB
- Processing stage unchanged (no offender change)

### 3.6.4 Error Handling

| Error Scenario       | App Error Code | User Message                             | Brief Description                    |
| -------------------- | -------------- | ---------------------------------------- | ------------------------------------ |
| Validation Failed    | OCMS-4000      | Validation error: {field} - {message}    | Invalid field format                 |
| Offender Not Found   | OCMS-4003      | Offender record not found                | No record for notice and role        |
| Not Current Offender | OCMS-4004      | Cannot update - not the current offender | offender_indicator != 'Y'            |
| Server Error         | OCMS-5000      | Internal server error                    | Database operation failed            |
| Sync Failed          | OCMS-5002      | Failed to sync to Internet DB            | Internet sync failed after 3 retries |

---

# Section 4 – Batch Furnish and Batch Update

## 4.1 Use Case

1. OICs can use the OCMS Staff Portal to:Furnish an individual or a company as the Owner, Hirer or Driver particulars for a batch of Notices
2. Update the particulars and Mailing Address of an individual or a company who is the Current Offender for a batch of Notices
3. The Batch Furnish and Batch Update functions are like the ones listed in Sections 4.6 and 4.8 of this document.

## 4.2 Batch Furnish Offender

<!-- Insert flow diagram here -->

![Flow Diagram](./Section 4/images/4.2_Batch_Furnish_Offender.png)

NOTE: Due to page size limit, the full-sized image is appended.

| Step                                      | Description                                       | Brief Description    |
| ----------------------------------------- | ------------------------------------------------- | -------------------- |
| OIC searches and selects multiple Notices | OIC selects Notices from search results           | Select notices       |
| OIC clicks BATCH FURNISH                  | Initiate batch furnish workflow                   | Click batch furnish  |
| Call POST /batch/check-furnishability     | Check if each Notice can be furnished             | Check furnishability |
| Receive check request                     | Backend receives list of Notices to check         | Receive request      |
| Loop: Check each Notice                   | Iterate through each Notice and check eligibility | Loop check           |
| Return furnishability result              | Return furnishable status for each Notice         | Return result        |
| All non-furnishable?                      | Check if all Notices are non-furnishable          | Check all            |
| Show error message                        | Display error if all Notices cannot be furnished  | Show error           |
| Some non-furnishable?                     | Check if some Notices are non-furnishable         | Check some           |
| Prompt: Continue with furnishable?        | Ask OIC to continue with only furnishable Notices | Prompt continue      |
| Display Batch Furnish form                | Show form for entering offender details           | Display form         |
| OIC enters offender details               | Enter ID type, ID number, name, contact, address  | Enter details        |
| OIC clicks SUBMIT                         | Submit the batch furnish request                  | Click submit         |
| Frontend validation                       | Validate input fields                             | Validate frontend    |
| Prompt overwrite warning                  | Warn if existing records will be overwritten      | Warn overwrite       |
| OIC clicks CONFIRM                        | Confirm to proceed with batch furnish             | Click confirm        |
| Loop: Process each Notice                 | Iterate through each furnishable Notice           | Loop process         |
| Call POST /staff-furnish/furnish        | Call single furnish API for each Notice           | Call furnish API     |
| Receive furnish request                   | Backend receives furnish request                  | Receive request      |
| Bean validation                           | Validate request body                             | Bean validation      |
| Query notice                              | Fetch Notice from database                        | Query notice         |
| Furnishable?                              | Check if Notice is still furnishable              | Check furnishable    |
| Create/Update offender                    | Create or update offender record                  | Create/Update OND    |
| Set offender_indicator = Y                | Mark new offender as current                      | Set indicator        |
| Clear previous indicator                  | Set previous offender's indicator to 'N'          | Clear previous       |
| Update processing stage                   | Update Notice processing stage                    | Update stage         |
| Return success                            | Return success response                           | Return success       |
| Store result                              | Store result for each Notice                      | Store result         |
| More notices?                             | Check if more Notices to process                  | Check more           |
| Consolidate results                       | Aggregate success and failure results             | Consolidate          |
| Query latest details                      | Fetch updated offender and Notice details         | Query details        |
| Display Result Page                       | Show consolidated results to OIC                  | Display results      |

### 4.2.1 API Specification

#### Check Batch Furnishability

| Field            | Value                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| ---------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| API Name         | Check Batch Furnishability                                                                                                                                                                                                                                                                                                                                                                                                                               |
| URL              | POST /${api.version}/staff-furnish/furnish-redirect-check                                                                                                                                                                                                                                                                                                                                                                                                |
| Description      | Checks whether multiple Notices can be furnished                                                                                                                                                                                                                                                                                                                                                                                                         |
| Request          | `{ "noticeList": ["500500303J", "500500304K", "500500305L"] }`                                                                                                                                                                                                                                                                                                                                                                                           |
| Response         | `{ "data": { "appCode": "OCMS-2000", "message": "Furnishability check completed", "totalNotices": 3, "furnishableCount": 2, "nonFurnishableCount": 1, "results": [{ "noticeNo": "500500303J", "furnishable": true, "reasonCode": null, "reasonMessage": null }, { "noticeNo": "500500305L", "furnishable": false, "reasonCode": "LAST_STAGE_AFTER_CPC", "reasonMessage": "Notice cannot be furnished because processing stage is after CPC" }] } }` |
| Response Failure | `{ "data": { "appCode": "OCMS-4000", "message": "Notice list cannot be empty" } }`                                                                                                                                                                                                                                                                                                                                                                       |

#### Batch Furnish Offender

| Field                   | Value                                                                                                                                                                                                                                                                                                                                                                                                                  |
| ----------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| API Name                | Batch Furnish Offender                                                                                                                                                                                                                                                                                                                                                                                                 |
| URL                     | POST /${api.version}/staff-furnish/batch-furnish                                                                                                                                                                                                                                                                                                                                                                       |
| Description             | Furnishes the same offender particulars to multiple Notices                                                                                                                                                                                                                                                                                                                                                            |
| Request                 | `{ "noticeList": ["500500303J", "500500304K"], "ownerDriverIndicator": "H", "idType": "NRIC", "idNo": "S1234567A", "name": "JOHN LEE", "emailAddr": "john.lee@email.com", "countryCode": "65", "offenderTelNo": "91234567", "address": { "blockNo": "123", "streetName": "ORCHARD ROAD", "buildingName": "PLAZA TOWER", "floorNo": "01", "unitNo": "01", "postalCode": "238888" } }`                                    |
| Response                | `{ "data": { "appCode": "OCMS-2000", "message": "Batch furnish completed", "totalProcessed": 2, "successCount": 2, "failureCount": 0, "successRecords": [{ "noticeNo": "500500303J", "offenderName": "JOHN LEE", "offenderId": "S1234567A", "ownerDriverIndicator": "H", "newProcessingStage": "RD2" }], "failedRecords": [] } }`                                                                                      |
| Response Partial        | `{ "data": { "appCode": "OCMS-2001", "message": "Batch furnish completed with errors", "totalProcessed": 3, "successCount": 2, "failureCount": 1, "successRecords": [...], "failedRecords": [{ "noticeNo": "500500305L", "furnishedName": "JOHN LEE", "furnishedId": "S1234567A", "errorCode": "DB_UPDATE_FAILED", "errorMessage": "Failed to update database" }] } }`                                                 |
| Response Failure        | `{ "data": { "appCode": "OCMS-4001", "message": "All selected Notices are not furnishable" } }`                                                                                                                                                                                                                                                                                                                        |

### 4.2.2 Data Mapping

| Zone | Database Table | Field Name | Value |
| ---- | -------------- | ---------- | ----- |
| Intranet | ocms_valid_offence_notice | notice_no | 500500303J |
| Intranet | ocms_valid_offence_notice | vehicle_no | SNC7392R |
| Intranet | ocms_valid_offence_notice | last_processing_stage | RD2 |
| Intranet | ocms_offence_notice_owner_driver | notice_no | 500500303J |
| Intranet | ocms_offence_notice_owner_driver | owner_driver_indicator | H |
| Intranet | ocms_offence_notice_owner_driver | id_type | N |
| Intranet | ocms_offence_notice_owner_driver | id_no | S1234567A |
| Intranet | ocms_offence_notice_owner_driver | name | JOHN LEE |
| Intranet | ocms_offence_notice_owner_driver | email_addr | john.lee@email.com |
| Intranet | ocms_offence_notice_owner_driver | offender_tel_code | 65 |
| Intranet | ocms_offence_notice_owner_driver | offender_tel_no | 91234567 |
| Intranet | ocms_offence_notice_owner_driver | offender_indicator | Y |
| Intranet | ocms_offence_notice_owner_driver | is_sync | N |
| Intranet | ocms_offence_notice_owner_driver | cre_user_id | ocmsiz_app_conn |
| Intranet | ocms_offence_notice_owner_driver_addr | notice_no | 500500303J |
| Intranet | ocms_offence_notice_owner_driver_addr | owner_driver_indicator | H |
| Intranet | ocms_offence_notice_owner_driver_addr | type_of_address | M |
| Intranet | ocms_offence_notice_owner_driver_addr | blk_hse_no | 123 |
| Intranet | ocms_offence_notice_owner_driver_addr | street_name | ORCHARD ROAD |
| Intranet | ocms_offence_notice_owner_driver_addr | bldg_name | PLAZA TOWER |
| Intranet | ocms_offence_notice_owner_driver_addr | floor_no | 01 |
| Intranet | ocms_offence_notice_owner_driver_addr | unit_no | 01 |
| Intranet | ocms_offence_notice_owner_driver_addr | postal_code | 238888 |
| Internet | eocms_furnish_application | notice_no | 500500303J |
| Internet | eocms_furnish_application | status | P |
| Internet | eocms_furnish_application | cre_user_id | ocmsez_app_conn |

### 4.2.3 Success Outcome

- Furnishability checked for all selected Notices
- Non-furnishable Notices identified and excluded (with user consent)
- Offender records created/updated for each furnishable Notice
- Previous offender indicators cleared
- Processing stage updated for each Notice
- Changes synced to Internet DB (eocms_furnish_application)
- Consolidated results displayed showing success/failure for each Notice

### 4.2.4 Error Handling

| Error Scenario          | App Error Code | User Message                             | Brief Description           |
| ----------------------- | -------------- | ---------------------------------------- | --------------------------- |
| All Non-Furnishable     | OCMS-4001      | All selected Notices are not furnishable | No Notices can be processed |
| Notice List Empty       | OCMS-4000      | Notice list cannot be empty              | No Notices selected         |
| Notice List Exceeds Max | OCMS-4000      | Maximum 100 notices allowed per batch    | Too many Notices            |
| Validation Failed       | OCMS-4000      | Validation error: {field} - {message}    | Invalid input               |
| DB Update Failed        | OCMS-5001      | Failed to update database                | Database error (per Notice) |
| Partial Failure         | OCMS-2001      | Batch furnish completed with errors      | Some Notices failed         |

---

## 4.3 Batch Update Mailing Address

<!-- Insert flow diagram here -->

![Flow Diagram](./Section 4/images/4.3_Batch_Update_Mailing_Addr.png)

NOTE: Due to page size limit, the full-sized image is appended.

| Step                                         | Description                                       | Brief Description |
| -------------------------------------------- | ------------------------------------------------- | ----------------- |
| OIC navigates to Batch Update page           | Access batch update mailing address function      | Navigate          |
| OIC enters ID number                         | Enter offender's ID number to search              | Enter ID          |
| OIC clicks SEARCH                            | Initiate search for outstanding Notices           | Click search      |
| Call POST /staff-furnish/outstanding-notices       | Fetch outstanding Notices for the ID              | Call API          |
| Receive search request                       | Backend receives ID number                        | Receive request   |
| Query OND by ID where offender_indicator = Y | Find all records where person is current offender | Query offender    |
| No outstanding?                              | Check if any outstanding Notices found            | Check exists      |
| Display "No outstanding notices"             | Show message if no records found                  | Show message      |
| Return outstanding Notices                   | Return list of Notices with details               | Return list       |
| Display list with checkboxes                 | Show Notices with selection checkboxes            | Display list      |
| OIC selects Notices to update                | Select which Notices to update address            | Select notices    |
| OIC enters new address                       | Enter new mailing address, contact, email         | Enter address     |
| OIC clicks UPDATE                            | Submit batch update request                       | Click update      |
| Frontend validation                          | Validate address fields                           | Validate          |
| Call POST /batch/update-address              | Send batch update request to backend              | Call API          |
| Receive update request                       | Backend receives update request                   | Receive request   |
| Loop: Update each Notice                     | Iterate through selected Notices                  | Loop update       |
| Update OND_ADDR record                       | Update mailing address for each Notice            | Update address    |
| Update OND contact fields                    | Update contact number and email                   | Update contact    |
| Consolidate results                          | Aggregate success and failure results             | Consolidate       |
| Return results                               | Return consolidated update results                | Return results    |
| Display Result Page                          | Show update results to OIC                        | Display results   |

### 4.3.1 API Specification

#### Get Outstanding Notices

| Field              | Value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| ------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| API Name           | Get Outstanding Notices by ID                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| URL                | POST /${api.version}/staff-furnish/outstanding-notices                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Description        | Retrieves all outstanding Notices where the person is Current Offender                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Request            | `{ "idNo": "S1234567A" }`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Response           | `{ "data": { "appCode": "OCMS-2000", "message": "Outstanding notices retrieved", "idNo": "S1234567A", "totalNotices": 3, "offenderDetails": { "name": "JOHN LEE", "idType": "NRIC", "idNo": "S1234567A" }, "registeredAddress": { "blockNo": "456", "streetName": "BUKIT TIMAH ROAD", "buildingName": null, "floorNo": "05", "unitNo": "123", "postalCode": "289628" }, "notices": [{ "noticeNo": "500500303J", "summonNo": "SUM123456", "vehicleNo": "SNC7392R", "offenceDateTime": "2025-06-15T14:30:00", "ownerDriverIndicator": "H", "offenceRuleCode": "PV01", "amountPayable": 70.00, "lastProcessingStage": "RD1", "mailingAddress": { "blockNo": "123", "streetName": "ORCHARD ROAD", "buildingName": "PLAZA TOWER", "floorNo": "01", "unitNo": "01", "postalCode": "238888" }, "offenderTelNo": "91234567", "emailAddr": "john.lee@email.com" }] } }` |
| Response (No Data) | `{ "data": { "appCode": "OCMS-4004", "message": "Offender not found", "idNo": "S1234567A", "totalNotices": 0 } }`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |

#### Batch Update Mailing Address

| Field            | Value                                                                                                                                                                                                                                                                                                                                               |
| ---------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| API Name         | Batch Update Mailing Address                                                                                                                                                                                                                                                                                                                        |
| URL              | POST /${api.version}/staff-furnish/batch-update-address                                                                                                                                                                                                                                                                                             |
| Description      | Updates mailing address for multiple Notices of the same offender                                                                                                                                                                                                                                                                                   |
| Request          | `{ "idNo": "S1234567A", "noticeList": [{ "noticeNo": "500500303J", "ownerDriverIndicator": "H" }, { "noticeNo": "500500304K", "ownerDriverIndicator": "O" }], "newAddress": { "blockNo": "789", "streetName": "MARINA BAY", "buildingName": "TOWER A", "floorNo": "10", "unitNo": "05", "postalCode": "018989" }, "offenderTelNo": "98765432", "emailAddr": "john.new@email.com" }` |
| Response         | `{ "data": { "appCode": "OCMS-2000", "message": "Batch update completed", "totalProcessed": 2, "successCount": 2, "failureCount": 0, "successRecords": [{ "noticeNo": "500500303J", "ownerDriverIndicator": "H", "addressUpdated": true }], "failedRecords": [] } }`                                                                               |
| Response Failure | `{ "data": { "appCode": "OCMS-4000", "message": "Address is required" } }`                                                                                                                                                                                                                                                                          |

### 4.3.2 Data Mapping

| Zone | Database Table | Field Name | Value |
| ---- | -------------- | ---------- | ----- |
| Intranet | ocms_offence_notice_owner_driver | notice_no | 500500303J |
| Intranet | ocms_offence_notice_owner_driver | id_no | S1234567A |
| Intranet | ocms_offence_notice_owner_driver | id_type | N |
| Intranet | ocms_offence_notice_owner_driver | name | JOHN LEE |
| Intranet | ocms_offence_notice_owner_driver | email_addr | john.new@email.com |
| Intranet | ocms_offence_notice_owner_driver | offender_tel_no | 98765432 |
| Intranet | ocms_offence_notice_owner_driver | offender_indicator | Y |
| Intranet | ocms_offence_notice_owner_driver | owner_driver_indicator | H |
| Intranet | ocms_offence_notice_owner_driver_addr | notice_no | 500500303J |
| Intranet | ocms_offence_notice_owner_driver_addr | owner_driver_indicator | H |
| Intranet | ocms_offence_notice_owner_driver_addr | type_of_address | M |
| Intranet | ocms_offence_notice_owner_driver_addr | blk_hse_no | 789 |
| Intranet | ocms_offence_notice_owner_driver_addr | street_name | MARINA BAY |
| Intranet | ocms_offence_notice_owner_driver_addr | bldg_name | TOWER A |
| Intranet | ocms_offence_notice_owner_driver_addr | floor_no | 10 |
| Intranet | ocms_offence_notice_owner_driver_addr | unit_no | 05 |
| Intranet | ocms_offence_notice_owner_driver_addr | postal_code | 018989 |
| Intranet | ocms_offence_notice_owner_driver_addr | upd_user_id | ocmsiz_app_conn |
| Intranet | ocms_valid_offence_notice | notice_no | 500500303J |
| Intranet | ocms_valid_offence_notice | vehicle_no | SNC7392R |
| Intranet | ocms_valid_offence_notice | last_processing_stage | RD1 |

### 4.3.3 Success Outcome

- All outstanding Notices for the ID retrieved
- Notices with active permanent suspension excluded
- Mailing address updated for all selected Notices
- Contact number and email updated (if provided)
- Consolidated results displayed showing success/failure for each Notice

### 4.3.4 Error Handling

| Error Scenario       | App Error Code | User Message                             | Brief Description                  |
| -------------------- | -------------- | ---------------------------------------- | ---------------------------------- |
| ID Not Found         | OCMS-4004      | Offender not found                       | No outstanding Notices for this ID |
| Notice List Empty    | OCMS-4000      | Notice list cannot be empty              | No Notices selected                |
| Address Required     | OCMS-4000      | Address is required                      | Missing address fields             |
| Not Current Offender | OCMS-4004      | Cannot update - not the current offender | Person is not current offender     |
| Permanent Suspension | OCMS-4001      | Notice has active permanent suspension   | Notice excluded from update        |
| DB Update Failed     | OCMS-5001      | Failed to update database                | Database error                     |

---

# Section 5 – PLUS External System Integration

## 5.1 Use Case


1. The PLUS Staff Portal contains the following functionalities within the Appeal Processing module that allow Appeal Processing Officers to furnish new Hirers/Drivers and redirect Notices to another person/entity.

| PLUS Functionality | Description of Functionality |
| --- | --- |
| Update Hirer | Add a new Hirer as the Current Offender. Note: The function is the same as OCMS' Furnish function listed in Section 3.4. |
| Update Driver | Add a new Driver as the Current Offender. Note: The function is the same as OCMS' Furnish function listed in Section 3.4. |
| Redirect Notice to Owner, Hirer or Driver | Indicate that the Offender should be another person/role and initiate a transfer for the Offender Indicator flag. Note: The function is like OCMS' Redirect function listed in Section 3.5. |

2. The OCMS Intranet Backend will provide the following APIs that the PLUS Intranet Backend can call to submit the requests to furnish offenders and redirect Notices.

## 5.2 PLUS Update Hirer/Driver

<!-- Insert flow diagram here -->

![Flow Diagram](./Section 5/images/5.2_PLUS_Update_Hirer_Driver.png)

NOTE: Due to page size limit, the full-sized image is appended.

| Step                                    | Description                                                 | Brief Description    |
| --------------------------------------- | ----------------------------------------------------------- | -------------------- |
| PLM initiates Update Hirer/Driver       | PLM accesses Update Hirer/Driver from PLUS Staff Portal     | Initiate update      |
| PLUS Backend calls check-furnishability | Call OCMS API to verify Notice can be furnished             | Check furnishability |
| Query notice by noticeNo                | OCMS queries ocms_valid_offence_notice                      | Query notice         |
| Notice exists?                          | Check if Notice is found                                    | Check exists         |
| Check processing stage                  | Verify processing stage allows furnish                      | Check stage          |
| Can furnish?                            | Evaluate if furnish is allowed                              | Check can furnish    |
| Return furnishable status               | Return result to PLUS with allowed offender types           | Return status        |
| Update allowed?                         | PLUS Portal checks if update is allowed                     | Check allowed        |
| Display error                           | Show error if not furnishable                               | Show error           |
| PLUS Backend calls get-offender         | Retrieve existing offender data                             | Get offender         |
| Query OND by notice and type            | Query ocms_offence_notice_owner_driver                      | Query OND            |
| Record exists?                          | Check if existing offender record found                     | Check record         |
| Query OND_ADDR for address              | Retrieve address from ocms_offence_notice_owner_driver_addr | Query address        |
| Return existing offender data           | Return offender details to PLUS                             | Return data          |
| Existing offender?                      | PLUS Portal checks if data returned                         | Check existing       |
| Display form with data                  | Pre-populate form with existing data                        | Display with data    |
| Display blank form                      | Show empty form for new entry                               | Display blank        |
| PLM enters/updates particulars          | PLM fills in offender details                               | Enter details        |
| PLM clicks SUBMIT                       | PLM submits the furnish request                             | Click submit         |
| PLUS Backend calls furnish API          | Call OCMS furnish endpoint                                  | Call furnish         |
| Bean validation                         | Validate request payload                                    | Validate             |
| Valid?                                  | Check if validation passed                                  | Check valid          |
| Return VALIDATION_ERROR                 | Return validation error to PLUS                             | Return error         |
| Query notice                            | Fetch notice from database                                  | Query notice         |
| Exists?                                 | Check if notice found                                       | Check exists         |
| Return NOT_FOUND                        | Return not found error                                      | Return error         |
| Check furnishability                    | Re-verify furnish eligibility                               | Check eligibility    |
| Can furnish?                            | Evaluate furnish eligibility                                | Check can furnish    |
| Return NOT_FURNISHABLE                  | Return not furnishable error                                | Return error         |
| Existing offender?                      | Check if updating existing record                           | Check existing       |
| Update OND record                       | Update existing offender record                             | Update OND           |
| Insert OND record                       | Create new offender record                                  | Insert OND           |
| Save address as Mailing Address         | Insert address in OND_ADDR                                  | Save address         |
| Transfer flag?                          | Check if offender_indicator should transfer                 | Check transfer       |
| Update offender_indicator               | Set new offender as current (Y), previous as (N)            | Update indicator     |
| Update processing stage                 | Set to RD1 (Hirer) or DN (Driver)                           | Update stage         |
| Set NPS = Next Day                      | Set Next Print Schedule                                     | Set NPS              |
| Sync to Internet DB                     | Sync changes to eocms_furnish_application                   | Sync Internet        |
| Return success response                 | Return success to PLUS                                      | Return success       |
| Success?                                | PLUS Portal checks API response                             | Check success        |
| Display error                           | Show error message if failed                                | Show error           |
| Display success message                 | Show success confirmation                                   | Show success         |

### 5.2.1 API Specification

#### Check Furnishability for PLUS

| Field                    | Value                                                                                                                                                                                                                |
| ------------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| API Name                 | Check Furnishability for PLUS                                                                                                                                                                                        |
| URL                      | POST /${api.version}/plus-furnish/furnish-redirect-check                                                                                                                                                             |
| Description              | Checks whether a Notice can be furnished with Hirer/Driver by PLUS                                                                                                                                                   |
| Request                  | `{ "noticeNo": "500500303J" }`                                                                                                                                                                                       |
| Response                 | `{ "data": { "appCode": "OCMS-2000", "message": "Check furnishability successful", "noticeNo": "500500303J", "furnishable": true, "allowedOffenderTypes": ["H", "D"], "currentProcessingStage": "OW" } }`            |
| Response (Not Furnishable) | `{ "data": { "appCode": "OCMS-4003", "message": "Notice cannot be furnished because processing stage is after CPC", "noticeNo": "500500303J", "furnishable": false, "allowedOffenderTypes": [], "currentProcessingStage": "CPC" } }` |

#### Get Existing Hirer/Driver for PLUS

| Field                     | Value                                                                                                                                                                                                                                                                                                                                                                       |
| ------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| API Name                  | Get Existing Hirer/Driver for PLUS                                                                                                                                                                                                                                                                                                                                          |
| URL                       | POST /${api.version}/plus-furnish/get-offender                                                                                                                                                                                                                                                                                                                              |
| Description               | Retrieves existing Hirer or Driver particulars for a Notice to pre-populate form                                                                                                                                                                                                                                                                                            |
| Request                   | `{ "noticeNo": "500500303J", "ownerDriverIndicator": "H" }`                                                                                                                                                                                                                                                                                                                 |
| Response                  | `{ "data": { "appCode": "OCMS-2000", "message": "Get offender successful", "noticeNo": "500500303J", "existingOffender": { "ownerDriverIndicator": "H", "name": "JOHN LEE", "idType": "NRIC", "idNo": "S1234567A", "emailAddr": "john.lee@email.com", "countryCode": "65", "offenderTelNo": "91234567", "address": { "blockNo": "123", "streetName": "ORCHARD ROAD", "buildingName": "PLAZA TOWER", "floorNo": "01", "unitNo": "01", "postalCode": "238888" } } } }` |
| Response (No Data)        | `{ "data": { "appCode": "OCMS-2000", "message": "No existing offender found", "noticeNo": "500500303J", "existingOffender": null } }`                                                                                                                                                                                                                                       |

#### Furnish Hirer/Driver from PLUS

| Field            | Value                                                                                                                                                                                                                                                                                                                                                                       |
| ---------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| API Name         | Furnish Hirer/Driver from PLUS                                                                                                                                                                                                                                                                                                                                              |
| URL              | POST /${api.version}/plus-furnish/furnish                                                                                                                                                                                                                                                                                                                                   |
| Description      | Furnishes Hirer or Driver particulars for a Notice from PLUS                                                                                                                                                                                                                                                                                                                |
| Request          | `{ "noticeNo": "500500303J", "ownerDriverIndicator": "H", "idType": "NRIC", "idNo": "S1234567A", "name": "JOHN LEE", "emailAddr": "john.lee@email.com", "countryCode": "65", "offenderTelNo": "91234567", "address": { "blockNo": "123", "streetName": "ORCHARD ROAD", "buildingName": "PLAZA TOWER", "floorNo": "01", "unitNo": "01", "postalCode": "238888" } }`            |
| Response         | `{ "data": { "appCode": "OCMS-2000", "message": "Furnish successful", "noticeNo": "500500303J", "offenderName": "JOHN LEE", "offenderId": "S1234567A", "ownerDriverIndicator": "H", "newProcessingStage": "RD1", "nextPrintSchedule": "2026-01-08" } }`                                                                                                                      |
| Response Failure | `{ "data": { "appCode": "OCMS-4003", "message": "Notice cannot be furnished at current processing stage", "noticeNo": "500500303J" } }`                                                                                                                                                                                                                                     |

### Processing Stage Transitions (PLUS Furnish)

| From Stage | Offender Type | New Stage | NPS      |
| ---------- | ------------- | --------- | -------- |
| OW         | H (Hirer)     | RD1       | Next Day |
| OW         | D (Driver)    | DN        | Next Day |
| RD1        | D (Driver)    | DN        | Next Day |

### 5.2.2 Data Mapping

| Zone | Database Table | Field Name | Value |
| ---- | -------------- | ---------- | ----- |
| Intranet | ocms_valid_offence_notice | notice_no | 500500303J |
| Intranet | ocms_valid_offence_notice | last_processing_stage | RD1 |
| Intranet | ocms_valid_offence_notice | next_processing_date | 2026-01-08 |
| Intranet | ocms_offence_notice_owner_driver | notice_no | 500500303J |
| Intranet | ocms_offence_notice_owner_driver | owner_driver_indicator | H |
| Intranet | ocms_offence_notice_owner_driver | id_type | N |
| Intranet | ocms_offence_notice_owner_driver | id_no | S1234567A |
| Intranet | ocms_offence_notice_owner_driver | name | JOHN LEE |
| Intranet | ocms_offence_notice_owner_driver | email_addr | john.lee@email.com |
| Intranet | ocms_offence_notice_owner_driver | offender_tel_code | 65 |
| Intranet | ocms_offence_notice_owner_driver | offender_tel_no | 91234567 |
| Intranet | ocms_offence_notice_owner_driver | offender_indicator | Y |
| Intranet | ocms_offence_notice_owner_driver | cre_user_id | ocmsiz_app_conn |
| Intranet | ocms_offence_notice_owner_driver_addr | notice_no | 500500303J |
| Intranet | ocms_offence_notice_owner_driver_addr | owner_driver_indicator | H |
| Intranet | ocms_offence_notice_owner_driver_addr | type_of_address | M |
| Intranet | ocms_offence_notice_owner_driver_addr | blk_hse_no | 123 |
| Intranet | ocms_offence_notice_owner_driver_addr | street_name | ORCHARD ROAD |
| Intranet | ocms_offence_notice_owner_driver_addr | bldg_name | PLAZA TOWER |
| Intranet | ocms_offence_notice_owner_driver_addr | floor_no | 01 |
| Intranet | ocms_offence_notice_owner_driver_addr | unit_no | 01 |
| Intranet | ocms_offence_notice_owner_driver_addr | postal_code | 238888 |
| Internet | eocms_furnish_application | notice_no | 500500303J |
| Internet | eocms_furnish_application | status | P |
| Internet | eocms_furnish_application | cre_user_id | ocmsez_app_conn |

### 5.2.3 Success Outcome

- Furnishability verified via OCMS API
- Existing offender data retrieved for pre-population (if exists)
- New offender record created or existing record updated
- offender_indicator set to 'Y' for new current offender
- Previous offender indicator cleared to 'N' (if applicable)
- Processing stage updated (RD1 for Hirer, DN for Driver)
- Next Print Schedule set to next day
- Changes synced to Internet DB
- Success response returned to PLUS

### 5.2.4 Error Handling

| Error Scenario       | App Error Code | User Message                                           | Brief Description             |
| -------------------- | -------------- | ------------------------------------------------------ | ----------------------------- |
| Notice Not Found     | OCMS-4006      | Notice not found                                       | Notice number does not exist  |
| Not Furnishable      | OCMS-4003      | Notice cannot be furnished at current processing stage | Processing stage not eligible |
| Stage After CPC      | OCMS-4005      | Notice processing stage is after CPC                   | Cannot furnish after CPC      |
| Validation Failed    | OCMS-4001      | {field} is required                                    | Missing required fields       |
| Invalid Format       | OCMS-4002      | Invalid {field} format                                 | Format validation error       |
| DB Update Failed     | OCMS-5001      | Failed to update database                              | Database operation failed     |
| External Comm Failed | OCMS-5002      | Failed to communicate with external system             | Communication error           |

---

## 5.3 PLUS Redirect

<!-- Insert flow diagram here -->

![Flow Diagram](./Section 5/images/5.3_PLUS_Redirect.png)

NOTE: Due to page size limit, the full-sized image is appended.

| Step                                    | Description                                        | Brief Description  |
| --------------------------------------- | -------------------------------------------------- | ------------------ |
| PLM initiates Redirect                  | PLM accesses Redirect from PLUS Staff Portal       | Initiate redirect  |
| PLUS Backend calls check-redirect       | Call OCMS API to verify Notice can be redirected   | Check redirect     |
| Query notice by noticeNo                | OCMS queries ocms_valid_offence_notice             | Query notice       |
| Notice exists?                          | Check if Notice is found                           | Check exists       |
| Return NOT_FOUND                        | Return not found error                             | Return error       |
| Check processing stage                  | Verify processing stage allows redirect            | Check stage        |
| Can redirect?                           | Evaluate if redirect is allowed                    | Check can redirect |
| Return NOT_REDIRECTABLE                 | Return not redirectable error                      | Return error       |
| Query current offender                  | Retrieve current offender record                   | Query current      |
| Has current offender?                   | Check if current offender exists                   | Check current      |
| Return NO_CURRENT_OFFENDER              | Return error if no current offender                | Return error       |
| Return redirectable status              | Return result with current offender info           | Return status      |
| Redirect allowed?                       | PLUS Portal checks if redirect is allowed          | Check allowed      |
| Display error                           | Show error if not redirectable                     | Show error         |
| PLUS Backend calls get-all-offenders    | Retrieve all Owner/Hirer/Driver data               | Get all offenders  |
| Query OND for all types                 | Query ocms_offence_notice_owner_driver for O, H, D | Query all OND      |
| Query OND_ADDR for each                 | Retrieve address for each offender                 | Query addresses    |
| Consolidate data                        | Aggregate Owner, Hirer, Driver data                | Consolidate        |
| Return all offenders                    | Return all offender details to PLUS                | Return data        |
| Display form with existing particulars  | Show form with Owner/Hirer/Driver data             | Display form       |
| PLM selects target offender type        | PLM chooses O, H, or D as target                   | Select target      |
| PLM edits particulars (optional)        | PLM modifies offender details                      | Edit details       |
| PLM clicks SUBMIT                       | PLM submits the redirect request                   | Click submit       |
| PLUS Backend calls redirect API         | Call OCMS redirect endpoint                        | Call redirect      |
| Bean validation                         | Validate request payload                           | Validate           |
| Valid?                                  | Check if validation passed                         | Check valid        |
| Return VALIDATION_ERROR                 | Return validation error to PLUS                    | Return error       |
| Query notice                            | Fetch notice from database                         | Query notice       |
| Exists?                                 | Check if notice found                              | Check exists       |
| Return NOT_FOUND                        | Return not found error                             | Return error       |
| Check redirect eligibility              | Re-verify redirect eligibility                     | Check eligibility  |
| Can redirect?                           | Evaluate redirect eligibility                      | Check can redirect |
| Return NOT_REDIRECTABLE                 | Return not redirectable error                      | Return error       |
| Query current offender                  | Retrieve current offender record                   | Query current      |
| Same as target?                         | Check if redirecting to same offender              | Check same         |
| Return SAME_OFFENDER                    | Return error if same offender                      | Return error       |
| Save updated address as Mailing Address | Update/Insert address in OND_ADDR                  | Save address       |
| Set previous offender_indicator = N     | Clear current offender flag                        | Clear previous     |
| Set new offender_indicator = Y          | Mark new offender as current                       | Set current        |
| Update processing stage                 | Reset to RD1 (Hirer) or DN (Driver)                | Update stage       |
| Set NPS = Next Day                      | Set Next Print Schedule                            | Set NPS            |
| Sync to Internet DB                     | Sync changes to Internet database                  | Sync Internet      |
| Return success response                 | Return success to PLUS                             | Return success     |
| Success?                                | PLUS Portal checks API response                    | Check success      |
| Display error                           | Show error message if failed                       | Show error         |
| Display success message                 | Show success confirmation                          | Show success       |

### 5.3.1 API Specification

#### Check Redirect Eligibility for PLUS

| Field                        | Value                                                                                                                                                                                                                                                  |
| ---------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| API Name                     | Check Redirect Eligibility for PLUS                                                                                                                                                                                                                    |
| URL                          | POST /${api.version}/plus-furnish/check-redirect                                                                                                                                                                                                       |
| Description                  | Checks whether a Notice can be redirected to a new Offender by PLUS                                                                                                                                                                                    |
| Request                      | `{ "noticeNo": "500500303J" }`                                                                                                                                                                                                                         |
| Response                     | `{ "data": { "appCode": "OCMS-2000", "message": "Check redirect successful", "noticeNo": "500500303J", "redirectable": true, "allowedTargetTypes": ["O", "H", "D"], "currentOffender": { "ownerDriverIndicator": "O", "name": "TAN AH KOW", "idNo": "S9876543B" } } }` |
| Response (Redirect Not Allowed) | `{ "data": { "appCode": "OCMS-4004", "message": "Notice cannot be redirected because processing stage is after CPC", "noticeNo": "500500303J", "redirectable": false, "allowedTargetTypes": [], "currentOffender": null } }`                           |

#### Get All Offenders for Redirect

| Field       | Value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| ----------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| API Name    | Get All Offenders for Redirect                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| URL         | POST /${api.version}/plus-furnish/get-all-offenders                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Description | Retrieves all existing Owner, Hirer, and Driver particulars for a Notice                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Request     | `{ "noticeNo": "500500303J" }`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Response    | `{ "data": { "appCode": "OCMS-2000", "message": "Get all offenders successful", "noticeNo": "500500303J", "currentOffenderIndicator": "O", "offenders": { "owner": { "name": "TAN AH KOW", "idType": "NRIC", "idNo": "S9876543B", "emailAddr": "tan@email.com", "offenderTelNo": "91112222", "address": { "blockNo": "456", "streetName": "BUKIT TIMAH ROAD", "buildingName": null, "floorNo": "05", "unitNo": "123", "postalCode": "289628" } }, "hirer": { "name": "JOHN LEE", "idType": "NRIC", "idNo": "S1234567A", "emailAddr": "john.lee@email.com", "offenderTelNo": "91234567", "address": { "blockNo": "123", "streetName": "ORCHARD ROAD", "buildingName": "PLAZA TOWER", "floorNo": "01", "unitNo": "01", "postalCode": "238888" } }, "driver": null } } }` |

#### Redirect Notice from PLUS

| Field            | Value                                                                                                                                                                                                                                                                                                                                                                                                                           |
| ---------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| API Name         | Redirect Notice from PLUS                                                                                                                                                                                                                                                                                                                                                                                                       |
| URL              | POST /${api.version}/plus-furnish/redirect                                                                                                                                                                                                                                                                                                                                                                                      |
| Description      | Redirects a Notice to a new Offender from PLUS                                                                                                                                                                                                                                                                                                                                                                                  |
| Request          | `{ "noticeNo": "500500303J", "targetOwnerDriverIndicator": "H", "idType": "NRIC", "idNo": "S1234567A", "name": "JOHN LEE", "emailAddr": "john.lee@email.com", "countryCode": "65", "offenderTelNo": "91234567", "address": { "blockNo": "123", "streetName": "ORCHARD ROAD", "buildingName": "PLAZA TOWER", "floorNo": "01", "unitNo": "01", "postalCode": "238888" } }`                                                          |
| Response         | `{ "data": { "appCode": "OCMS-2000", "message": "Redirect successful", "noticeNo": "500500303J", "previousOffender": { "ownerDriverIndicator": "O", "name": "TAN AH KOW", "idNo": "S9876543B" }, "newOffender": { "ownerDriverIndicator": "H", "name": "JOHN LEE", "idNo": "S1234567A" }, "newProcessingStage": "RD1", "nextPrintSchedule": "2026-01-08" } }`                                                                    |
| Response Failure | `{ "data": { "appCode": "OCMS-4004", "message": "Notice cannot be redirected because processing stage is after CPC", "noticeNo": "500500303J" } }`                                                                                                                                                                                                                                                                              |

### Processing Stage Transitions (PLUS Redirect)

| From Stage | Target Offender | New Stage | NPS      |
| ---------- | --------------- | --------- | -------- |
| Any        | H (Hirer)       | RD1       | Next Day |
| Any        | D (Driver)      | DN        | Next Day |

### Offender Indicator Transfer

| Step   | Previous Offender        | New Offender                     |
| ------ | ------------------------ | -------------------------------- |
| Before | offender_indicator = 'Y' | offender_indicator = 'N' or null |
| After  | offender_indicator = 'N' | offender_indicator = 'Y'         |

### 5.3.2 Data Mapping

| Zone | Database Table | Field Name | Value |
| ---- | -------------- | ---------- | ----- |
| Intranet | ocms_valid_offence_notice | notice_no | 500500303J |
| Intranet | ocms_valid_offence_notice | last_processing_stage | RD1 |
| Intranet | ocms_valid_offence_notice | next_processing_date | 2026-01-08 |
| Intranet | ocms_offence_notice_owner_driver | notice_no | 500500303J |
| Intranet | ocms_offence_notice_owner_driver | owner_driver_indicator | O (previous) |
| Intranet | ocms_offence_notice_owner_driver | offender_indicator | N |
| Intranet | ocms_offence_notice_owner_driver | upd_user_id | ocmsiz_app_conn |
| Intranet | ocms_offence_notice_owner_driver | notice_no | 500500303J |
| Intranet | ocms_offence_notice_owner_driver | owner_driver_indicator | H (new) |
| Intranet | ocms_offence_notice_owner_driver | id_type | N |
| Intranet | ocms_offence_notice_owner_driver | id_no | S1234567A |
| Intranet | ocms_offence_notice_owner_driver | name | JOHN LEE |
| Intranet | ocms_offence_notice_owner_driver | offender_indicator | Y |
| Intranet | ocms_offence_notice_owner_driver | cre_user_id | ocmsiz_app_conn |
| Intranet | ocms_offence_notice_owner_driver_addr | notice_no | 500500303J |
| Intranet | ocms_offence_notice_owner_driver_addr | owner_driver_indicator | H |
| Intranet | ocms_offence_notice_owner_driver_addr | type_of_address | M |
| Intranet | ocms_offence_notice_owner_driver_addr | blk_hse_no | 123 |
| Intranet | ocms_offence_notice_owner_driver_addr | street_name | ORCHARD ROAD |
| Intranet | ocms_offence_notice_owner_driver_addr | bldg_name | PLAZA TOWER |
| Intranet | ocms_offence_notice_owner_driver_addr | floor_no | 01 |
| Intranet | ocms_offence_notice_owner_driver_addr | unit_no | 01 |
| Intranet | ocms_offence_notice_owner_driver_addr | postal_code | 238888 |
| Internet | eocms_furnish_application | notice_no | 500500303J |
| Internet | eocms_furnish_application | status | P |
| Internet | eocms_furnish_application | upd_user_id | ocmsez_app_conn |

### 5.3.3 Success Outcome

- Redirect eligibility verified via OCMS API
- All existing Owner/Hirer/Driver data retrieved for display
- Previous offender's offender_indicator updated to 'N'
- New offender record created/updated with offender_indicator = 'Y'
- Mailing address saved for new offender
- Processing stage reset (RD1 for Hirer, DN for Driver)
- Next Print Schedule set to next day
- Changes synced to Internet DB
- Success response returned to PLUS with previous and new offender details

### 5.3.4 Error Handling

| Error Scenario      | App Error Code | User Message                                            | Brief Description                        |
| ------------------- | -------------- | ------------------------------------------------------- | ---------------------------------------- |
| Notice Not Found    | OCMS-4006      | Notice not found                                        | Notice number does not exist             |
| Not Redirectable    | OCMS-4004      | Notice cannot be redirected at current processing stage | Processing stage not eligible            |
| Stage After CPC     | OCMS-4005      | Notice processing stage is after CPC                    | Cannot redirect after CPC                |
| Invalid Target Type | OCMS-4007      | Invalid offender type for current processing stage      | Target type not allowed                  |
| Same Offender       | OCMS-4008      | Cannot redirect to the same current offender            | Target is same as current                |
| No Current Offender | OCMS-4009      | No current offender found                               | Cannot redirect without current offender |
| Validation Failed   | OCMS-4001      | {field} is required                                     | Missing required fields                  |
| Invalid Format      | OCMS-4002      | Invalid {field} format                                  | Format validation error                  |
| DB Update Failed    | OCMS-5001      | Failed to update database                               | Database operation failed                |

---
