<mxfile host="app.diagrams.net" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36" version="29.3.0" pages="11">
  <diagram id="tab2_1" name="2.1_High_Level_AN_Processing">
    <mxGraphModel dx="3466" dy="1837" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="8000" pageHeight="2000" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="title_2_1" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;fontSize=16;fontStyle=1" value="Section 2.1: High-Level Advisory Notices Processing Overview" vertex="1">
          <mxGeometry height="30" width="600" x="40" y="340" as="geometry" />
        </mxCell>
        <mxCell id="sw_backend_2_1" parent="1" style="swimlane;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" value="Backend (OCMS API)" vertex="1">
          <mxGeometry height="600" width="2500" x="20" y="380" as="geometry" />
        </mxCell>
        <mxCell id="s2_1_start" parent="sw_backend_2_1" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.terminator;whiteSpace=wrap;" value="Start" vertex="1">
          <mxGeometry height="60" width="120" x="40" y="100" as="geometry" />
        </mxCell>
        <mxCell id="s2_1_step1" parent="sw_backend_2_1" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Notice data received from external source or manual creation" vertex="1">
          <mxGeometry height="100" width="140" x="220" y="80" as="geometry" />
        </mxCell>
        <mxCell id="s2_1_step2" parent="sw_backend_2_1" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Validate mandatory fields and create notice in system" vertex="1">
          <mxGeometry height="100" width="140" x="420" y="80" as="geometry" />
        </mxCell>
        <mxCell id="s2_1_step3" parent="sw_backend_2_1" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Verify if notice qualifies as Advisory Notice (same-day check + qualification check)" vertex="1">
          <mxGeometry height="100" width="180" x="620" y="80" as="geometry" />
        </mxCell>
        <mxCell id="s2_1_dec1" parent="sw_backend_2_1" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.decision;whiteSpace=wrap;" value="Qualifies as AN (Advisory Notice)?" vertex="1">
          <mxGeometry height="130" width="130" x="870" y="65" as="geometry" />
        </mxCell>
        <mxCell id="s2_1_fail" parent="sw_backend_2_1" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Process as standard notice" vertex="1">
          <mxGeometry height="80" width="120" x="875" y="270" as="geometry" />
        </mxCell>
        <mxCell id="s2_1_step4" parent="sw_backend_2_1" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Set an_flag=&#39;Y&#39;, payment_acceptance_allowed=&#39;N&#39;" vertex="1">
          <mxGeometry height="100" width="150" x="1080" y="80" as="geometry" />
        </mxCell>
        <mxCell id="s2_1_step5" parent="sw_backend_2_1" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Call LTA (Land Transport Authority) API to retrieve vehicle owner particulars" vertex="1">
          <mxGeometry height="100" width="150" x="1310" y="80" as="geometry" />
        </mxCell>
        <mxCell id="s2_1_dec2" parent="sw_backend_2_1" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.decision;whiteSpace=wrap;" value="eAN (electronic Advisory Notice) Eligible? (mobile OR email available AND not in exclusion list AND not suspended)" vertex="1">
          <mxGeometry height="170" width="180" x="1540" y="45" as="geometry" />
        </mxCell>
        <mxCell id="s2_1_step6" parent="sw_backend_2_1" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Send SMS/Email to vehicle owner" vertex="1">
          <mxGeometry height="100" width="150" x="1800" y="80" as="geometry" />
        </mxCell>
        <mxCell id="s2_1_step7" parent="sw_backend_2_1" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Generate and send physical letter via SLIFT" vertex="1">
          <mxGeometry height="100" width="160" x="1550" y="280" as="geometry" />
        </mxCell>
        <mxCell id="s2_1_step8" parent="sw_backend_2_1" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Create PS-ANS suspension record for qualified AN" vertex="1">
          <mxGeometry height="100" width="160" x="2040" y="80" as="geometry" />
        </mxCell>
        <mxCell id="s2_1_end" parent="sw_backend_2_1" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.terminator;whiteSpace=wrap;" value="End" vertex="1">
          <mxGeometry height="60" width="120" x="2280" y="100" as="geometry" />
        </mxCell>
        <mxCell id="c2_1_1" edge="1" parent="1" source="s2_1_start" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s2_1_step1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c2_1_2" edge="1" parent="1" source="s2_1_step1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s2_1_step2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c2_1_3" edge="1" parent="1" source="s2_1_step2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s2_1_step3">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c2_1_4" edge="1" parent="1" source="s2_1_step3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s2_1_dec1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c2_1_5" edge="1" parent="1" source="s2_1_dec1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s2_1_step4" value="yes">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c2_1_6" edge="1" parent="1" source="s2_1_dec1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s2_1_fail" value="no">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c2_1_7" edge="1" parent="1" source="s2_1_step4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s2_1_step5">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c2_1_8" edge="1" parent="1" source="s2_1_step5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s2_1_dec2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c2_1_9" edge="1" parent="1" source="s2_1_dec2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s2_1_step6" value="yes">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c2_1_10" edge="1" parent="1" source="s2_1_dec2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s2_1_step7" value="no">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c2_1_11" edge="1" parent="1" source="s2_1_step6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s2_1_step8">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c2_1_12" edge="1" parent="1" source="s2_1_step7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s2_1_step8">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c2_1_13" edge="1" parent="1" source="s2_1_step8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s2_1_end">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="tab3_1" name="3.1_AN_Verification_Same_Day">
    <mxGraphModel dx="1155" dy="612" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="5000" pageHeight="1500" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="title_3_1" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;fontSize=16;fontStyle=1" value="Section 3.1: AN Verification - Same-Day Check" vertex="1">
          <mxGeometry height="30" width="500" x="40" y="20" as="geometry" />
        </mxCell>
        <mxCell id="sw_backend_3_1" parent="1" style="swimlane;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" value="Backend (OCMS API)" vertex="1">
          <mxGeometry height="400" width="1470" x="20" y="60" as="geometry" />
        </mxCell>
        <mxCell id="s3_1_start" parent="sw_backend_3_1" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.terminator;whiteSpace=wrap;" value="Start" vertex="1">
          <mxGeometry height="60" width="120" x="40" y="80" as="geometry" />
        </mxCell>
        <mxCell id="s3_1_step1" parent="sw_backend_3_1" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Receive Notice Data (vehicle number and notice date/time)" vertex="1">
          <mxGeometry height="100" width="160" x="220" y="60" as="geometry" />
        </mxCell>
        <mxCell id="s3_1_step2" parent="sw_backend_3_1" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Calculate Day Boundaries (00:00:00 to 23:59:59)" vertex="1">
          <mxGeometry height="100" width="160" x="440" y="60" as="geometry" />
        </mxCell>
        <mxCell id="s3_1_step3" parent="sw_backend_3_1" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Query Database for existing ANs on same day" vertex="1">
          <mxGeometry height="100" width="160" x="660" y="60" as="geometry" />
        </mxCell>
        <mxCell id="s3_1_dec1" parent="sw_backend_3_1" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.decision;whiteSpace=wrap;" value="Records Found?" vertex="1">
          <mxGeometry height="120" width="140" x="890" y="50" as="geometry" />
        </mxCell>
        <mxCell id="s3_1_fail" parent="sw_backend_3_1" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Return Not Qualified: &quot;Same-day limit exceeded&quot;" vertex="1">
          <mxGeometry height="100" width="140" x="890" y="240" as="geometry" />
        </mxCell>
        <mxCell id="s3_1_pass" parent="sw_backend_3_1" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Return Qualified: &quot;Vehicle within same-day limit&quot;" vertex="1">
          <mxGeometry height="100" width="140" x="1100" y="60" as="geometry" />
        </mxCell>
        <mxCell id="s3_1_end" parent="sw_backend_3_1" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.terminator;whiteSpace=wrap;" value="End" vertex="1">
          <mxGeometry height="60" width="120" x="1310" y="80" as="geometry" />
        </mxCell>
        <mxCell id="s3_1_query" parent="sw_backend_3_1" style="text;html=1;whiteSpace=wrap;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=middle;rounded=0;" value="SELECT * FROM ocms_valid_offence_notice&lt;br&gt;WHERE vehicle_no = [current vehicle]&lt;br&gt;&amp;nbsp;&amp;nbsp;AND an_flag = &#39;Y&#39;&lt;br&gt;&amp;nbsp;&amp;nbsp;AND notice_date_and_time &amp;gt;= [dayStart]&lt;br&gt;&amp;nbsp;&amp;nbsp;AND notice_date_and_time &amp;lt;= [dayEnd]" vertex="1">
          <mxGeometry height="120" width="380" x="480" y="220" as="geometry" />
        </mxCell>
        <mxCell id="c3_1_4" edge="1" parent="sw_backend_3_1" source="s3_1_step3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;" target="s3_1_query">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_1_1" edge="1" parent="1" source="s3_1_start" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_1_step1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_1_2" edge="1" parent="1" source="s3_1_step1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_1_step2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_1_3" edge="1" parent="1" source="s3_1_step2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_1_step3">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_1_5" edge="1" parent="1" source="s3_1_step3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_1_dec1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_1_6" edge="1" parent="1" source="s3_1_dec1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_1_fail" value="yes (count &amp;gt; 0)">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_1_7" edge="1" parent="1" source="s3_1_dec1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_1_pass" value="no (count = 0)">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_1_8" edge="1" parent="1" source="s3_1_pass" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_1_end">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_1_9" edge="1" parent="1" source="s3_1_fail" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_1_end">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="980" y="380" />
              <mxPoint x="1390" y="380" />
            </Array>
          </mxGeometry>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="tab3_2" name="3.2_AN_Verification_Qualification">
    <mxGraphModel dx="1427" dy="756" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="7000" pageHeight="1800" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="title_3_2" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;fontSize=16;fontStyle=1" value="Section 3.2: AN Verification - Qualification Check" vertex="1">
          <mxGeometry height="30" width="500" x="40" y="20" as="geometry" />
        </mxCell>
        <mxCell id="sw_backend_3_2" parent="1" style="swimlane;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" value="Backend (OCMS API)" vertex="1">
          <mxGeometry height="700" width="2600" x="20" y="60" as="geometry" />
        </mxCell>
        <mxCell id="s3_2_start" parent="sw_backend_3_2" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.terminator;whiteSpace=wrap;" value="Start" vertex="1">
          <mxGeometry height="60" width="120" x="40" y="100" as="geometry" />
        </mxCell>
        <mxCell id="APUnelsGrHz7-8aDQZV9-2" edge="1" parent="sw_backend_3_2" source="s3_2_step1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;dashed=1;dashPattern=8 8;" target="APUnelsGrHz7-8aDQZV9-1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s3_2_step1" parent="sw_backend_3_2" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Check Offense Type" vertex="1">
          <mxGeometry height="90" width="180" x="220" y="85" as="geometry" />
        </mxCell>
        <mxCell id="s3_2_dec1" parent="sw_backend_3_2" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.decision;whiteSpace=wrap;" value="Offense Type = &#39;O&#39;?" vertex="1">
          <mxGeometry height="120" width="140" x="470" y="70" as="geometry" />
        </mxCell>
        <mxCell id="s3_2_fail1" parent="sw_backend_3_2" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Return Not Qualified: &quot;Offense type must be &#39;O&#39;&quot;" vertex="1">
          <mxGeometry height="100" width="140" x="470" y="290" as="geometry" />
        </mxCell>
        <mxCell id="APUnelsGrHz7-8aDQZV9-4" edge="1" parent="sw_backend_3_2" source="s3_2_step2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;dashed=1;dashPattern=8 8;" target="APUnelsGrHz7-8aDQZV9-3">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s3_2_step2" parent="sw_backend_3_2" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Check Vehicle Type" vertex="1">
          <mxGeometry height="90" width="180" x="680" y="85" as="geometry" />
        </mxCell>
        <mxCell id="s3_2_dec2" parent="sw_backend_3_2" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.decision;whiteSpace=wrap;" value="Vehicle Type Valid?" vertex="1">
          <mxGeometry height="120" width="140" x="930" y="70" as="geometry" />
        </mxCell>
        <mxCell id="s3_2_fail2" parent="sw_backend_3_2" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Return Not Qualified: &quot;Vehicle type must be S/D/V/I&quot;" vertex="1">
          <mxGeometry height="100" width="140" x="930" y="290" as="geometry" />
        </mxCell>
        <mxCell id="APUnelsGrHz7-8aDQZV9-6" edge="1" parent="sw_backend_3_2" source="s3_2_step3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;dashed=1;dashPattern=8 8;" target="APUnelsGrHz7-8aDQZV9-5">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s3_2_step3" parent="sw_backend_3_2" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Check Exemption Rules" vertex="1">
          <mxGeometry height="100" width="180" x="1150" y="80" as="geometry" />
        </mxCell>
        <mxCell id="s3_2_dec3" parent="sw_backend_3_2" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.decision;whiteSpace=wrap;" value="Exempt?" vertex="1">
          <mxGeometry height="120" width="140" x="1390" y="70" as="geometry" />
        </mxCell>
        <mxCell id="s3_2_fail3" parent="sw_backend_3_2" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Return Not Qualified: &quot;Offense exempt from AN&quot;" vertex="1">
          <mxGeometry height="100" width="140" x="1390" y="290" as="geometry" />
        </mxCell>
        <mxCell id="s3_2_step4" parent="sw_backend_3_2" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Check Past Offense: Vehicle must have qualifying offense in past 24 months" vertex="1">
          <mxGeometry height="100" width="180" x="1660" y="80" as="geometry" />
        </mxCell>
        <mxCell id="s3_2_dec4" parent="sw_backend_3_2" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.decision;whiteSpace=wrap;" value="Has Past Offense?" vertex="1">
          <mxGeometry height="120" width="140" x="1980" y="70" as="geometry" />
        </mxCell>
        <mxCell id="s3_2_fail4" parent="sw_backend_3_2" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Return Not Qualified: &quot;No qualifying offense in past 24 months&quot;" vertex="1">
          <mxGeometry height="100" width="140" x="1980" y="280" as="geometry" />
        </mxCell>
        <mxCell id="s3_2_query" parent="sw_backend_3_2" style="text;html=1;whiteSpace=wrap;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=middle;rounded=0;" value="SELECT * FROM ocms_valid_offence_notice&lt;br&gt;WHERE vehicle_no = [current vehicle]&lt;br&gt;&amp;nbsp;&amp;nbsp;AND notice_date_and_time &amp;gt;= [currentDate - 24 months]&lt;br&gt;&amp;nbsp;&amp;nbsp;AND notice_date_and_time &amp;lt; [currentNoticeDate]" vertex="1">
          <mxGeometry height="100" width="420" x="1540" y="280" as="geometry" />
        </mxCell>
        <mxCell id="c3_2_12" edge="1" parent="sw_backend_3_2" source="s3_2_step4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;" target="s3_2_query">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="APUnelsGrHz7-8aDQZV9-1" parent="sw_backend_3_2" style="text;html=1;whiteSpace=wrap;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=middle;rounded=0;" value="Offense type must be &#39;O&#39; for AN eligibility" vertex="1">
          <mxGeometry height="60" width="130" x="245" y="230" as="geometry" />
        </mxCell>
        <mxCell id="APUnelsGrHz7-8aDQZV9-3" parent="sw_backend_3_2" style="text;html=1;whiteSpace=wrap;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=middle;rounded=0;" value="Vehicle registration type must be:&amp;nbsp;&lt;div&gt;- S&amp;nbsp;&lt;/div&gt;&lt;div&gt;- D&amp;nbsp;&lt;/div&gt;&lt;div&gt;- V&lt;/div&gt;&lt;div&gt;- I&amp;nbsp;&lt;/div&gt;" vertex="1">
          <mxGeometry height="90" width="135" x="702.5" y="230" as="geometry" />
        </mxCell>
        <mxCell id="APUnelsGrHz7-8aDQZV9-5" parent="sw_backend_3_2" style="text;html=1;whiteSpace=wrap;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=middle;rounded=0;" value="1. Offense code 20412 with composition amount = $80 is exempt from AN&lt;br&gt;2. Offense code 11210 with vehicle category &#39;LB&#39; (Loading Bay) or &#39;HL&#39; (Handicap Lot) is exempt from AN" vertex="1">
          <mxGeometry height="120" width="230" x="1125" y="230" as="geometry" />
        </mxCell>
        <mxCell id="s3_2_pass" parent="sw_backend_3_2" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Return Qualified: qualified=true" vertex="1">
          <mxGeometry height="100" width="140" x="2190" y="80" as="geometry" />
        </mxCell>
        <mxCell id="s3_2_end" parent="sw_backend_3_2" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.terminator;whiteSpace=wrap;" value="End" vertex="1">
          <mxGeometry height="60" width="120" x="2440" y="100" as="geometry" />
        </mxCell>
        <mxCell id="c3_2_15" edge="1" parent="sw_backend_3_2" source="s3_2_pass" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_2_end">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_2_1" edge="1" parent="1" source="s3_2_start" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_2_step1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_2_2" edge="1" parent="1" source="s3_2_step1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_2_dec1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_2_3" edge="1" parent="1" source="s3_2_dec1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_2_step2" value="yes">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_2_4" edge="1" parent="1" source="s3_2_dec1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_2_fail1" value="no">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_2_5" edge="1" parent="1" source="s3_2_step2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_2_dec2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_2_6" edge="1" parent="1" source="s3_2_dec2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_2_step3" value="yes">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_2_7" edge="1" parent="1" source="s3_2_dec2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_2_fail2" value="no">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_2_8" edge="1" parent="1" source="s3_2_step3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_2_dec3">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_2_9" edge="1" parent="1" source="s3_2_dec3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_2_fail3" value="yes">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_2_10" edge="1" parent="1" source="s3_2_dec3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_2_step4" value="no">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_2_11" edge="1" parent="1" source="s3_2_step4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_2_dec4">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_2_13" edge="1" parent="1" source="s3_2_dec4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_2_pass" value="yes">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_2_14" edge="1" parent="1" source="s3_2_dec4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_2_fail4" value="no">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_2_16" edge="1" parent="1" source="s3_2_fail1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_2_end">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="560" y="590" />
              <mxPoint x="2520" y="590" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="c3_2_17" edge="1" parent="1" source="s3_2_fail2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_2_end">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1020" y="590" />
              <mxPoint x="2520" y="590" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="c3_2_18" edge="1" parent="1" source="s3_2_fail3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_2_end">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1480" y="590" />
              <mxPoint x="2520" y="590" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="c3_2_19" edge="1" parent="1" source="s3_2_fail4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_2_end">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2070" y="590" />
              <mxPoint x="2520" y="590" />
            </Array>
          </mxGeometry>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="tab3_3" name="3.3_Receive_AN_REPCCS">
    <mxGraphModel dx="6065" dy="3215" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="8000" pageHeight="2000" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="title_3_3" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;fontSize=16;fontStyle=1" value="Section 3.3: Receive AN Data from REPCCS" vertex="1">
          <mxGeometry height="30" width="600" x="40" y="20" as="geometry" />
        </mxCell>
        <mxCell id="sw_external_3_3" parent="1" style="swimlane;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" value="External System (REPCCS)" vertex="1">
          <mxGeometry height="320" width="4790" x="20" y="60" as="geometry" />
        </mxCell>
        <mxCell id="s3_3_ext_send" parent="sw_external_3_3" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Send Webhook Payload" vertex="1">
          <mxGeometry height="80" width="160" x="20" y="80" as="geometry" />
        </mxCell>
        <mxCell id="s3_3_req_payload" parent="sw_external_3_3" style="text;html=1;whiteSpace=wrap;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;rounded=0;" value="POST /v1/repccsWebhook&lt;br&gt;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;transactionId&quot;: &quot;string&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;subsystemLabel&quot;: &quot;string (8)&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;anFlag&quot;: &quot;string (1)&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;noticeNo&quot;: &quot;string (10)&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;vehicleNo&quot;: &quot;string (14)&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;computerRuleCode&quot;: &quot;integer&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;compositionAmount&quot;: &quot;decimal&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;noticeDateAndTime&quot;: &quot;datetime&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;offenceNoticeType&quot;: &quot;string (1)&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;vehicleCategory&quot;: &quot;string (1)&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;vehicleRegistrationType&quot;: &quot;string (1)&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;ppCode&quot;: &quot;string (5)&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;ppName&quot;: &quot;string (100)&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;creUserId&quot;: &quot;string&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;creDate&quot;: &quot;datetime&quot;&lt;br&gt;}" vertex="1">
          <mxGeometry height="280" width="280" x="240" y="30" as="geometry" />
        </mxCell>
        <mxCell id="s3_3_ext_recv_success" parent="sw_external_3_3" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Receive Success Response" vertex="1">
          <mxGeometry height="80" width="160" x="3920" y="100" as="geometry" />
        </mxCell>
        <mxCell id="s3_3_ext_recv_error" parent="sw_external_3_3" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Receive Error Response" vertex="1">
          <mxGeometry height="80" width="160" x="4210" y="190" as="geometry" />
        </mxCell>
        <mxCell id="sw_backend_3_3" parent="1" style="swimlane;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" value="Backend (OCMS API)" vertex="1">
          <mxGeometry height="800" width="4790" x="20" y="380" as="geometry" />
        </mxCell>
        <mxCell id="s3_3_start" parent="sw_backend_3_3" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.terminator;whiteSpace=wrap;" value="Start" vertex="1">
          <mxGeometry height="60" width="120" x="40" y="100" as="geometry" />
        </mxCell>
        <mxCell id="s3_3_step1" parent="sw_backend_3_3" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Receive and parse RepWebHookPayloadDto from REPCCS webhook" vertex="1">
          <mxGeometry height="100" width="160" x="260" y="80" as="geometry" />
        </mxCell>
        <mxCell id="s3_3_step2" parent="sw_backend_3_3" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Validate mandatory fields: Apply BR-AN-REP-001 (Validate Mandatory Fields for REPCCS Webhook)" vertex="1">
          <mxGeometry height="140" width="180" x="520" y="60" as="geometry" />
        </mxCell>
        <mxCell id="s3_3_dec1" parent="sw_backend_3_3" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.decision;whiteSpace=wrap;" value="Valid Payload?" vertex="1">
          <mxGeometry height="120" width="140" x="830" y="70" as="geometry" />
        </mxCell>
        <mxCell id="s3_3_step3" parent="sw_backend_3_3" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Check duplicate notice: Apply BR-AN-DUP-001 (Duplicate Notice Detection)" vertex="1">
          <mxGeometry height="100" width="160" x="1090" y="80" as="geometry" />
        </mxCell>
        <mxCell id="s3_3_dec2" parent="sw_backend_3_3" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.decision;whiteSpace=wrap;" value="Duplicate Notice?" vertex="1">
          <mxGeometry height="120" width="140" x="1320" y="70" as="geometry" />
        </mxCell>
        <mxCell id="s3_3_step4" parent="sw_backend_3_3" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Detect vehicle type: Apply special vehicle detection (MID/MINDEF, UNLICENSED_PARKING)" vertex="1">
          <mxGeometry height="100" width="160" x="1560" y="80" as="geometry" />
        </mxCell>
        <mxCell id="s3_3_step5" parent="sw_backend_3_3" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Generate notice number if not provided by REPCCS" vertex="1">
          <mxGeometry height="100" width="160" x="1800" y="80" as="geometry" />
        </mxCell>
        <mxCell id="s3_3_step6" parent="sw_backend_3_3" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Insert notice records into database tables" vertex="1">
          <mxGeometry height="100" width="160" x="2030" y="80" as="geometry" />
        </mxCell>
        <mxCell id="s3_3_step7" parent="sw_backend_3_3" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Check double booking: Apply BR-AN-DUP-002 (Duplicate Offense Detection)" vertex="1">
          <mxGeometry height="100" width="180" x="2270" y="80" as="geometry" />
        </mxCell>
        <mxCell id="s3_3_dec3" parent="sw_backend_3_3" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.decision;whiteSpace=wrap;" value="Duplicate Offense (DBB)?" vertex="1">
          <mxGeometry height="120" width="140" x="2530" y="70" as="geometry" />
        </mxCell>
        <mxCell id="s3_3_step8_dbb" parent="sw_backend_3_3" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Create PS-DBB suspension record, early return with success" vertex="1">
          <mxGeometry height="100" width="160" x="2520" y="280" as="geometry" />
        </mxCell>
        <mxCell id="s3_3_step9" parent="sw_backend_3_3" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Run AN qualification check for offense_type=&#39;O&#39; and vehicle_type in [S,D,V,I]" vertex="1">
          <mxGeometry height="140" width="180" x="2860" y="60" as="geometry" />
        </mxCell>
        <mxCell id="s3_3_dec4" parent="sw_backend_3_3" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.decision;whiteSpace=wrap;" value="Qualifies as AN?" vertex="1">
          <mxGeometry height="120" width="140" x="3110" y="70" as="geometry" />
        </mxCell>
        <mxCell id="s3_3_step10" parent="sw_backend_3_3" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Update AN flags: Set an_flag=&#39;Y&#39;, payment_acceptance_allowed=&#39;N&#39;" vertex="1">
          <mxGeometry height="100" width="180" x="3320" y="80" as="geometry" />
        </mxCell>
        <mxCell id="s3_3_step11" parent="sw_backend_3_3" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Process uploaded photos/videos if present in payload" vertex="1">
          <mxGeometry height="100" width="160" x="3580" y="80" as="geometry" />
        </mxCell>
        <mxCell id="s3_3_return_success" parent="sw_backend_3_3" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;fillColor=#fff2cc;strokeColor=#d6b656;" value="Return Success: OCMS-2000, message='OK'" vertex="1">
          <mxGeometry height="100" width="160" x="3580" y="280" as="geometry" />
        </mxCell>
        <mxCell id="s3_3_return_error" parent="sw_backend_3_3" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;fillColor=#fff2cc;strokeColor=#d6b656;" value="Return Error: OCMS-4000, message='Missing mandatory fields / Duplicate notice'" vertex="1">
          <mxGeometry height="100" width="180" x="810" y="260" as="geometry" />
        </mxCell>
        <mxCell id="s3_3_success_resp" parent="sw_backend_3_3" style="text;html=1;whiteSpace=wrap;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;rounded=0;" value="Success Response:&lt;br&gt;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;HTTPStatusCode&quot;: &quot;200&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;HTTPStatusDescription&quot;: &quot;OK&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;data&quot;: {&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&quot;appCode&quot;: &quot;OCMS-2000&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&quot;message&quot;: &quot;OK&quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;}&lt;br&gt;}" vertex="1">
          <mxGeometry height="140" width="280" x="3860" y="60" as="geometry" />
        </mxCell>
        <mxCell id="s3_3_error_resp" parent="sw_backend_3_3" style="text;html=1;whiteSpace=wrap;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;rounded=0;" value="Error Response:&lt;br&gt;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;HTTPStatusCode&quot;: &quot;400&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;HTTPStatusDescription&quot;: &quot;Bad Request&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;data&quot;: {&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&quot;appCode&quot;: &quot;OCMS-4000&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&quot;message&quot;: &quot;Missing mandatory fields / Duplicate notice detected&quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;}&lt;br&gt;}" vertex="1">
          <mxGeometry height="160" width="180" x="560" y="320" as="geometry" />
        </mxCell>
        <mxCell id="s3_3_query_dup" parent="sw_backend_3_3" style="text;html=1;whiteSpace=wrap;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=middle;rounded=0;" value="SELECT notice_id FROM ocms_valid_offence_notice&lt;br&gt;WHERE notice_no = [noticeNo]" vertex="1">
          <mxGeometry height="60" width="320" x="1010" y="460" as="geometry" />
        </mxCell>
        <mxCell id="c3_3_8" edge="1" parent="sw_backend_3_3" source="s3_3_step3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;" target="s3_3_query_dup">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s3_3_insert_notice" parent="sw_backend_3_3" style="text;html=1;whiteSpace=wrap;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;rounded=0;" value="INSERT INTO ocms_valid_offence_notice&lt;br&gt;(notice_no, vehicle_no, computer_rule_code, composition_amount, ...)&lt;br&gt;&lt;br&gt;INSERT INTO ocms_offence_notice_detail&lt;br&gt;(notice_id, pp_code, pp_name, ...)&lt;br&gt;&lt;br&gt;INSERT INTO eocms_valid_offence_notice&lt;br&gt;(mirror record for Internet zone)" vertex="1">
          <mxGeometry height="160" width="400" x="1650" y="480" as="geometry" />
        </mxCell>
        <mxCell id="c3_3_14" edge="1" parent="sw_backend_3_3" source="s3_3_step6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;" target="s3_3_insert_notice">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s3_3_query_dbb" parent="sw_backend_3_3" style="text;html=1;whiteSpace=wrap;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;rounded=0;" value="SELECT * FROM ocms_valid_offence_notice&lt;br&gt;WHERE vehicle_no = [vehicleNo]&lt;br&gt;&amp;nbsp;&amp;nbsp;AND computer_rule_code = [ruleCode]&lt;br&gt;&amp;nbsp;&amp;nbsp;AND ABS(DATEDIFF(MINUTE, notice_date_and_time, [currentNoticeDateTime])) &amp;lt;= 15" vertex="1">
          <mxGeometry height="100" width="580" x="2070" y="670" as="geometry" />
        </mxCell>
        <mxCell id="c3_3_16" edge="1" parent="sw_backend_3_3" source="s3_3_step7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;" target="s3_3_query_dbb">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s3_3_insert_dbb" parent="sw_backend_3_3" style="text;html=1;whiteSpace=wrap;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;rounded=0;" value="INSERT INTO ocms_suspended_notice&lt;br&gt;(notice_id, ps_code=&#39;PS-DBB&#39;, reason_of_suspension=&#39;Double Booking Detected&#39;, ...)" vertex="1">
          <mxGeometry height="60" width="440" x="2380" y="500" as="geometry" />
        </mxCell>
        <mxCell id="c3_3_20" edge="1" parent="sw_backend_3_3" source="s3_3_step8_dbb" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;" target="s3_3_insert_dbb">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s3_3_update_an" parent="sw_backend_3_3" style="text;html=1;whiteSpace=wrap;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;rounded=0;" value="UPDATE ocms_valid_offence_notice&lt;br&gt;SET an_flag=&#39;Y&#39;, payment_acceptance_allowed=&#39;N&#39;&lt;br&gt;WHERE notice_id = [noticeId]" vertex="1">
          <mxGeometry height="80" width="400" x="3210" y="440" as="geometry" />
        </mxCell>
        <mxCell id="c3_3_25" edge="1" parent="sw_backend_3_3" source="s3_3_step10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;" target="s3_3_update_an">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_3_1" edge="1" parent="1" source="s3_3_ext_send" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_3_start">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_3_2" edge="1" parent="1" source="s3_3_ext_send" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;" target="s3_3_req_payload">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_3_3" edge="1" parent="1" source="s3_3_start" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_3_step1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_3_4" edge="1" parent="1" source="s3_3_step1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_3_step2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_3_5" edge="1" parent="1" source="s3_3_step2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_3_dec1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_3_6" edge="1" parent="1" source="s3_3_dec1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_3_step3" value="yes">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_3_7" edge="1" parent="1" source="s3_3_dec1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_3_return_error" value="no">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_3_9" edge="1" parent="1" source="s3_3_step3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_3_dec2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_3_10" edge="1" parent="1" source="s3_3_dec2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;jumpStyle=arc;" target="s3_3_return_error" value="yes">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1410" y="720" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="c3_3_11" edge="1" parent="1" source="s3_3_dec2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_3_step4" value="no">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_3_12" edge="1" parent="1" source="s3_3_step4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_3_step5">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_3_13" edge="1" parent="1" source="s3_3_step5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_3_step6">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_3_15" edge="1" parent="1" source="s3_3_step6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_3_step7">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_3_17" edge="1" parent="1" source="s3_3_step7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_3_dec3">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_3_18" edge="1" parent="1" source="s3_3_dec3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_3_step8_dbb" value="yes">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_3_19" edge="1" parent="1" source="s3_3_dec3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_3_step9" value="no">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_3_21" edge="1" parent="1" source="s3_3_step8_dbb" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;jumpStyle=arc;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" target="s3_3_return_success">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3560" y="710" />
              <mxPoint x="3560" y="710" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="c3_3_22" edge="1" parent="1" source="s3_3_step9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_3_dec4">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_3_23" edge="1" parent="1" source="s3_3_dec4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_3_step10" value="yes">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_3_24" edge="1" parent="1" source="s3_3_dec4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_3_step11" value="no">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3200" y="420" />
              <mxPoint x="3680" y="420" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="c3_3_26" edge="1" parent="1" source="s3_3_step10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_3_step11">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_3_27" edge="1" parent="1" source="s3_3_step11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_3_return_success">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_3_28" edge="1" parent="1" source="s3_3_return_success" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;" target="s3_3_success_resp">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_3_29" edge="1" parent="1" source="s3_3_return_error" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;" target="s3_3_error_resp">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_3_32" edge="1" parent="1" source="s3_3_success_resp" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_3_ext_recv_success">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_3_33" edge="1" parent="1" source="s3_3_error_resp" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;jumpStyle=arc;" target="s3_3_ext_recv_error">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="tab3_4" name="3.4_Receive_AN_CES">
    <mxGraphModel dx="6065" dy="3215" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="8500" pageHeight="2000" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="title_3_4" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;fontSize=16;fontStyle=1" value="Section 3.4: Receive AN Data from CES" vertex="1">
          <mxGeometry height="30" width="600" x="40" y="20" as="geometry" />
        </mxCell>
        <mxCell id="sw_external_3_4" parent="1" style="swimlane;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" value="External System (CES)" vertex="1">
          <mxGeometry height="310" width="5650" x="20" y="60" as="geometry" />
        </mxCell>
        <mxCell id="s3_4_ext_send" parent="sw_external_3_4" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Send Webhook Payload" vertex="1">
          <mxGeometry height="80" width="160" x="40" y="80" as="geometry" />
        </mxCell>
        <mxCell id="s3_4_req_payload" parent="sw_external_3_4" style="text;html=1;whiteSpace=wrap;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;rounded=0;" value="POST /v1/cesWebhook-create-notice&lt;br&gt;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;transactionId&quot;: &quot;string&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;subsystemLabel&quot;: &quot;string (3-8, 030-999)&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;anFlag&quot;: &quot;string (1)&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;noticeNo&quot;: &quot;string (10)&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;vehicleNo&quot;: &quot;string (14)&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;computerRuleCode&quot;: &quot;integer&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;compositionAmount&quot;: &quot;decimal&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;noticeDateAndTime&quot;: &quot;datetime&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;offenceNoticeType&quot;: &quot;string (1)&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;vehicleCategory&quot;: &quot;string (1)&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;vehicleRegistrationType&quot;: &quot;string (1)&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;ppCode&quot;: &quot;string (5)&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;ppName&quot;: &quot;string (100)&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;creUserId&quot;: &quot;string&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;creDate&quot;: &quot;datetime&quot;&lt;br&gt;}" vertex="1">
          <mxGeometry height="270" width="320" x="260" y="30" as="geometry" />
        </mxCell>
        <mxCell id="s3_4_ext_recv_success" parent="sw_external_3_4" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Receive Success Response" vertex="1">
          <mxGeometry height="80" width="160" x="5160" y="130" as="geometry" />
        </mxCell>
        <mxCell id="s3_4_ext_recv_error" parent="sw_external_3_4" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Receive Error Response" vertex="1">
          <mxGeometry height="80" width="160" x="5440" y="190" as="geometry" />
        </mxCell>
        <mxCell id="sw_backend_3_4" parent="1" style="swimlane;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" value="Backend (OCMS API)" vertex="1">
          <mxGeometry height="900" width="5650" x="20" y="380" as="geometry" />
        </mxCell>
        <mxCell id="s3_4_start" parent="sw_backend_3_4" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.terminator;whiteSpace=wrap;" value="Start" vertex="1">
          <mxGeometry height="60" width="120" x="40" y="100" as="geometry" />
        </mxCell>
        <mxCell id="s3_4_step1" parent="sw_backend_3_4" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Receive and parse CesCreateNoticeDto from CES webhook" vertex="1">
          <mxGeometry height="100" width="160" x="220" y="80" as="geometry" />
        </mxCell>
        <mxCell id="s3_4_step2" parent="sw_backend_3_4" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Validate mandatory fields: Apply Business Rule AN-CES-001 (Validate Mandatory Fields for CES Webhook)" vertex="1">
          <mxGeometry height="140" width="180" x="450" y="60" as="geometry" />
        </mxCell>
        <mxCell id="s3_4_dec1" parent="sw_backend_3_4" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.decision;whiteSpace=wrap;" value="Valid Payload?" vertex="1">
          <mxGeometry height="120" width="140" x="720" y="70" as="geometry" />
        </mxCell>
        <mxCell id="s3_4_step3" parent="sw_backend_3_4" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Validate subsystem label: Apply Business Rule AN-CES-001 (length 3-8 chars, numeric 030-999)" vertex="1">
          <mxGeometry height="140" width="180" x="960" y="60" as="geometry" />
        </mxCell>
        <mxCell id="s3_4_dec2" parent="sw_backend_3_4" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.decision;whiteSpace=wrap;" value="Valid Subsystem?" vertex="1">
          <mxGeometry height="120" width="140" x="1300" y="70" as="geometry" />
        </mxCell>
        <mxCell id="s3_4_step4" parent="sw_backend_3_4" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Check duplicate notice: Apply Business Rule AN-DUP-001 (Duplicate Notice Detection)" vertex="1">
          <mxGeometry height="100" width="160" x="1510" y="80" as="geometry" />
        </mxCell>
        <mxCell id="s3_4_dec3" parent="sw_backend_3_4" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.decision;whiteSpace=wrap;" value="Duplicate Notice?" vertex="1">
          <mxGeometry height="120" width="140" x="1780" y="70" as="geometry" />
        </mxCell>
        <mxCell id="s3_4_step5" parent="sw_backend_3_4" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Validate offense rule code: Apply Business Rule AN-CES-002 (check offense_rule_code table)" vertex="1">
          <mxGeometry height="140" width="180" x="2000" y="60" as="geometry" />
        </mxCell>
        <mxCell id="s3_4_dec4" parent="sw_backend_3_4" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.decision;whiteSpace=wrap;" value="Valid Rule Code?" vertex="1">
          <mxGeometry height="120" width="140" x="2260" y="70" as="geometry" />
        </mxCell>
        <mxCell id="s3_4_step6" parent="sw_backend_3_4" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Detect vehicle type: Apply special vehicle detection (MID/MINDEF, UNLICENSED_PARKING)" vertex="1">
          <mxGeometry height="100" width="160" x="2480" y="80" as="geometry" />
        </mxCell>
        <mxCell id="s3_4_step7" parent="sw_backend_3_4" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Check EHT/Certis AN Flag: Apply Business Rule AN-EHT-001 (subsystem 030-999 with an_flag=&#39;Y&#39;)" vertex="1">
          <mxGeometry height="140" width="180" x="2710" y="60" as="geometry" />
        </mxCell>
        <mxCell id="s3_4_dec5" parent="sw_backend_3_4" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.decision;whiteSpace=wrap;" value="EHT with AN Flag?" vertex="1">
          <mxGeometry height="120" width="140" x="2960" y="70" as="geometry" />
        </mxCell>
        <mxCell id="s3_4_step8_ans" parent="sw_backend_3_4" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Create PS-ANS suspension: Insert notice records and create immediate suspension, early return with success" vertex="1">
          <mxGeometry height="120" width="160" x="2950" y="250" as="geometry" />
        </mxCell>
        <mxCell id="s3_4_step9" parent="sw_backend_3_4" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Insert notice records into database tables (ocms_valid_offence_notice, ocms_offence_notice_detail, eocms_valid_offence_notice)" vertex="1">
          <mxGeometry height="140" width="200" x="3240" y="60" as="geometry" />
        </mxCell>
        <mxCell id="s3_4_step10" parent="sw_backend_3_4" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Check double booking: Apply Business Rule AN-DUP-002 (Duplicate Offense Detection)" vertex="1">
          <mxGeometry height="100" width="180" x="3580" y="80" as="geometry" />
        </mxCell>
        <mxCell id="s3_4_dec6" parent="sw_backend_3_4" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.decision;whiteSpace=wrap;" value="Duplicate Offense (DBB)?" vertex="1">
          <mxGeometry height="120" width="140" x="3890" y="70" as="geometry" />
        </mxCell>
        <mxCell id="s3_4_step11_dbb" parent="sw_backend_3_4" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Create PS-DBB suspension record, early return with success" vertex="1">
          <mxGeometry height="100" width="160" x="3880" y="340" as="geometry" />
        </mxCell>
        <mxCell id="s3_4_step12" parent="sw_backend_3_4" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Run AN qualification check for offense_type=&#39;O&#39; and vehicle_type in [S,D,V,I]" vertex="1">
          <mxGeometry height="140" width="180" x="4100" y="60" as="geometry" />
        </mxCell>
        <mxCell id="s3_4_dec7" parent="sw_backend_3_4" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.decision;whiteSpace=wrap;" value="Qualifies as AN?" vertex="1">
          <mxGeometry height="120" width="140" x="4350" y="70" as="geometry" />
        </mxCell>
        <mxCell id="s3_4_step13" parent="sw_backend_3_4" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Update AN flags: Set an_flag=&#39;Y&#39;, payment_acceptance_allowed=&#39;N&#39;" vertex="1">
          <mxGeometry height="100" width="180" x="4560" y="80" as="geometry" />
        </mxCell>
        <mxCell id="s3_4_step14" parent="sw_backend_3_4" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Process uploaded photos/videos if present in payload" vertex="1">
          <mxGeometry height="100" width="160" x="4820" y="80" as="geometry" />
        </mxCell>
        <mxCell id="s3_4_return_success" parent="sw_backend_3_4" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;fillColor=#fff2cc;strokeColor=#d6b656;" value="Return Success: OCMS-2000, message='Resource created successfully'" vertex="1">
          <mxGeometry height="100" width="160" x="4820" y="310" as="geometry" />
        </mxCell>
        <mxCell id="s3_4_success_resp" parent="sw_backend_3_4" style="text;html=1;whiteSpace=wrap;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;rounded=0;" value="Success Response:&lt;br&gt;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;HTTPStatusCode&quot;: &quot;200&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;HTTPStatusDescription&quot;: &quot;OK&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;data&quot;: {&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&quot;appCode&quot;: &quot;OCMS-2000&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&quot;message&quot;: &quot;Resource created successfully&quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;}&lt;br&gt;}" vertex="1">
          <mxGeometry height="160" width="320" x="5080" y="60" as="geometry" />
        </mxCell>
        <mxCell id="s3_4_return_error1" parent="sw_backend_3_4" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;fillColor=#fff2cc;strokeColor=#d6b656;" value="Return Error: OCMS-4000, message='Validation error'" vertex="1">
          <mxGeometry height="100" width="160" x="710" y="490" as="geometry" />
        </mxCell>
        <mxCell id="s3_4_error_resp1" parent="sw_backend_3_4" style="text;html=1;whiteSpace=wrap;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;rounded=0;" value="Error Response (validation):&lt;br&gt;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;HTTPStatusCode&quot;: &quot;400&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;HTTPStatusDescription&quot;: &quot;Bad Request&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;data&quot;: {&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&quot;appCode&quot;: &quot;OCMS-4000&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&quot;message&quot;: &quot;subsystemlabel Length &lt; 3 / subsystemlabel Length &gt; 8 / subsystemlabel Not in Range 030-999&quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;}&lt;br&gt;}" vertex="1">
          <mxGeometry height="180" width="220" x="420" y="520" as="geometry" />
        </mxCell>
        <mxCell id="c3_4_40" edge="1" parent="sw_backend_3_4" source="s3_4_return_error1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;entryX=1;entryY=0.25;entryDx=0;entryDy=0;" target="s3_4_error_resp1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s3_4_return_error2" parent="sw_backend_3_4" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;fillColor=#fff2cc;strokeColor=#d6b656;" value="Return Error: OCMS-2026, message='Notice already exists / Invalid Rule Code'" vertex="1">
          <mxGeometry height="120" width="180" x="1760" y="360" as="geometry" />
        </mxCell>
        <mxCell id="s3_4_error_resp2" parent="sw_backend_3_4" style="text;html=1;whiteSpace=wrap;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;rounded=0;" value="Error Response (duplicate/rule):&lt;br&gt;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;HTTPStatusCode&quot;: &quot;226&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;HTTPStatusDescription&quot;: &quot;IM Used&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;data&quot;: {&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&quot;appCode&quot;: &quot;OCMS-2026&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&quot;message&quot;: &quot;Notice number already exists / Invalid Offence Rule Code&quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;}&lt;br&gt;}" vertex="1">
          <mxGeometry height="180" width="200" x="1460" y="410" as="geometry" />
        </mxCell>
        <mxCell id="c3_4_41" edge="1" parent="sw_backend_3_4" source="s3_4_return_error2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;entryX=1;entryY=0.25;entryDx=0;entryDy=0;" target="s3_4_error_resp2">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1710" y="420" />
              <mxPoint x="1710" y="460" />
              <mxPoint x="1660" y="460" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="s3_4_query_dup" parent="sw_backend_3_4" style="text;html=1;whiteSpace=wrap;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=middle;rounded=0;" value="SELECT notice_id FROM ocms_valid_offence_notice&lt;br&gt;WHERE notice_no = [noticeNo]" vertex="1">
          <mxGeometry height="60" width="320" x="1430" y="240" as="geometry" />
        </mxCell>
        <mxCell id="c3_4_11" edge="1" parent="sw_backend_3_4" source="s3_4_step4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;" target="s3_4_query_dup">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s3_4_query_rule" parent="sw_backend_3_4" style="text;html=1;whiteSpace=wrap;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=middle;rounded=0;" value="SELECT rule_code FROM ocms_offence_rule_code&lt;br&gt;WHERE rule_code = [computerRuleCode]" vertex="1">
          <mxGeometry height="60" width="340" x="1920" y="530" as="geometry" />
        </mxCell>
        <mxCell id="c3_4_15" edge="1" parent="sw_backend_3_4" source="s3_4_step5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;" target="s3_4_query_rule">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s3_4_insert_ans" parent="sw_backend_3_4" style="text;html=1;whiteSpace=wrap;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;rounded=0;" value="INSERT INTO ocms_suspended_notice&lt;br&gt;(notice_id, ps_code=&#39;PS-ANS&#39;, reason_of_suspension=&#39;EHT/Certis AN Flag&#39;, ...)" vertex="1">
          <mxGeometry height="60" width="440" x="2810" y="420" as="geometry" />
        </mxCell>
        <mxCell id="c3_4_23" edge="1" parent="sw_backend_3_4" source="s3_4_step8_ans" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;" target="s3_4_insert_ans">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s3_4_insert_notice" parent="sw_backend_3_4" style="text;html=1;whiteSpace=wrap;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;rounded=0;" value="INSERT INTO ocms_valid_offence_notice&lt;br&gt;(notice_no, vehicle_no, computer_rule_code, composition_amount, ...)&lt;br&gt;&lt;br&gt;INSERT INTO ocms_offence_notice_detail&lt;br&gt;(notice_id, pp_code, pp_name, ...)&lt;br&gt;&lt;br&gt;INSERT INTO eocms_valid_offence_notice&lt;br&gt;(mirror record for Internet zone)" vertex="1">
          <mxGeometry height="160" width="400" x="3140" y="660" as="geometry" />
        </mxCell>
        <mxCell id="c3_4_25" edge="1" parent="sw_backend_3_4" source="s3_4_step9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;" target="s3_4_insert_notice">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s3_4_query_dbb" parent="sw_backend_3_4" style="text;html=1;whiteSpace=wrap;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;rounded=0;" value="SELECT * FROM ocms_valid_offence_notice&lt;br&gt;WHERE vehicle_no = [vehicleNo]&lt;br&gt;&amp;nbsp;&amp;nbsp;AND computer_rule_code = [ruleCode]&lt;br&gt;&amp;nbsp;&amp;nbsp;AND ABS(DATEDIFF(MINUTE, notice_date_and_time, [currentNoticeDateTime])) &amp;lt;= 15" vertex="1">
          <mxGeometry height="100" width="580" x="3360" y="505" as="geometry" />
        </mxCell>
        <mxCell id="c3_4_27" edge="1" parent="sw_backend_3_4" source="s3_4_step10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;" target="s3_4_query_dbb">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s3_4_insert_dbb" parent="sw_backend_3_4" style="text;html=1;whiteSpace=wrap;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;rounded=0;" value="INSERT INTO ocms_suspended_notice&lt;br&gt;(notice_id, ps_code=&#39;PS-DBB&#39;, reason_of_suspension=&#39;Double Booking Detected&#39;, ...)" vertex="1">
          <mxGeometry height="60" width="440" x="4000" y="530" as="geometry" />
        </mxCell>
        <mxCell id="c3_4_31" edge="1" parent="sw_backend_3_4" source="s3_4_step11_dbb" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;" target="s3_4_insert_dbb">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s3_4_update_an" parent="sw_backend_3_4" style="text;html=1;whiteSpace=wrap;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;rounded=0;" value="UPDATE ocms_valid_offence_notice&lt;br&gt;SET an_flag=&#39;Y&#39;, payment_acceptance_allowed=&#39;N&#39;&lt;br&gt;WHERE notice_id = [noticeId]" vertex="1">
          <mxGeometry height="80" width="400" x="4450" y="220" as="geometry" />
        </mxCell>
        <mxCell id="c3_4_36" edge="1" parent="sw_backend_3_4" source="s3_4_step13" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;" target="s3_4_update_an">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_4_1" edge="1" parent="1" source="s3_4_ext_send" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_4_start">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_4_2" edge="1" parent="1" source="s3_4_ext_send" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;" target="s3_4_req_payload">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_4_3" edge="1" parent="1" source="s3_4_start" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_4_step1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_4_4" edge="1" parent="1" source="s3_4_step1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_4_step2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_4_5" edge="1" parent="1" source="s3_4_step2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_4_dec1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_4_6" edge="1" parent="1" source="s3_4_dec1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_4_step3" value="yes">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_4_7" edge="1" parent="1" source="s3_4_dec1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_4_return_error1" value="no">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_4_8" edge="1" parent="1" source="s3_4_step3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_4_dec2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_4_9" edge="1" parent="1" source="s3_4_dec2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_4_step4" value="yes">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_4_10" edge="1" parent="1" source="s3_4_dec2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" target="s3_4_return_error1" value="no">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1390" y="810" />
              <mxPoint x="810" y="810" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="c3_4_12" edge="1" parent="1" source="s3_4_step4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_4_dec3">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_4_13" edge="1" parent="1" source="s3_4_dec3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;exitPerimeter=0;" target="s3_4_return_error2" value="yes">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1870" y="630" />
              <mxPoint x="1870" y="630" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="c3_4_14" edge="1" parent="1" source="s3_4_dec3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_4_step5" value="no">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_4_16" edge="1" parent="1" source="s3_4_step5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_4_dec4">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_4_17" edge="1" parent="1" source="s3_4_dec4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_4_step6" value="yes">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_4_18" edge="1" parent="1" source="s3_4_dec4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.996;entryY=0.606;entryDx=0;entryDy=0;entryPerimeter=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;exitPerimeter=0;jumpStyle=arc;" target="s3_4_return_error2" value="no">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_4_19" edge="1" parent="1" source="s3_4_step6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_4_step7">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_4_20" edge="1" parent="1" source="s3_4_step7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_4_dec5">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_4_21" edge="1" parent="1" source="s3_4_dec5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_4_step8_ans" value="yes">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_4_22" edge="1" parent="1" source="s3_4_dec5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_4_step9" value="no">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_4_24" edge="1" parent="1" source="s3_4_step8_ans" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" target="s3_4_return_success">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="4740" y="690" />
              <mxPoint x="4740" y="740" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="c3_4_26" edge="1" parent="1" source="s3_4_step9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_4_step10">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_4_28" edge="1" parent="1" source="s3_4_step10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_4_dec6">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_4_29" edge="1" parent="1" source="s3_4_dec6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_4_step11_dbb" value="yes">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_4_30" edge="1" parent="1" source="s3_4_dec6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_4_step12" value="no">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_4_32" edge="1" parent="1" source="s3_4_step11_dbb" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" target="s3_4_return_success">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="4740" y="770" />
              <mxPoint x="4740" y="740" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="c3_4_33" edge="1" parent="1" source="s3_4_step12" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_4_dec7">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_4_34" edge="1" parent="1" source="s3_4_dec7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_4_step13" value="yes">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_4_35" edge="1" parent="1" source="s3_4_dec7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_4_step14" value="no">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="4440" y="240" />
              <mxPoint x="4920" y="240" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="c3_4_37" edge="1" parent="1" source="s3_4_step13" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_4_step14">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_4_38" edge="1" parent="1" source="s3_4_step14" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_4_return_success">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_4_39" edge="1" parent="1" source="s3_4_return_success" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;" target="s3_4_success_resp">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_4_45" edge="1" parent="1" source="s3_4_success_resp" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_4_ext_recv_success">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_4_46" edge="1" parent="1" source="s3_4_error_resp1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_4_ext_recv_error">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_4_47" edge="1" parent="1" source="s3_4_error_resp2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_4_ext_recv_error">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="tab3_5" name="3.5_Retrieve_Owner_Particulars">
    <mxGraphModel dx="2000" dy="1200" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="8000" pageHeight="2000" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="title_tab3_5" value="Section 3.5: Retrieve Vehicle Owner Particulars (LTA + DataHive/MHA)" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;fontSize=16;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="40" y="20" width="600" height="30" as="geometry" />
        </mxCell>
        <mxCell id="sw_backend_3_5" value="Backend (OCMS API)" style="swimlane;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="20" y="80" width="7800" height="360" as="geometry" />
        </mxCell>
        <mxCell id="s3_5_start" value="Start" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.terminator;whiteSpace=wrap;" vertex="1" parent="sw_backend_3_5">
          <mxGeometry x="40" y="60" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="s3_5_step1" value="Check Vehicle Type: Apply OP-AN-LTA-001 (Check vehicle registration type)" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" vertex="1" parent="sw_backend_3_5">
          <mxGeometry x="220" y="50" width="160" height="80" as="geometry" />
        </mxCell>
        <mxCell id="s3_5_dec1" value="Military Vehicle? (vehicle_registration_type = &#39;I&#39;)" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.decision;whiteSpace=wrap;" vertex="1" parent="sw_backend_3_5">
          <mxGeometry x="440" y="40" width="140" height="100" as="geometry" />
        </mxCell>
        <mxCell id="s3_5_step2_military" value="Set Military Owner: owner = MINDEF, skip LTA API call" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" vertex="1" parent="sw_backend_3_5">
          <mxGeometry x="430" y="220" width="160" height="80" as="geometry" />
        </mxCell>
        <mxCell id="s3_5_step3" value="Call LTA API: Apply OP-AN-LTA-001 (Call LTA API with vehicle number)" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" vertex="1" parent="sw_backend_3_5">
          <mxGeometry x="640" y="50" width="160" height="80" as="geometry" />
        </mxCell>
        <mxCell id="s3_5_dec2" value="LTA Success?" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.decision;whiteSpace=wrap;" vertex="1" parent="sw_backend_3_5">
          <mxGeometry x="860" y="40" width="140" height="100" as="geometry" />
        </mxCell>
        <mxCell id="s3_5_manual1" value="Manual Review Queue" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" vertex="1" parent="sw_backend_3_5">
          <mxGeometry x="850" y="220" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="s3_5_step4" value="Store Owner Details: Save vehicle owner name, NRIC/FIN, registration details" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" vertex="1" parent="sw_backend_3_5">
          <mxGeometry x="1060" y="50" width="180" height="80" as="geometry" />
        </mxCell>
        <mxCell id="s3_5_step5" value="Check Suspension Status: Apply OP-AN-DATAHIVE-001 (Check if notice suspended)" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" vertex="1" parent="sw_backend_3_5">
          <mxGeometry x="1300" y="50" width="180" height="80" as="geometry" />
        </mxCell>
        <mxCell id="s3_5_dec3" value="Notice Suspended? (suspension_type != NULL)" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.decision;whiteSpace=wrap;" vertex="1" parent="sw_backend_3_5">
          <mxGeometry x="1540" y="40" width="140" height="100" as="geometry" />
        </mxCell>
        <mxCell id="s3_5_skip" value="Skip Notification: Do not send notification for suspended notice" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" vertex="1" parent="sw_backend_3_5">
          <mxGeometry x="1530" y="220" width="160" height="80" as="geometry" />
        </mxCell>
        <mxCell id="s3_5_step6" value="Check Exclusion List: Apply OP-AN-DATAHIVE-001 (Check if owner in eNotification exclusion list)" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" vertex="1" parent="sw_backend_3_5">
          <mxGeometry x="1740" y="50" width="180" height="80" as="geometry" />
        </mxCell>
        <mxCell id="s3_5_dec4" value="In Exclusion List?" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.decision;whiteSpace=wrap;" vertex="1" parent="sw_backend_3_5">
          <mxGeometry x="1980" y="40" width="140" height="100" as="geometry" />
        </mxCell>
        <mxCell id="s3_5_step7_datahive" value="Call DataHive API: Apply OP-AN-DATAHIVE-001 (Get mobile/email)" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" vertex="1" parent="sw_backend_3_5">
          <mxGeometry x="2180" y="50" width="160" height="80" as="geometry" />
        </mxCell>
        <mxCell id="s3_5_dec5" value="Contact Found? (mobile OR email)" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.decision;whiteSpace=wrap;" vertex="1" parent="sw_backend_3_5">
          <mxGeometry x="2400" y="40" width="140" height="100" as="geometry" />
        </mxCell>
        <mxCell id="s3_5_step8_ean" value="Qualify for eAN: Set eAN eligible flag, proceed to Tab 3.6" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" vertex="1" parent="sw_backend_3_5">
          <mxGeometry x="2600" y="50" width="160" height="80" as="geometry" />
        </mxCell>
        <mxCell id="s3_5_step9_mha" value="Call MHA (Ministry of Home Affairs) API: Apply OP-AN-MHA-001 (Get registered address)" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" vertex="1" parent="sw_backend_3_5">
          <mxGeometry x="2820" y="50" width="160" height="80" as="geometry" />
        </mxCell>
        <mxCell id="s3_5_dec6" value="Address Found?" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.decision;whiteSpace=wrap;" vertex="1" parent="sw_backend_3_5">
          <mxGeometry x="3040" y="40" width="140" height="100" as="geometry" />
        </mxCell>
        <mxCell id="s3_5_step10_letter" value="Qualify for AN Letter: Set AN letter flag, proceed to Tab 3.7" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" vertex="1" parent="sw_backend_3_5">
          <mxGeometry x="3240" y="50" width="160" height="80" as="geometry" />
        </mxCell>
        <mxCell id="s3_5_manual2" value="Manual Review Queue" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" vertex="1" parent="sw_backend_3_5">
          <mxGeometry x="3030" y="220" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="s3_5_end" value="End" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.terminator;whiteSpace=wrap;" vertex="1" parent="sw_backend_3_5">
          <mxGeometry x="3460" y="60" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="sw_ext_lta_3_5" value="External System (LTA)" style="swimlane;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="20" y="460" width="7800" height="280" as="geometry" />
        </mxCell>
        <mxCell id="s3_5_api_lta" value="LTA API (OP-AN-LTA-001):&lt;br&gt;&lt;br&gt;GET LTA_API/vehicle/owner?vehicleNo=[vehicle_number]&lt;br&gt;Headers:&lt;br&gt;&amp;nbsp;&amp;nbsp;API-Key: [from Azure Key Vault]&lt;br&gt;&lt;br&gt;Response:&lt;br&gt;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;ownerName&quot;: &quot;string&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;ownerNRIC&quot;: &quot;string&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;vehicleMake&quot;: &quot;string&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;vehicleModel&quot;: &quot;string&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;roadTaxExpiry&quot;: &quot;date&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;diplomaticFlag&quot;: &quot;boolean&quot;&lt;br&gt;}&lt;br&gt;&lt;br&gt;Timeout: 30 seconds | Retry: 3 attempts" style="text;html=1;whiteSpace=wrap;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;rounded=0;" vertex="1" parent="sw_ext_lta_3_5">
          <mxGeometry x="540" y="40" width="360" height="220" as="geometry" />
        </mxCell>
        <mxCell id="sw_ext_datahive_3_5" value="External System (DataHive)" style="swimlane;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="20" y="760" width="7800" height="280" as="geometry" />
        </mxCell>
        <mxCell id="s3_5_api_datahive" value="DataHive API (OP-AN-DATAHIVE-001):&lt;br&gt;&lt;br&gt;GET DATAHIVE_API/contact?nric=[owner_nric]&lt;br&gt;Headers:&lt;br&gt;&amp;nbsp;&amp;nbsp;API-Key: [from Azure Key Vault]&lt;br&gt;&lt;br&gt;Response:&lt;br&gt;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;mobileNumber&quot;: &quot;string&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;emailAddress&quot;: &quot;string&quot;&lt;br&gt;}&lt;br&gt;&lt;br&gt;Timeout: 30 seconds | Retry: 3 attempts" style="text;html=1;whiteSpace=wrap;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;rounded=0;" vertex="1" parent="sw_ext_datahive_3_5">
          <mxGeometry x="2060" y="40" width="360" height="200" as="geometry" />
        </mxCell>
        <mxCell id="sw_ext_mha_3_5" value="External System (MHA)" style="swimlane;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="20" y="1060" width="7800" height="300" as="geometry" />
        </mxCell>
        <mxCell id="s3_5_api_mha" value="MHA API (OP-AN-MHA-001):&lt;br&gt;&lt;br&gt;GET MHA_API/address?nric=[owner_nric]&lt;br&gt;Headers:&lt;br&gt;&amp;nbsp;&amp;nbsp;API-Key: [from Azure Key Vault]&lt;br&gt;&lt;br&gt;Response:&lt;br&gt;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;buildingName&quot;: &quot;string&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;streetName&quot;: &quot;string&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;postalCode&quot;: &quot;string&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;unitNumber&quot;: &quot;string&quot;&lt;br&gt;}&lt;br&gt;&lt;br&gt;Timeout: 30 seconds | Retry: 3 attempts" style="text;html=1;whiteSpace=wrap;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;rounded=0;" vertex="1" parent="sw_ext_mha_3_5">
          <mxGeometry x="2700" y="40" width="360" height="220" as="geometry" />
        </mxCell>
        <mxCell id="sw_database_3_5" value="Database (Intranet)" style="swimlane;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="20" y="1380" width="7800" height="300" as="geometry" />
        </mxCell>
        <mxCell id="s3_5_store_owner" value="INSERT INTO ocms_vehicle_owner&lt;br&gt;(vehicle_no, owner_name, owner_nric, vehicle_make, vehicle_model, road_tax_expiry, ...)&lt;br&gt;&lt;br&gt;UPDATE ocms_valid_offence_notice&lt;br&gt;SET owner_nric = [ownerNRIC], owner_name = [ownerName]&lt;br&gt;WHERE vehicle_no = [vehicleNo]" style="text;html=1;whiteSpace=wrap;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;rounded=0;" vertex="1" parent="sw_database_3_5">
          <mxGeometry x="920" y="40" width="460" height="120" as="geometry" />
        </mxCell>
        <mxCell id="s3_5_check_suspension" value="SELECT suspension_type FROM ocms_suspended_notice&lt;br&gt;WHERE notice_id = [noticeId]&lt;br&gt;AND suspension_type IS NOT NULL" style="text;html=1;whiteSpace=wrap;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=middle;rounded=0;" vertex="1" parent="sw_database_3_5">
          <mxGeometry x="1180" y="180" width="360" height="80" as="geometry" />
        </mxCell>
        <mxCell id="s3_5_check_exclusion" value="SELECT nric FROM ocms_enotification_exclusion_list&lt;br&gt;WHERE nric = [ownerNRIC]" style="text;html=1;whiteSpace=wrap;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=middle;rounded=0;" vertex="1" parent="sw_database_3_5">
          <mxGeometry x="1600" y="40" width="360" height="60" as="geometry" />
        </mxCell>
        <mxCell id="c3_5_1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="s3_5_start" target="s3_5_step1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_5_2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="s3_5_step1" target="s3_5_dec1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_5_3" value="yes" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="s3_5_dec1" target="s3_5_step2_military">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_5_4" value="no" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="s3_5_dec1" target="s3_5_step3">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_5_5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;" edge="1" parent="1" source="s3_5_step3" target="s3_5_api_lta">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_5_6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="s3_5_step3" target="s3_5_dec2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_5_7" value="yes" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="s3_5_dec2" target="s3_5_step4">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_5_8" value="no" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="s3_5_dec2" target="s3_5_manual1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_5_9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="s3_5_step2_military" target="s3_5_step4">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="530" y="360" />
              <mxPoint x="1170" y="360" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="c3_5_10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;" edge="1" parent="1" source="s3_5_step4" target="s3_5_store_owner">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_5_11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="s3_5_step4" target="s3_5_step5">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_5_12" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;" edge="1" parent="1" source="s3_5_step5" target="s3_5_check_suspension">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_5_13" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="s3_5_step5" target="s3_5_dec3">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_5_14" value="yes" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="s3_5_dec3" target="s3_5_skip">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_5_15" value="no" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="s3_5_dec3" target="s3_5_step6">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_5_16" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;" edge="1" parent="1" source="s3_5_step6" target="s3_5_check_exclusion">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_5_17" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="s3_5_step6" target="s3_5_dec4">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_5_18" value="yes" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="s3_5_dec4" target="s3_5_step9_mha">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2070" y="50" />
              <mxPoint x="2070" y="30" />
              <mxPoint x="2920" y="30" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="c3_5_19" value="no" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="s3_5_dec4" target="s3_5_step7_datahive">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_5_20" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;" edge="1" parent="1" source="s3_5_step7_datahive" target="s3_5_api_datahive">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_5_21" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="s3_5_step7_datahive" target="s3_5_dec5">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_5_22" value="yes" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="s3_5_dec5" target="s3_5_step8_ean">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_5_23" value="no" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="s3_5_dec5" target="s3_5_step9_mha">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2490" y="200" />
              <mxPoint x="2920" y="200" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="c3_5_24" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="s3_5_step8_ean" target="s3_5_end">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_5_25" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;" edge="1" parent="1" source="s3_5_step9_mha" target="s3_5_api_mha">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_5_26" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="s3_5_step9_mha" target="s3_5_dec6">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_5_27" value="yes" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="s3_5_dec6" target="s3_5_step10_letter">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_5_28" value="no" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="s3_5_dec6" target="s3_5_manual2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_5_29" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="s3_5_step10_letter" target="s3_5_end">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_5_30" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="s3_5_manual1" target="s3_5_end">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="950" y="380" />
              <mxPoint x="3540" y="380" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="c3_5_31" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="s3_5_skip" target="s3_5_end">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1630" y="380" />
              <mxPoint x="3540" y="380" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="c3_5_32" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="s3_5_manual2" target="s3_5_end">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3130" y="380" />
              <mxPoint x="3540" y="380" />
            </Array>
          </mxGeometry>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="tab3_6" name="3.6_Send_eNotification">
    <mxGraphModel dx="2696" dy="1429" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="8000" pageHeight="2000" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="title_tab3_6" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;fontSize=16;fontStyle=1" value="Section 3.6: Send eNotification (eAN)" vertex="1">
          <mxGeometry height="30" width="600" x="40" y="20" as="geometry" />
        </mxCell>
        <mxCell id="sw_backend_3_6" parent="1" style="swimlane;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" value="Backend (OCMS API)" vertex="1">
          <mxGeometry height="440" width="7800" x="20" y="80" as="geometry" />
        </mxCell>
        <mxCell id="s3_6_start" parent="sw_backend_3_6" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.terminator;whiteSpace=wrap;" value="Start" vertex="1">
          <mxGeometry height="60" width="120" x="40" y="60" as="geometry" />
        </mxCell>
        <mxCell id="s3_6_step1" parent="sw_backend_3_6" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Retrieve Notice Details: Get notice number, offense details, composition amount" vertex="1">
          <mxGeometry height="80" width="160" x="220" y="50" as="geometry" />
        </mxCell>
        <mxCell id="s3_6_step2" parent="sw_backend_3_6" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Retrieve Owner Contact: Get mobile number and email address from previous step" vertex="1">
          <mxGeometry height="80" width="160" x="440" y="50" as="geometry" />
        </mxCell>
        <mxCell id="s3_6_step3" parent="sw_backend_3_6" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Generate eAN Content: Create message with notice details, offense info, appeal instructions" vertex="1">
          <mxGeometry height="80" width="160" x="660" y="50" as="geometry" />
        </mxCell>
        <mxCell id="s3_6_dec1" parent="sw_backend_3_6" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.decision;whiteSpace=wrap;" value="Mobile Available?" vertex="1">
          <mxGeometry height="100" width="140" x="880" y="40" as="geometry" />
        </mxCell>
        <mxCell id="s3_6_step4" parent="sw_backend_3_6" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Send SMS: Call SMS Gateway API to send eAN SMS" vertex="1">
          <mxGeometry height="80" width="160" x="1080" y="50" as="geometry" />
        </mxCell>
        <mxCell id="s3_6_step5" parent="sw_backend_3_6" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Log SMS Sent: Log SMS status, timestamp, recipient" vertex="1">
          <mxGeometry height="80" width="160" x="1300" y="50" as="geometry" />
        </mxCell>
        <mxCell id="s3_6_dec2" parent="sw_backend_3_6" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.decision;whiteSpace=wrap;" value="SMS Success?" vertex="1">
          <mxGeometry height="100" width="140" x="1520" y="40" as="geometry" />
        </mxCell>
        <mxCell id="s3_6_step6_retry_sms" parent="sw_backend_3_6" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Retry SMS: Retry failed SMS (max 3 times)" vertex="1">
          <mxGeometry height="60" width="160" x="1510" y="220" as="geometry" />
        </mxCell>
        <mxCell id="s3_6_dec3" parent="sw_backend_3_6" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.decision;whiteSpace=wrap;" value="Email Available?" vertex="1">
          <mxGeometry height="100" width="140" x="1740" y="40" as="geometry" />
        </mxCell>
        <mxCell id="s3_6_step7" parent="sw_backend_3_6" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Send Email: Call Email Service API to send eAN email" vertex="1">
          <mxGeometry height="80" width="160" x="1940" y="50" as="geometry" />
        </mxCell>
        <mxCell id="s3_6_step8" parent="sw_backend_3_6" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Log Email Sent: Log email status, timestamp, recipient" vertex="1">
          <mxGeometry height="80" width="160" x="2160" y="50" as="geometry" />
        </mxCell>
        <mxCell id="s3_6_dec4" parent="sw_backend_3_6" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.decision;whiteSpace=wrap;" value="Email Success?" vertex="1">
          <mxGeometry height="100" width="140" x="2380" y="40" as="geometry" />
        </mxCell>
        <mxCell id="s3_6_step9_retry_email" parent="sw_backend_3_6" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Retry Email: Retry failed email (max 3 times)" vertex="1">
          <mxGeometry height="60" width="160" x="2370" y="220" as="geometry" />
        </mxCell>
        <mxCell id="s3_6_step10" parent="sw_backend_3_6" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Update eAN Status: Set eAN_sent_flag=&#39;Y&#39;, sent timestamp, notification method" vertex="1">
          <mxGeometry height="80" width="180" x="2600" y="50" as="geometry" />
        </mxCell>
        <mxCell id="s3_6_step11" parent="sw_backend_3_6" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Log Notification Complete: Log eAN notification completion" vertex="1">
          <mxGeometry height="80" width="160" x="2840" y="50" as="geometry" />
        </mxCell>
        <mxCell id="s3_6_fallback" parent="sw_backend_3_6" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Fallback to Letter: If all retries fail, proceed to AN letter sending (Tab 3.7)" vertex="1">
          <mxGeometry height="80" width="180" x="2830" y="220" as="geometry" />
        </mxCell>
        <mxCell id="s3_6_end" parent="sw_backend_3_6" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.terminator;whiteSpace=wrap;" value="End" vertex="1">
          <mxGeometry height="60" width="120" x="3080" y="60" as="geometry" />
        </mxCell>
        <mxCell id="s3_6_sms_template" parent="sw_backend_3_6" style="text;html=1;whiteSpace=wrap;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;rounded=0;" value="SMS Template:&lt;br&gt;&lt;br&gt;Advisory Notice [NoticeNo]&lt;br&gt;Offense: [OffenseDescription]&lt;br&gt;Location: [PPName]&lt;br&gt;Date: [NoticeDate]&lt;br&gt;Amount: $[CompositionAmount]&lt;br&gt;Payment not accepted. You may appeal via OCMS portal." vertex="1">
          <mxGeometry height="160" width="380" x="580" y="200" as="geometry" />
        </mxCell>
        <mxCell id="s3_6_email_template" parent="sw_backend_3_6" style="text;html=1;whiteSpace=wrap;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;rounded=0;" value="Email Template:&lt;br&gt;&lt;br&gt;Subject: Advisory Notice [NoticeNo] - [VehicleNo]&lt;br&gt;&lt;br&gt;Dear Vehicle Owner,&lt;br&gt;&lt;br&gt;This is an Advisory Notice for the following offense:&lt;br&gt;&lt;br&gt;Notice Number: [NoticeNo]&lt;br&gt;Vehicle Number: [VehicleNo]&lt;br&gt;Offense: [OffenseDescription]&lt;br&gt;Location: [PPName]&lt;br&gt;Date: [NoticeDate]&lt;br&gt;Composition Amount: $[CompositionAmount]&lt;br&gt;&lt;br&gt;This is an advisory notice only. Payment is not accepted at this time.&lt;br&gt;&lt;br&gt;You may appeal this notice via the OCMS portal at [PortalURL].&lt;br&gt;&lt;br&gt;Regards,&lt;br&gt;Urban Redevelopment Authority" vertex="1">
          <mxGeometry height="360" width="480" x="3240" y="60" as="geometry" />
        </mxCell>
        <mxCell id="sw_ext_sms_3_6" parent="1" style="swimlane;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" value="External System (SMS Gateway)" vertex="1">
          <mxGeometry height="340" width="7800" x="20" y="540" as="geometry" />
        </mxCell>
        <mxCell id="s3_6_api_sms" parent="sw_ext_sms_3_6" style="text;html=1;whiteSpace=wrap;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;rounded=0;" value="SMS Gateway API:&lt;br&gt;&lt;br&gt;POST SMS_GATEWAY_API/send&lt;br&gt;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;mobileNumber&quot;: &quot;[owner_mobile]&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;message&quot;: &quot;[eAN SMS content]&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;sender&quot;: &quot;URA_OCMS&quot;&lt;br&gt;}&lt;br&gt;&lt;br&gt;Response:&lt;br&gt;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;status&quot;: &quot;success/failed&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;messageId&quot;: &quot;string&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;timestamp&quot;: &quot;datetime&quot;&lt;br&gt;}&lt;br&gt;&lt;br&gt;Timeout: 10 seconds&lt;br&gt;Retry: 3 attempts" vertex="1">
          <mxGeometry height="280" width="340" x="990" y="50" as="geometry" />
        </mxCell>
        <mxCell id="sw_ext_email_3_6" parent="1" style="swimlane;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" value="External System (Email Service)" vertex="1">
          <mxGeometry height="340" width="7800" x="20" y="900" as="geometry" />
        </mxCell>
        <mxCell id="s3_6_api_email" parent="sw_ext_email_3_6" style="text;html=1;whiteSpace=wrap;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;rounded=0;" value="Email Service API:&lt;br&gt;&lt;br&gt;POST EMAIL_SERVICE_API/send&lt;br&gt;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;emailAddress&quot;: &quot;[owner_email]&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;subject&quot;: &quot;[eAN email subject]&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;body&quot;: &quot;[eAN email content]&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;sender&quot;: &quot;noreply@ura.gov.sg&quot;&lt;br&gt;}&lt;br&gt;&lt;br&gt;Response:&lt;br&gt;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;status&quot;: &quot;success/failed&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;messageId&quot;: &quot;string&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;timestamp&quot;: &quot;datetime&quot;&lt;br&gt;}&lt;br&gt;&lt;br&gt;Timeout: 10 seconds&lt;br&gt;Retry: 3 attempts" vertex="1">
          <mxGeometry height="280" width="340" x="1880" y="40" as="geometry" />
        </mxCell>
        <mxCell id="sw_database_3_6" parent="1" style="swimlane;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" value="Database (Intranet)" vertex="1">
          <mxGeometry height="380" width="7800" x="20" y="1260" as="geometry" />
        </mxCell>
        <mxCell id="s3_6_retrieve_notice" parent="sw_database_3_6" style="text;html=1;whiteSpace=wrap;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;rounded=0;" value="SELECT notice_no, vehicle_no, offense_description, parking_place_name, notice_date, composition_amount&lt;br&gt;FROM ocms_valid_offence_notice&lt;br&gt;WHERE notice_id = [noticeId]" vertex="1">
          <mxGeometry height="80" width="480" x="140" y="40" as="geometry" />
        </mxCell>
        <mxCell id="s3_6_log_sms" parent="sw_database_3_6" style="text;html=1;whiteSpace=wrap;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;rounded=0;" value="INSERT INTO ocms_ean_notification_log&lt;br&gt;(notice_no, recipient_mobile, message_content, sent_timestamp, status, retry_count, notification_type)&lt;br&gt;VALUES ([noticeNo], [mobile], [smsContent], GETDATE(), [status], [retryCount], &#39;SMS&#39;)" vertex="1">
          <mxGeometry height="100" width="600" x="1080" y="80" as="geometry" />
        </mxCell>
        <mxCell id="s3_6_log_email" parent="sw_database_3_6" style="text;html=1;whiteSpace=wrap;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;rounded=0;" value="INSERT INTO ocms_ean_notification_log&lt;br&gt;(notice_no, recipient_email, message_content, sent_timestamp, status, retry_count, notification_type)&lt;br&gt;VALUES ([noticeNo], [email], [emailContent], GETDATE(), [status], [retryCount], &#39;EMAIL&#39;)" vertex="1">
          <mxGeometry height="100" width="600" x="1940" y="140" as="geometry" />
        </mxCell>
        <mxCell id="s3_6_update_status" parent="sw_database_3_6" style="text;html=1;whiteSpace=wrap;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;rounded=0;" value="UPDATE ocms_valid_offence_notice&lt;br&gt;SET eAN_sent_flag = &#39;Y&#39;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;eAN_sent_timestamp = GETDATE(),&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;notification_method = [method]&lt;br&gt;WHERE notice_id = [noticeId]&lt;br&gt;&lt;br&gt;[method] = &#39;SMS&#39; or &#39;EMAIL&#39; or &#39;BOTH&#39;" vertex="1">
          <mxGeometry height="140" width="380" x="2560" y="40" as="geometry" />
        </mxCell>
        <mxCell id="s3_6_log_complete" parent="sw_database_3_6" style="text;html=1;whiteSpace=wrap;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;rounded=0;" value="INSERT INTO ocms_notification_completion_log&lt;br&gt;(notice_no, completion_timestamp, notification_methods_used)&lt;br&gt;VALUES ([noticeNo], GETDATE(), [methodsUsed])" vertex="1">
          <mxGeometry height="80" width="480" x="2800" y="260" as="geometry" />
        </mxCell>
        <mxCell id="c3_6_1" edge="1" parent="1" source="s3_6_start" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_6_step1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_6_2" edge="1" parent="1" source="s3_6_step1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;" target="s3_6_retrieve_notice">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_6_3" edge="1" parent="1" source="s3_6_step1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_6_step2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_6_4" edge="1" parent="1" source="s3_6_step2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_6_step3">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_6_5" edge="1" parent="1" source="s3_6_step3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_6_dec1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_6_6" edge="1" parent="1" source="s3_6_dec1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_6_step4" value="yes">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_6_7" edge="1" parent="1" source="s3_6_dec1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_6_dec3" value="no">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="970" y="200" />
              <mxPoint x="1830" y="200" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="c3_6_8" edge="1" parent="1" source="s3_6_step4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;" target="s3_6_api_sms">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_6_9" edge="1" parent="1" source="s3_6_step4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_6_step5">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_6_10" edge="1" parent="1" source="s3_6_step5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;" target="s3_6_log_sms">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_6_11" edge="1" parent="1" source="s3_6_step5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_6_dec2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_6_12" edge="1" parent="1" source="s3_6_dec2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_6_dec3" value="yes">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_6_13" edge="1" parent="1" source="s3_6_dec2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_6_step6_retry_sms" value="no">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_6_14" edge="1" parent="1" source="s3_6_step6_retry_sms" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_6_step4">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1610" y="360" />
              <mxPoint x="1180" y="360" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="c3_6_15" edge="1" parent="1" source="s3_6_dec3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_6_step7" value="yes">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_6_16" edge="1" parent="1" source="s3_6_dec3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_6_step10" value="no">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1830" y="30" />
              <mxPoint x="2710" y="30" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="c3_6_17" edge="1" parent="1" source="s3_6_step7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;" target="s3_6_api_email">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_6_18" edge="1" parent="1" source="s3_6_step7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_6_step8">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_6_19" edge="1" parent="1" source="s3_6_step8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;" target="s3_6_log_email">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_6_20" edge="1" parent="1" source="s3_6_step8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_6_dec4">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_6_21" edge="1" parent="1" source="s3_6_dec4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_6_step10" value="yes">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_6_22" edge="1" parent="1" source="s3_6_dec4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_6_step9_retry_email" value="no">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_6_23" edge="1" parent="1" source="s3_6_step9_retry_email" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_6_step7">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2470" y="380" />
              <mxPoint x="2040" y="380" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="c3_6_24" edge="1" parent="1" source="s3_6_step10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;" target="s3_6_update_status">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_6_25" edge="1" parent="1" source="s3_6_step10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_6_step11">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_6_26" edge="1" parent="1" source="s3_6_step11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;" target="s3_6_log_complete">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_6_27" edge="1" parent="1" source="s3_6_step11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_6_end">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_6_28" edge="1" parent="1" source="s3_6_fallback" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_6_end">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_6_29" edge="1" parent="1" source="s3_6_step6_retry_sms" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;" target="s3_6_fallback" value="max 3 retries">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1610" y="420" />
              <mxPoint x="2940" y="420" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="c3_6_30" edge="1" parent="1" source="s3_6_step9_retry_email" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;" target="s3_6_fallback" value="max 3 retries">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2470" y="440" />
              <mxPoint x="2940" y="440" />
            </Array>
          </mxGeometry>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="tab3_7" name="3.7_Send_AN_Letter">
    <mxGraphModel dx="6065" dy="3215" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="8000" pageHeight="2000" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="title_tab3_7" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;fontSize=16;fontStyle=1" value="Section 3.7: Send AN Letter (SLIFT)" vertex="1">
          <mxGeometry height="30" width="600" x="40" y="20" as="geometry" />
        </mxCell>
        <mxCell id="sw_backend_3_7" parent="1" style="swimlane;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" value="Backend (OCMS API)" vertex="1">
          <mxGeometry height="600" width="4020" x="20" y="80" as="geometry" />
        </mxCell>
        <mxCell id="s3_7_start" parent="sw_backend_3_7" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.terminator;whiteSpace=wrap;" value="Start" vertex="1">
          <mxGeometry height="60" width="120" x="40" y="60" as="geometry" />
        </mxCell>
        <mxCell id="s3_7_step1" parent="sw_backend_3_7" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Retrieve Notice Details: Get notice number, offense, composition amount" vertex="1">
          <mxGeometry height="80" width="160" x="220" y="50" as="geometry" />
        </mxCell>
        <mxCell id="s3_7_step2" parent="sw_backend_3_7" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Retrieve Owner Address: From MHA API response (building name, street, postal code, unit)" vertex="1">
          <mxGeometry height="80" width="180" x="440" y="50" as="geometry" />
        </mxCell>
        <mxCell id="s3_7_step3" parent="sw_backend_3_7" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Retrieve Owner Name: From LTA API response" vertex="1">
          <mxGeometry height="80" width="160" x="680" y="50" as="geometry" />
        </mxCell>
        <mxCell id="s3_7_step4" parent="sw_backend_3_7" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Generate Letter Template: Create PDF/XML with notice details, owner address, letter content" vertex="1">
          <mxGeometry height="80" width="180" x="900" y="50" as="geometry" />
        </mxCell>
        <mxCell id="s3_7_step5" parent="sw_backend_3_7" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Populate Letter Fields: Fill template with notice number, vehicle number, offense details, owner name/address" vertex="1">
          <mxGeometry height="80" width="200" x="1140" y="50" as="geometry" />
        </mxCell>
        <mxCell id="s3_7_step6" parent="sw_backend_3_7" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Format Letter Content: Format per SLIFT requirements (PDF preferred)" vertex="1">
          <mxGeometry height="80" width="160" x="1400" y="50" as="geometry" />
        </mxCell>
        <mxCell id="s3_7_dec1" parent="sw_backend_3_7" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.decision;whiteSpace=wrap;" value="Valid Letter? (PDF/XML generated successfully)" vertex="1">
          <mxGeometry height="100" width="140" x="1620" y="40" as="geometry" />
        </mxCell>
        <mxCell id="s3_7_step7" parent="sw_backend_3_7" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Call SLIFT API: Apply OP-AN-SLIFT-001 (Submit letter to SLIFT for printing and mailing)" vertex="1">
          <mxGeometry height="80" width="180" x="1820" y="50" as="geometry" />
        </mxCell>
        <mxCell id="s3_7_dec2" parent="sw_backend_3_7" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.decision;whiteSpace=wrap;" value="SLIFT Success? (status=success, submissionId returned)" vertex="1">
          <mxGeometry height="100" width="140" x="2060" y="40" as="geometry" />
        </mxCell>
        <mxCell id="s3_7_step8" parent="sw_backend_3_7" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Update Letter Status: Set letter_sent_flag=&#39;Y&#39;, letter_sent_timestamp, slift_submission_id" vertex="1">
          <mxGeometry height="80" width="180" x="2260" y="50" as="geometry" />
        </mxCell>
        <mxCell id="s3_7_step9" parent="sw_backend_3_7" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Log Letter Sent: Log notice_no, timestamp, recipient, submission_id" vertex="1">
          <mxGeometry height="80" width="160" x="2500" y="50" as="geometry" />
        </mxCell>
        <mxCell id="s3_7_step10_retry" parent="sw_backend_3_7" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Retry Submission: Retry with exponential backoff (1s, 2s, 4s)" vertex="1">
          <mxGeometry height="80" width="180" x="2040" y="240" as="geometry" />
        </mxCell>
        <mxCell id="s3_7_manual" parent="sw_backend_3_7" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Manual Review Queue: Add to manual review queue after 3 failed retries" vertex="1">
          <mxGeometry height="80" width="180" x="1610" y="360" as="geometry" />
        </mxCell>
        <mxCell id="s3_7_error_log" parent="sw_backend_3_7" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Log Error: Log error with reason, move to manual review" vertex="1">
          <mxGeometry height="80" width="160" x="1610" y="240" as="geometry" />
        </mxCell>
        <mxCell id="s3_7_letter_template" parent="sw_backend_3_7" style="text;html=1;whiteSpace=wrap;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;rounded=0;" value="AN Letter Content Template:&lt;br&gt;&lt;br&gt;Urban Redevelopment Authority&lt;br&gt;Car Parks Department&lt;br&gt;&lt;br&gt;[Owner Name]&lt;br&gt;[Building Name]&lt;br&gt;[Street Name]&lt;br&gt;[Unit Number]&lt;br&gt;[Postal Code]&lt;br&gt;&lt;br&gt;Date: [Current Date]&lt;br&gt;&lt;br&gt;Advisory Notice Number: [NoticeNo]&lt;br&gt;&lt;br&gt;Dear Sir/Madam,&lt;br&gt;&lt;br&gt;RE: ADVISORY NOTICE - VEHICLE [VehicleNo]&lt;br&gt;&lt;br&gt;This is an Advisory Notice for the following parking offense:&lt;br&gt;&lt;br&gt;Offense Details:&lt;br&gt;- Notice Number: [NoticeNo]&lt;br&gt;- Vehicle Number: [VehicleNo]&lt;br&gt;- Offense: [OffenseDescription]&lt;br&gt;- Location: [PPName]&lt;br&gt;- Date and Time: [NoticeDateAndTime]&lt;br&gt;- Composition Amount: $[CompositionAmount]&lt;br&gt;&lt;br&gt;This is an advisory notice only. Payment is not accepted for this notice.&lt;br&gt;&lt;br&gt;You have the right to appeal this notice. Please visit the OCMS portal&lt;br&gt;at [PortalURL] to submit your appeal.&lt;br&gt;&lt;br&gt;If you have any questions, please contact us at [ContactNumber].&lt;br&gt;&lt;br&gt;Yours faithfully,&lt;br&gt;Urban Redevelopment Authority" vertex="1">
          <mxGeometry height="560" width="480" x="3450" y="30" as="geometry" />
        </mxCell>
        <mxCell id="s3_7_end" parent="sw_backend_3_7" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.terminator;whiteSpace=wrap;" value="End" vertex="1">
          <mxGeometry height="60" width="120" x="3280" y="60" as="geometry" />
        </mxCell>
        <mxCell id="s3_7_query_notice" parent="sw_backend_3_7" style="text;html=1;whiteSpace=wrap;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;rounded=0;" value="SELECT notice_no, vehicle_no, computer_rule_code, composition_amount, pp_name, notice_date_and_time&lt;br&gt;FROM ocms_valid_offence_notice von&lt;br&gt;JOIN ocms_offence_notice_detail ond ON von.notice_id = ond.notice_id&lt;br&gt;WHERE von.an_flag = &#39;Y&#39; AND von.letter_sent_flag = &#39;N&#39;" vertex="1">
          <mxGeometry height="80" width="580" x="10" y="290" as="geometry" />
        </mxCell>
        <mxCell id="c3_7_2" edge="1" parent="sw_backend_3_7" source="s3_7_step1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;" target="s3_7_query_notice">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s3_7_update_status" parent="sw_backend_3_7" style="text;html=1;whiteSpace=wrap;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;rounded=0;" value="UPDATE ocms_valid_offence_notice&lt;br&gt;SET letter_sent_flag = &#39;Y&#39;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;letter_sent_timestamp = CURRENT_TIMESTAMP,&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;slift_submission_id = [submissionId],&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;updated_dt = CURRENT_TIMESTAMP,&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;updated_by = &#39;ocmsiz_app_conn&#39;&lt;br&gt;WHERE notice_id = [noticeId]" vertex="1">
          <mxGeometry height="140" width="290" x="2230" y="190" as="geometry" />
        </mxCell>
        <mxCell id="c3_7_15" edge="1" parent="sw_backend_3_7" source="s3_7_step8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;" target="s3_7_update_status">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s3_7_insert_log" parent="sw_backend_3_7" style="text;html=1;whiteSpace=wrap;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;rounded=0;" value="INSERT INTO ocms_an_letter_log&lt;br&gt;(notice_no, recipient_name, recipient_address, letter_file_path, &lt;br&gt;&amp;nbsp;slift_submission_id, sent_timestamp, status, retry_count,&lt;br&gt;&amp;nbsp;created_dt, created_by)&lt;br&gt;VALUES&lt;br&gt;([notice_no], [owner_name], [full_address], [file_path],&lt;br&gt;&amp;nbsp;[submission_id], CURRENT_TIMESTAMP, &#39;SUCCESS&#39;, [retry_count],&lt;br&gt;&amp;nbsp;CURRENT_TIMESTAMP, &#39;ocmsiz_app_conn&#39;)" vertex="1">
          <mxGeometry height="140" width="400" x="2610" y="200" as="geometry" />
        </mxCell>
        <mxCell id="c3_7_17" edge="1" parent="sw_backend_3_7" source="s3_7_step9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;" target="s3_7_insert_log">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="sw_ext_slift_3_7" parent="1" style="swimlane;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" value="External System (SLIFT)" vertex="1">
          <mxGeometry height="460" width="4030" x="40" y="720" as="geometry" />
        </mxCell>
        <mxCell id="s3_7_api_slift" parent="sw_ext_slift_3_7" style="text;html=1;whiteSpace=wrap;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;rounded=0;" value="SLIFT API (OP-AN-SLIFT-001):&lt;br&gt;&lt;br&gt;POST SLIFT_API/submit&lt;br&gt;Headers:&lt;br&gt;&amp;nbsp;&amp;nbsp;API-Key: [from Azure Key Vault]&lt;br&gt;&lt;br&gt;Body (multipart/form-data):&lt;br&gt;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;noticeNumber&quot;: &quot;[notice_no]&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;vehicleNumber&quot;: &quot;[vehicle_no]&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;letterFile&quot;: &quot;[PDF/XML file]&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;letterType&quot;: &quot;ADVISORY_NOTICE&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;recipientName&quot;: &quot;[owner_name]&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;recipientAddress&quot;: &quot;[full_address]&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;priority&quot;: &quot;NORMAL&quot;&lt;br&gt;}&lt;br&gt;&lt;br&gt;Response:&lt;br&gt;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;status&quot;: &quot;success/failed&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;submissionId&quot;: &quot;string&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;timestamp&quot;: &quot;datetime&quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&quot;estimatedPrintDate&quot;: &quot;date&quot;&lt;br&gt;}&lt;br&gt;&lt;br&gt;Timeout: 30 seconds&lt;br&gt;Retry: 3 attempts with exponential backoff (1s, 2s, 4s)&lt;br&gt;File Format: PDF (preferred) or XML" vertex="1">
          <mxGeometry height="400" width="420" x="1680" y="40" as="geometry" />
        </mxCell>
        <mxCell id="c3_7_1" edge="1" parent="1" source="s3_7_start" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_7_step1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_7_3" edge="1" parent="1" source="s3_7_step1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_7_step2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_7_4" edge="1" parent="1" source="s3_7_step2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_7_step3">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_7_5" edge="1" parent="1" source="s3_7_step3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_7_step4">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_7_6" edge="1" parent="1" source="s3_7_step4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_7_step5">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_7_7" edge="1" parent="1" source="s3_7_step5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_7_step6">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_7_8" edge="1" parent="1" source="s3_7_step6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_7_dec1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_7_9" edge="1" parent="1" source="s3_7_dec1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_7_step7" value="yes">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_7_10" edge="1" parent="1" source="s3_7_dec1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_7_error_log" value="no">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_7_11" edge="1" parent="1" source="s3_7_step7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;" target="s3_7_api_slift">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_7_12" edge="1" parent="1" source="s3_7_step7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_7_dec2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_7_13" edge="1" parent="1" source="s3_7_dec2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_7_step8" value="yes">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_7_14" edge="1" parent="1" source="s3_7_dec2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_7_step10_retry" value="no">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_7_16" edge="1" parent="1" source="s3_7_step8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_7_step9">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_7_18" edge="1" parent="1" source="s3_7_step9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_7_end">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_7_19" edge="1" parent="1" source="s3_7_step10_retry" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;" target="s3_7_step7" value="max 3 retries">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2150" y="420" />
              <mxPoint x="1930" y="420" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="c3_7_20" edge="1" parent="1" source="s3_7_step10_retry" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_7_manual" value="retry count &gt;= 3">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2150" y="480" />
              <mxPoint x="1720" y="480" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="c3_7_21" edge="1" parent="1" source="s3_7_error_log" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_7_manual">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_7_22" edge="1" parent="1" source="s3_7_manual" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_7_end">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1720" y="600" />
              <mxPoint x="3360" y="600" />
            </Array>
          </mxGeometry>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="tab3_8" name="3.8_Suspend_PS_ANS">
    <mxGraphModel dx="1733" dy="919" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="5000" pageHeight="1500" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="title_3_8" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;fontSize=16;fontStyle=1" value="Section 3.8: Suspend Notice with PS-ANS" vertex="1">
          <mxGeometry height="30" width="600" x="40" y="20" as="geometry" />
        </mxCell>
        <mxCell id="sw_backend_3_8" parent="1" style="swimlane;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" value="Backend (OCMS API)" vertex="1">
          <mxGeometry height="720" width="2710" x="20" y="60" as="geometry" />
        </mxCell>
        <mxCell id="s3_8_start" parent="sw_backend_3_8" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.terminator;whiteSpace=wrap;" value="Start" vertex="1">
          <mxGeometry height="60" width="120" x="40" y="80" as="geometry" />
        </mxCell>
        <mxCell id="s3_8_step1" parent="sw_backend_3_8" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Retrieve Notice Details (notice number, notice date)" vertex="1">
          <mxGeometry height="100" width="160" x="220" y="60" as="geometry" />
        </mxCell>
        <mxCell id="s3_8_step2" parent="sw_backend_3_8" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Calculate Suspension Date: Set date_of_suspension = current date" vertex="1">
          <mxGeometry height="100" width="160" x="440" y="60" as="geometry" />
        </mxCell>
        <mxCell id="s3_8_step3" parent="sw_backend_3_8" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Calculate Revival Date: Set due_date_of_revival = current date + 30 days (configurable)" vertex="1">
          <mxGeometry height="100" width="180" x="660" y="60" as="geometry" />
        </mxCell>
        <mxCell id="s3_8_step4" parent="sw_backend_3_8" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Generate SR Number: Create sequential sr_no" vertex="1">
          <mxGeometry height="100" width="160" x="900" y="60" as="geometry" />
        </mxCell>
        <mxCell id="s3_8_step5" parent="sw_backend_3_8" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Create Suspension Record in ocms_suspended_notice" vertex="1">
          <mxGeometry height="100" width="160" x="1120" y="60" as="geometry" />
        </mxCell>
        <mxCell id="s3_8_step6" parent="sw_backend_3_8" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Update Notice with Suspension details in ocms_valid_offence_notice" vertex="1">
          <mxGeometry height="100" width="180" x="1340" y="60" as="geometry" />
        </mxCell>
        <mxCell id="s3_8_step7" parent="sw_backend_3_8" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Sync to Internet DB: Mirror record to eocms_valid_offence_notice" vertex="1">
          <mxGeometry height="100" width="180" x="1580" y="60" as="geometry" />
        </mxCell>
        <mxCell id="s3_8_step8" parent="sw_backend_3_8" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Log Suspension Created with timestamp" vertex="1">
          <mxGeometry height="100" width="160" x="1820" y="60" as="geometry" />
        </mxCell>
        <mxCell id="s3_8_end" parent="sw_backend_3_8" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.terminator;whiteSpace=wrap;" value="End" vertex="1">
          <mxGeometry height="60" width="120" x="2040" y="80" as="geometry" />
        </mxCell>
        <mxCell id="s3_8_insert_susp" parent="sw_backend_3_8" style="text;html=1;whiteSpace=wrap;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;rounded=0;" value="INSERT ocms_suspended_notice:&lt;br&gt;&lt;br&gt;- notice_no (PK)&lt;br&gt;- date_of_suspension: Current date (PK)&lt;br&gt;- sr_no: Sequential number (PK)&lt;br&gt;- suspension_type: &#39;PS&#39; (Permanent Suspension)&lt;br&gt;- reason_of_suspension: &#39;ANS&#39; (Advisory Notice Suspension)&lt;br&gt;- suspension_source: &#39;ocmsiz_app_conn&#39;&lt;br&gt;- officer_authorising_suspension: &#39;ocmsizmgr_conn&#39;&lt;br&gt;- due_date_of_revival: current date + 30 days&lt;br&gt;- suspension_remarks: &#39;Advisory Notice detected - qualified AN&#39;&lt;br&gt;- created_by: &#39;ocmsiz_app_conn&#39;&lt;br&gt;- created_date: Current timestamp" vertex="1">
          <mxGeometry height="220" width="440" x="750" y="470" as="geometry" />
        </mxCell>
        <mxCell id="c3_8_6" edge="1" parent="sw_backend_3_8" source="s3_8_step5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;" target="s3_8_insert_susp">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s3_8_params" parent="sw_backend_3_8" style="text;html=1;whiteSpace=wrap;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;rounded=0;" value="Suspension Parameters:&lt;br&gt;&lt;br&gt;Parameter | Value | Source&lt;br&gt;--------------------------------------------------------&lt;br&gt;Suspension Type | PS (Permanent Suspension) | Fixed&lt;br&gt;Reason of Suspension | ANS (Advisory Notice Suspension) | Fixed&lt;br&gt;Suspension Source | ocmsiz_app_conn | System parameter&lt;br&gt;Officer Authorising | ocmsizmgr_conn | System parameter&lt;br&gt;Revival Period | 30 days (configurable) | System configuration table" vertex="1">
          <mxGeometry height="180" width="560" x="2130" y="180" as="geometry" />
        </mxCell>
        <mxCell id="s3_8_sync_internet" parent="sw_backend_3_8" style="text;html=1;whiteSpace=wrap;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;rounded=0;" value="INSERT/UPDATE eocms_valid_offence_notice:&lt;br&gt;&lt;br&gt;Mirror same suspension fields from intranet table:&lt;br&gt;- suspension_type&lt;br&gt;- epr_reason_of_suspension&lt;br&gt;- epr_date_of_suspension&lt;br&gt;- due_date_of_revival" vertex="1">
          <mxGeometry height="160" width="400" x="1650" y="330" as="geometry" />
        </mxCell>
        <mxCell id="c3_8_10" edge="1" parent="sw_backend_3_8" source="s3_8_step7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;" target="s3_8_sync_internet">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s3_8_update_notice" parent="sw_backend_3_8" style="text;html=1;whiteSpace=wrap;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;rounded=0;" value="UPDATE ocms_valid_offence_notice:&lt;br&gt;&lt;br&gt;- suspension_type: &#39;PS&#39;&lt;br&gt;- epr_reason_of_suspension: &#39;ANS&#39;&lt;br&gt;- epr_date_of_suspension: Current date&lt;br&gt;- due_date_of_revival: current date + 30 days&lt;br&gt;- modified_by: &#39;ocmsiz_app_conn&#39;&lt;br&gt;- modified_date: Current timestamp" vertex="1">
          <mxGeometry height="160" width="360" x="1250" y="340" as="geometry" />
        </mxCell>
        <mxCell id="c3_8_8" edge="1" parent="sw_backend_3_8" source="s3_8_step6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;" target="s3_8_update_notice">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_8_1" edge="1" parent="1" source="s3_8_start" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_8_step1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_8_2" edge="1" parent="1" source="s3_8_step1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_8_step2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_8_3" edge="1" parent="1" source="s3_8_step2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_8_step3">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_8_4" edge="1" parent="1" source="s3_8_step3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_8_step4">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_8_5" edge="1" parent="1" source="s3_8_step4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_8_step5">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_8_7" edge="1" parent="1" source="s3_8_step5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_8_step6">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_8_9" edge="1" parent="1" source="s3_8_step6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_8_step7">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_8_11" edge="1" parent="1" source="s3_8_step7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_8_step8">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_8_12" edge="1" parent="1" source="s3_8_step8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_8_end">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="tab3_9" name="3.9_Generate_ANS_Reports">
    <mxGraphModel dx="2205" dy="1169" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="8000" pageHeight="2000" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="title_tab3_9" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;fontSize=16;fontStyle=1" value="Section 3.9: Generate ANS Reports" vertex="1">
          <mxGeometry height="30" width="600" x="40" y="20" as="geometry" />
        </mxCell>
        <mxCell id="sw_frontend_3_9" parent="1" style="swimlane;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" value="Frontend (Staff Portal)" vertex="1">
          <mxGeometry height="280" width="3420" x="20" y="80" as="geometry" />
        </mxCell>
        <mxCell id="s3_9_start" parent="sw_frontend_3_9" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.terminator;whiteSpace=wrap;" value="Start" vertex="1">
          <mxGeometry height="60" width="120" x="40" y="100" as="geometry" />
        </mxCell>
        <mxCell id="s3_9_receive_request" parent="sw_frontend_3_9" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Receive Report Parameters&#xa;(Date From, Date To, Vehicle Number, Subsystem)" vertex="1">
          <mxGeometry height="100" width="160" x="220" y="80" as="geometry" />
        </mxCell>
        <mxCell id="s3_9_download_report" parent="sw_frontend_3_9" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Download Report&#xa;(Excel/PDF)" vertex="1">
          <mxGeometry height="100" width="160" x="3060" y="100" as="geometry" />
        </mxCell>
        <mxCell id="s3_9_display_error" parent="sw_frontend_3_9" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Display Error Message&#xa;(Invalid Parameters)" vertex="1">
          <mxGeometry height="100" width="160" x="1070" y="70" as="geometry" />
        </mxCell>
        <mxCell id="s3_9_display_nodata" parent="sw_frontend_3_9" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Display No Data Message&#xa;&#39;No records found for the selected criteria&#39;" vertex="1">
          <mxGeometry height="100" width="180" x="2760" y="80" as="geometry" />
        </mxCell>
        <mxCell id="sw_backend_3_9" parent="1" style="swimlane;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" value="Backend (OCMS API)" vertex="1">
          <mxGeometry height="800" width="3420" x="20" y="385" as="geometry" />
        </mxCell>
        <mxCell id="s3_9_validate_params" parent="sw_backend_3_9" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Validate Parameters:&#xa;- Date range max 31 days&#xa;- Date From &lt;= Date To&#xa;- Required fields present" vertex="1">
          <mxGeometry height="100" width="180" x="440" y="80" as="geometry" />
        </mxCell>
        <mxCell id="s3_9_dec_valid" parent="sw_backend_3_9" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.decision;whiteSpace=wrap;" value="Valid Parameters?" vertex="1">
          <mxGeometry height="120" width="140" x="690" y="70" as="geometry" />
        </mxCell>
        <mxCell id="s3_9_return_error" parent="sw_backend_3_9" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;fillColor=#fff2cc;strokeColor=#d6b656;" value="Return Error Response:&#xa;&#39;Invalid parameters - Date range exceeds 31 days&#39;" vertex="1">
          <mxGeometry height="100" width="180" x="1060" y="80" as="geometry" />
        </mxCell>
        <mxCell id="s3_9_apply_filters" parent="sw_backend_3_9" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Apply Filters:&#xa;- Vehicle number&#xa;- Subsystem&#xa;- Date range" vertex="1">
          <mxGeometry height="100" width="160" x="1460" y="80" as="geometry" />
        </mxCell>
        <mxCell id="s3_9_dec_records" parent="sw_backend_3_9" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.decision;whiteSpace=wrap;" value="Any Records?" vertex="1">
          <mxGeometry height="120" width="140" x="1690" y="70" as="geometry" />
        </mxCell>
        <mxCell id="s3_9_return_nodata" parent="sw_backend_3_9" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Return No Data Message:&#xa;&#39;No records found for the selected criteria&#39;" vertex="1">
          <mxGeometry height="100" width="180" x="2080" y="370" as="geometry" />
        </mxCell>
        <mxCell id="s3_9_sort_results" parent="sw_backend_3_9" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Sort Results&#xa;by Suspension Date Descending" vertex="1">
          <mxGeometry height="100" width="160" x="1900" y="80" as="geometry" />
        </mxCell>
        <mxCell id="s3_9_format_data" parent="sw_backend_3_9" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Format Report Data&#xa;(Excel/PDF columns)" vertex="1">
          <mxGeometry height="100" width="160" x="2120" y="80" as="geometry" />
        </mxCell>
        <mxCell id="s3_9_generate_file" parent="sw_backend_3_9" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Generate Report File&#xa;(Excel/PDF format)" vertex="1">
          <mxGeometry height="100" width="160" x="2340" y="80" as="geometry" />
        </mxCell>
        <mxCell id="s3_9_log_report" parent="sw_backend_3_9" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Log Report Generated&#xa;(Parameters, Timestamp, User)" vertex="1">
          <mxGeometry height="100" width="180" x="2560" y="80" as="geometry" />
        </mxCell>
        <mxCell id="s3_9_return_report" parent="sw_backend_3_9" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;" value="Return Report File&#xa;for Download" vertex="1">
          <mxGeometry height="100" width="160" x="3060" y="80" as="geometry" />
        </mxCell>
        <mxCell id="s3_9_param_box" parent="sw_backend_3_9" style="text;html=1;whiteSpace=wrap;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;rounded=0;" value="Report Parameters:&#xa;&#xa;Parameter | Type | Required | Validation&#xa;----------------------------------------&#xa;Date From | Date | Yes | Must be &lt;= Date To&#xa;Date To | Date | Yes | Date range max 31 days&#xa;Vehicle Number | String | No | Alphanumeric&#xa;Subsystem | String | No | Valid subsystem code" vertex="1">
          <mxGeometry height="160" width="420" x="200" y="440" as="geometry" />
        </mxCell>
        <mxCell id="s3_9_output_box" parent="sw_backend_3_9" style="text;html=1;whiteSpace=wrap;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;rounded=0;" value="Report Output Format:&#xa;&#xa;Excel Columns:&#xa;1. Notice Number&#xa;2. Vehicle Number&#xa;3. Subsystem&#xa;4. Suspension Date&#xa;5. Revival Date&#xa;6. Offense Code&#xa;7. Composition Amount&#xa;8. Notice Date&#xa;9. Parking Place&#xa;10. Suspension Remarks&#xa;&#xa;PDF Structure:&#xa;Advisory Notice Suspension Report&#xa;Generated: [Current Date Time]&#xa;Date Range: [Date From] to [Date To]&#xa;&#xa;+------------+------------+----------+----------------+-------------+&#xa;| Notice No  | Vehicle No | Subsystem| Suspension Date| Revival Date|&#xa;+------------+------------+----------+----------------+-------------+&#xa;...&#xa;Total Records: [Count]" vertex="1">
          <mxGeometry height="400" width="480" x="2900" y="235" as="geometry" />
        </mxCell>
        <mxCell id="s3_9_query_notices" parent="sw_backend_3_9" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;fillColor=#fff2cc;strokeColor=#d6b656;" value="Query Suspended Notices:&#xa;&#xa;SELECT notice_no FROM ocms_suspended_notice&#xa;WHERE reason_of_suspension = &#39;ANS&#39;" vertex="1">
          <mxGeometry height="100" width="280" x="620" y="260" as="geometry" />
        </mxCell>
        <mxCell id="c3_9_6" edge="1" parent="sw_backend_3_9" source="s3_9_dec_valid" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_9_query_notices" value="yes">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s3_9_join_details" parent="sw_backend_3_9" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;fillColor=#fff2cc;strokeColor=#d6b656;" value="Join Notice Details:&#xa;&#xa;INNER JOIN ocms_valid_offence_notice&#xa;ON notice_no" vertex="1">
          <mxGeometry height="100" width="240" x="1420" y="260" as="geometry" />
        </mxCell>
        <mxCell id="c3_9_7" edge="1" parent="sw_backend_3_9" source="s3_9_query_notices" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;" target="s3_9_join_details">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_9_9" edge="1" parent="sw_backend_3_9" source="s3_9_join_details" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_9_apply_filters">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s3_9_query_box" parent="sw_backend_3_9" style="text;html=1;whiteSpace=wrap;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;rounded=0;" value="Database Query Logic:&#xa;&#xa;SELECT&#xa;  sn.notice_no,&#xa;  sn.date_of_suspension,&#xa;  sn.due_date_of_revival,&#xa;  sn.suspension_remarks,&#xa;  von.vehicle_no,&#xa;  von.subsystem_label,&#xa;  von.computer_rule_code,&#xa;  von.composition_amount,&#xa;  von.notice_date_and_time,&#xa;  von.pp_code,&#xa;  von.pp_name,&#xa;  von.offense_notice_type&#xa;FROM ocms_suspended_notice sn&#xa;INNER JOIN ocms_valid_offence_notice von&#xa;  ON sn.notice_no = von.notice_no&#xa;WHERE sn.reason_of_suspension = &#39;ANS&#39;&#xa;  AND sn.date_of_suspension BETWEEN [dateFrom] AND [dateTo]&#xa;  AND ([vehicleNo] IS NULL OR von.vehicle_no = [vehicleNo])&#xa;  AND ([subsystem] IS NULL OR von.subsystem_label = [subsystem])&#xa;ORDER BY sn.date_of_suspension DESC" vertex="1">
          <mxGeometry height="360" width="600" x="1240" y="426" as="geometry" />
        </mxCell>
        <mxCell id="c3_9_8" edge="1" parent="sw_backend_3_9" source="s3_9_join_details" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;" target="s3_9_query_box">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_9_1" edge="1" parent="1" source="s3_9_start" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_9_receive_request">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_9_2" edge="1" parent="1" source="s3_9_receive_request" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_9_validate_params">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_9_3" edge="1" parent="1" source="s3_9_validate_params" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;" target="s3_9_param_box">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_9_4" edge="1" parent="1" source="s3_9_validate_params" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_9_dec_valid">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_9_5" edge="1" parent="1" source="s3_9_dec_valid" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_9_return_error" value="no">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_9_10" edge="1" parent="1" source="s3_9_apply_filters" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_9_dec_records">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_9_11" edge="1" parent="1" source="s3_9_dec_records" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" target="s3_9_return_nodata" value="no">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1780" y="800" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="c3_9_12" edge="1" parent="1" source="s3_9_dec_records" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_9_sort_results" value="yes">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_9_13" edge="1" parent="1" source="s3_9_sort_results" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_9_format_data">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_9_14" edge="1" parent="1" source="s3_9_format_data" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_9_generate_file">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_9_15" edge="1" parent="1" source="s3_9_generate_file" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_9_log_report">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_9_16" edge="1" parent="1" source="s3_9_log_report" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_9_return_report">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_9_17" edge="1" parent="1" source="s3_9_return_report" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;" target="s3_9_output_box">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_9_18" edge="1" parent="1" source="s3_9_return_report" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_9_download_report">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_9_19" edge="1" parent="1" source="s3_9_return_error" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_9_display_error">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3_9_20" edge="1" parent="1" source="s3_9_return_nodata" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="s3_9_display_nodata">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="tab3_10" name="3.10_Send_Unqualified_List">
    <mxGraphModel dx="4043" dy="2143" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="6000" pageHeight="1800" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="title_tab3_10" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;fontSize=16;fontStyle=1" value="Section 3.10: Send Unqualified AN List (REPCCS/CES)" vertex="1">
          <mxGeometry height="30" width="600" x="40" y="20" as="geometry" />
        </mxCell>
        <mxCell id="lane_backend_310" parent="1" style="swimlane;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" value="Backend (Cron)" vertex="1">
          <mxGeometry height="280" width="5800" x="20" y="80" as="geometry" />
        </mxCell>
        <mxCell id="lane_database_310" parent="1" style="swimlane;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" value="Database" vertex="1">
          <mxGeometry height="280" width="5800" x="20" y="360" as="geometry" />
        </mxCell>
        <mxCell id="lane_sftp_310" parent="1" style="swimlane;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" value="External System (SFTP)" vertex="1">
          <mxGeometry height="280" width="5800" x="20" y="640" as="geometry" />
        </mxCell>
        <mxCell id="start_310" parent="1" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.start_1;whiteSpace=wrap;fillColor=#f5f5f5;strokeColor=#666666;fontSize=13;fontColor=#333333;" value="Start" vertex="1">
          <mxGeometry height="60" width="120" x="200" y="160" as="geometry" />
        </mxCell>
        <mxCell id="calc_date_310" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=13;" value="Calculate Date Range&lt;br&gt;(Previous Day)" vertex="1">
          <mxGeometry height="60" width="160" x="380" y="160" as="geometry" />
        </mxCell>
        <mxCell id="edge_start_calc_310" edge="1" parent="1" source="start_310" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="calc_date_310" value="">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="query_unqualified_310" parent="1" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=13;" value="Query Unqualified ANs&lt;br&gt;(an_flag=&#39;N&#39; or NULL)" vertex="1">
          <mxGeometry height="80" width="160" x="600" y="420" as="geometry" />
        </mxCell>
        <mxCell id="edge_calc_query_310" edge="1" parent="1" source="calc_date_310" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="query_unqualified_310" value="">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="info_query_310" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;align=left;verticalAlign=top;fontSize=12;" value="&lt;b&gt;Query for Unqualified ANs:&lt;/b&gt;&lt;br&gt;SELECT notice_no, vehicle_no, subsystem_label,&lt;br&gt;computer_rule_code, composition_amount,&lt;br&gt;notice_date_and_time, offense_notice_type,&lt;br&gt;an_flag, created_date&lt;br&gt;FROM ocms_valid_offence_notice&lt;br&gt;WHERE created_date BETWEEN [dateFrom] AND [dateTo]&lt;br&gt;AND (an_flag = &#39;N&#39; OR an_flag IS NULL)&lt;br&gt;AND subsystem_label IN ([REPCCS], [CES])&lt;br&gt;AND unqualified_list_sent_flag = &#39;N&#39;&lt;br&gt;ORDER BY subsystem_label, created_date ASC" vertex="1">
          <mxGeometry height="200" width="400" x="820" y="400" as="geometry" />
        </mxCell>
        <mxCell id="edge_query_info_310" edge="1" parent="1" source="query_unqualified_310" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;" target="info_query_310" value="">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="filter_subsystem_310" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=13;" value="Filter by Subsystem&lt;br&gt;(REPCCS vs CES)" vertex="1">
          <mxGeometry height="60" width="160" x="1280" y="160" as="geometry" />
        </mxCell>
        <mxCell id="edge_query_filter_310" edge="1" parent="1" source="query_unqualified_310" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="filter_subsystem_310" value="">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="info_unqualified_310" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;align=left;verticalAlign=top;fontSize=12;" value="&lt;b&gt;Unqualified Conditions:&lt;/b&gt;&lt;br&gt;1. offense_type != &#39;O&#39;&lt;br&gt;2. vehicle_registration_type NOT IN [&#39;S&#39;,&#39;D&#39;,&#39;V&#39;,&#39;I&#39;]&lt;br&gt;3. Failed same-day limit (already has AN on same day)&lt;br&gt;4. Exempt offense (Rule 20412 + $80 OR Rule 11210 + LB/HL)&lt;br&gt;5. No past qualifying offense in 24 months" vertex="1">
          <mxGeometry height="100" width="420" x="1280" y="250" as="geometry" />
        </mxCell>
        <mxCell id="edge_filter_info_310" edge="1" parent="1" source="filter_subsystem_310" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;" target="info_unqualified_310" value="">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="decision_repccs_310" parent="1" style="rhombus;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=13;" value="Any REPCCS&lt;br&gt;Records?" vertex="1">
          <mxGeometry height="100" width="140" x="1780" y="140" as="geometry" />
        </mxCell>
        <mxCell id="edge_filter_decision_repccs_310" edge="1" parent="1" source="filter_subsystem_310" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="decision_repccs_310" value="">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="generate_repccs_310" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=13;" value="Generate REPCCS File&lt;br&gt;(CSV Format)" vertex="1">
          <mxGeometry height="60" width="160" x="2000" y="160" as="geometry" />
        </mxCell>
        <mxCell id="edge_decision_generate_repccs_310" edge="1" parent="1" source="decision_repccs_310" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="generate_repccs_310" value="YES">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="upload_repccs_310" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=13;" value="Upload File to SFTP&lt;br&gt;(REPCCS)" vertex="1">
          <mxGeometry height="60" width="160" x="2220" y="160" as="geometry" />
        </mxCell>
        <mxCell id="edge_generate_upload_repccs_310" edge="1" parent="1" source="generate_repccs_310" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="upload_repccs_310" value="">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="info_repccs_sftp_310" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;align=left;verticalAlign=top;fontSize=11;" value="&lt;b&gt;REPCCS SFTP Details:&lt;/b&gt;&lt;br&gt;Protocol: SFTP&lt;br&gt;Server: [from Azure Key Vault: REPCCS_SFTP_HOST]&lt;br&gt;Port: 22&lt;br&gt;Username: [from Azure Key Vault: REPCCS_SFTP_USER]&lt;br&gt;Password: [from Azure Key Vault: REPCCS_SFTP_PASS]&lt;br&gt;Remote Path: /inbound/unqualified_an/&lt;br&gt;&lt;br&gt;&lt;b&gt;File Format:&lt;/b&gt;&lt;br&gt;Filename: REPCCS_Unqualified_AN_YYYYMMDD.csv&lt;br&gt;Format: CSV with header&lt;br&gt;Column: vehicle_no&lt;br&gt;Example: SHB1234U&lt;br&gt;&lt;br&gt;Timeout: 60s | Retry: 3 attempts" vertex="1">
          <mxGeometry height="280" width="380" x="2000" y="680" as="geometry" />
        </mxCell>
        <mxCell id="edge_upload_repccs_info_310" edge="1" parent="1" source="upload_repccs_310" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;" target="info_repccs_sftp_310" value="">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="decision_repccs_success_310" parent="1" style="rhombus;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=13;" value="Upload&lt;br&gt;Success?" vertex="1">
          <mxGeometry height="100" width="140" x="2450" y="140" as="geometry" />
        </mxCell>
        <mxCell id="edge_upload_decision_repccs_310" edge="1" parent="1" source="upload_repccs_310" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="decision_repccs_success_310" value="">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="log_repccs_310" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=13;" value="Log Upload Success&lt;br&gt;(REPCCS)" vertex="1">
          <mxGeometry height="60" width="160" x="2660" y="160" as="geometry" />
        </mxCell>
        <mxCell id="edge_decision_log_repccs_310" edge="1" parent="1" source="decision_repccs_success_310" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="log_repccs_310" value="YES">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="retry_repccs_310" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=13;" value="Retry Upload&lt;br&gt;(Max 3 Times)" vertex="1">
          <mxGeometry height="60" width="160" x="2440" y="280" as="geometry" />
        </mxCell>
        <mxCell id="edge_decision_retry_repccs_310" edge="1" parent="1" source="decision_repccs_success_310" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="retry_repccs_310" value="NO">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="edge_retry_generate_repccs_310" edge="1" parent="1" source="retry_repccs_310" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;" target="upload_repccs_310" value="Retry">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2520" y="310" />
              <mxPoint x="2300" y="310" />
              <mxPoint x="2300" y="260" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="decision_ces_310" parent="1" style="rhombus;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=13;" value="Any CES&lt;br&gt;Records?" vertex="1">
          <mxGeometry height="100" width="140" x="2900" y="140" as="geometry" />
        </mxCell>
        <mxCell id="edge_log_repccs_ces_310" edge="1" parent="1" source="log_repccs_310" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="decision_ces_310" value="">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="generate_ces_310" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=13;" value="Generate CES File&lt;br&gt;(CSV Format)" vertex="1">
          <mxGeometry height="60" width="160" x="3120" y="160" as="geometry" />
        </mxCell>
        <mxCell id="edge_decision_generate_ces_310" edge="1" parent="1" source="decision_ces_310" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="generate_ces_310" value="YES">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="upload_ces_310" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=13;" value="Upload File to SFTP&lt;br&gt;(CES)" vertex="1">
          <mxGeometry height="60" width="160" x="3340" y="160" as="geometry" />
        </mxCell>
        <mxCell id="edge_generate_upload_ces_310" edge="1" parent="1" source="generate_ces_310" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="upload_ces_310" value="">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="info_ces_sftp_310" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;align=left;verticalAlign=top;fontSize=11;" value="&lt;b&gt;CES SFTP Details:&lt;/b&gt;&lt;br&gt;Protocol: SFTP&lt;br&gt;Server: [from Azure Key Vault: CES_SFTP_HOST]&lt;br&gt;Port: 22&lt;br&gt;Username: [from Azure Key Vault: CES_SFTP_USER]&lt;br&gt;Password: [from Azure Key Vault: CES_SFTP_PASS]&lt;br&gt;Remote Path: /inbound/unqualified_an/&lt;br&gt;&lt;br&gt;&lt;b&gt;File Format:&lt;/b&gt;&lt;br&gt;Filename: CES_Unqualified_AN_YYYYMMDD.csv&lt;br&gt;Format: CSV with header&lt;br&gt;Column: vehicle_no&lt;br&gt;Example: SHB1234U&lt;br&gt;&lt;br&gt;Timeout: 60s | Retry: 3 attempts" vertex="1">
          <mxGeometry height="280" width="380" x="3120" y="680" as="geometry" />
        </mxCell>
        <mxCell id="edge_upload_ces_info_310" edge="1" parent="1" source="upload_ces_310" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;" target="info_ces_sftp_310" value="">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="decision_ces_success_310" parent="1" style="rhombus;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=13;" value="Upload&lt;br&gt;Success?" vertex="1">
          <mxGeometry height="100" width="140" x="3570" y="140" as="geometry" />
        </mxCell>
        <mxCell id="edge_upload_decision_ces_310" edge="1" parent="1" source="upload_ces_310" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="decision_ces_success_310" value="">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="log_ces_310" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=13;" value="Log Upload Success&lt;br&gt;(CES)" vertex="1">
          <mxGeometry height="60" width="160" x="3780" y="160" as="geometry" />
        </mxCell>
        <mxCell id="edge_decision_log_ces_310" edge="1" parent="1" source="decision_ces_success_310" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="log_ces_310" value="YES">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="retry_ces_310" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=13;" value="Retry Upload&lt;br&gt;(Max 3 Times)" vertex="1">
          <mxGeometry height="60" width="160" x="3560" y="280" as="geometry" />
        </mxCell>
        <mxCell id="edge_decision_retry_ces_310" edge="1" parent="1" source="decision_ces_success_310" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="retry_ces_310" value="NO">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="edge_retry_generate_ces_310" edge="1" parent="1" source="retry_ces_310" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;" target="upload_ces_310" value="Retry">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3640" y="310" />
              <mxPoint x="3420" y="310" />
              <mxPoint x="3420" y="260" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="edge_decision_repccs_no_310" edge="1" parent="1" source="decision_repccs_310" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" target="decision_ces_310" value="NO">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1850" y="100" />
              <mxPoint x="2970" y="100" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="edge_decision_ces_no_310" edge="1" parent="1" source="decision_ces_310" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" target="update_status_310" value="NO">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3040" y="100" />
              <mxPoint x="4100" y="100" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="update_status_310" parent="1" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=13;" value="Update Notice Status&lt;br&gt;(unqualified_list_sent_flag=&#39;Y&#39;)" vertex="1">
          <mxGeometry height="80" width="200" x="4000" y="420" as="geometry" />
        </mxCell>
        <mxCell id="edge_log_ces_update_310" edge="1" parent="1" source="log_ces_310" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="update_status_310" value="">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="log_transmission_310" parent="1" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=13;" value="Insert Transmission Log&lt;br&gt;(ocms_unqualified_an_transmission_log)" vertex="1">
          <mxGeometry height="80" width="220" x="4280" y="420" as="geometry" />
        </mxCell>
        <mxCell id="edge_update_log_310" edge="1" parent="1" source="update_status_310" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="log_transmission_310" value="">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="log_complete_310" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=13;" value="Log Cron Complete&lt;br&gt;(Summary)" vertex="1">
          <mxGeometry height="60" width="160" x="4580" y="160" as="geometry" />
        </mxCell>
        <mxCell id="edge_log_complete_310" edge="1" parent="1" source="log_transmission_310" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="log_complete_310" value="">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="end_310" parent="1" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.start_1;whiteSpace=wrap;fillColor=#f5f5f5;strokeColor=#666666;fontSize=13;fontColor=#333333;" value="End" vertex="1">
          <mxGeometry height="60" width="120" x="4800" y="160" as="geometry" />
        </mxCell>
        <mxCell id="edge_complete_end_310" edge="1" parent="1" source="log_complete_310" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="end_310" value="">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="info_cron_310" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;align=left;verticalAlign=top;fontSize=12;" value="&lt;b&gt;Cron Job Configuration:&lt;/b&gt;&lt;br&gt;Schedule: Daily at 02:00 AM SGT&lt;br&gt;Date Range: Previous day (00:00:00 to 23:59:59)&lt;br&gt;Transmission: SFTP file upload&lt;br&gt;Max Retry: 3 attempts per upload&lt;br&gt;Timeout: 60 seconds per SFTP connection" vertex="1">
          <mxGeometry height="120" width="380" x="4580" y="250" as="geometry" />
        </mxCell>
        <mxCell id="edge_log_cron_info_310" edge="1" parent="1" source="log_complete_310" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;" target="info_cron_310" value="">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
